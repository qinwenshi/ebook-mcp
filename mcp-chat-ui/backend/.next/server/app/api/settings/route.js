/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/settings/route";
exports.ids = ["app/api/settings/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fsettings%2Froute&page=%2Fapi%2Fsettings%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsettings%2Froute.ts&appDir=%2FUsers%2Fonebird%2Fgithub%2Febook-mcp%2Fmcp-chat-ui%2Fbackend%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fonebird%2Fgithub%2Febook-mcp%2Fmcp-chat-ui%2Fbackend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!":
/*!***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fsettings%2Froute&page=%2Fapi%2Fsettings%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsettings%2Froute.ts&appDir=%2FUsers%2Fonebird%2Fgithub%2Febook-mcp%2Fmcp-chat-ui%2Fbackend%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fonebird%2Fgithub%2Febook-mcp%2Fmcp-chat-ui%2Fbackend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=! ***!
  \***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   handler: () => (/* binding */ handler),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/server/request-meta */ \"(rsc)/./node_modules/next/dist/server/request-meta.js\");\n/* harmony import */ var next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(rsc)/./node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/shared/lib/router/utils/app-paths */ \"next/dist/shared/lib/router/utils/app-paths\");\n/* harmony import */ var next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/server/base-http/node */ \"(rsc)/./node_modules/next/dist/server/base-http/node.js\");\n/* harmony import */ var next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! next/dist/server/web/spec-extension/adapters/next-request */ \"(rsc)/./node_modules/next/dist/server/web/spec-extension/adapters/next-request.js\");\n/* harmony import */ var next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(rsc)/./node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! next/dist/server/instrumentation/utils */ \"(rsc)/./node_modules/next/dist/server/instrumentation/utils.js\");\n/* harmony import */ var next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! next/dist/server/send-response */ \"(rsc)/./node_modules/next/dist/server/send-response.js\");\n/* harmony import */ var next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! next/dist/server/web/utils */ \"(rsc)/./node_modules/next/dist/server/web/utils.js\");\n/* harmony import */ var next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__);\n/* harmony import */ var next_dist_server_lib_cache_control__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! next/dist/server/lib/cache-control */ \"(rsc)/./node_modules/next/dist/server/lib/cache-control.js\");\n/* harmony import */ var next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! next/dist/lib/constants */ \"(rsc)/./node_modules/next/dist/lib/constants.js\");\n/* harmony import */ var next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13___default = /*#__PURE__*/__webpack_require__.n(next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__);\n/* harmony import */ var next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! next/dist/shared/lib/no-fallback-error.external */ \"next/dist/shared/lib/no-fallback-error.external\");\n/* harmony import */ var next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14___default = /*#__PURE__*/__webpack_require__.n(next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__);\n/* harmony import */ var next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! next/dist/server/response-cache */ \"(rsc)/./node_modules/next/dist/server/response-cache/index.js\");\n/* harmony import */ var next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__);\n/* harmony import */ var _Users_onebird_github_ebook_mcp_mcp_chat_ui_backend_src_app_api_settings_route_ts__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./src/app/api/settings/route.ts */ \"(rsc)/./src/app/api/settings/route.ts\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/settings/route\",\n        pathname: \"/api/settings\",\n        filename: \"route\",\n        bundlePath: \"app/api/settings/route\"\n    },\n    distDir: \".next\" || 0,\n    projectDir:  false || '',\n    resolvedPagePath: \"/Users/onebird/github/ebook-mcp/mcp-chat-ui/backend/src/app/api/settings/route.ts\",\n    nextConfigOutput,\n    userland: _Users_onebird_github_ebook_mcp_mcp_chat_ui_backend_src_app_api_settings_route_ts__WEBPACK_IMPORTED_MODULE_16__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\nasync function handler(req, res, ctx) {\n    var _nextConfig_experimental;\n    let srcPage = \"/api/settings/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {} else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = \"false\";\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname } = prepareResult;\n    const normalizedSrcPage = (0,next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__.normalizeAppPath)(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                throw new next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__.NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isRevalidate = isIsr && !supportsDynamicResponse;\n    const method = req.method || 'GET';\n    const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__.getTracer)();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                dynamicIO: Boolean(nextConfig.experimental.dynamicIO),\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            supportsDynamicResponse,\n            incrementalCache: (0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'incrementalCache'),\n            cacheLifeProfiles: (_nextConfig_experimental = nextConfig.experimental) == null ? void 0 : _nextConfig_experimental.cacheLife,\n            isRevalidate,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext)=>routeModule.onRequestError(req, error, errorContext, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__.NodeNextRequest(req);\n    const nodeNextRes = new next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__.NodeNextResponse(res);\n    const nextReq = next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__.NextRequestAdapter.fromNodeNextRequest(nodeNextReq, (0,next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__.signalFromNodeResponse)(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        };\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!(0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode') && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = (0,next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__.toNodeOutgoingHttpHeaders)(response.headers);\n                        if (cacheTags) {\n                            headers[next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__.CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: (0,next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__.getRevalidateReason)({\n                                isRevalidate,\n                                isOnDemandRevalidate\n                            })\n                        }, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__.CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!(0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode')) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = (0,next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__.fromNodeOutgoingHttpHeaders)(cacheEntry.value.headers);\n            if (!((0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode') && isIsr)) {\n                headers.delete(next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', (0,next_dist_server_lib_cache_control__WEBPACK_IMPORTED_MODULE_12__.getCacheControlHeader)(cacheEntry.cacheControl));\n            }\n            await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        // if we aren't wrapped by base-server handle here\n        if (!activeSpan && !(err instanceof next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__.NoFallbackError)) {\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: (0,next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__.getRevalidateReason)({\n                    isRevalidate,\n                    isOnDemandRevalidate\n                })\n            });\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZzZXR0aW5ncyUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGc2V0dGluZ3MlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZzZXR0aW5ncyUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRm9uZWJpcmQlMkZnaXRodWIlMkZlYm9vay1tY3AlMkZtY3AtY2hhdC11aSUyRmJhY2tlbmQlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGb25lYmlyZCUyRmdpdGh1YiUyRmVib29rLW1jcCUyRm1jcC1jaGF0LXVpJTJGYmFja2VuZCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCZpc0dsb2JhbE5vdEZvdW5kRW5hYmxlZD0hIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ3FCO0FBQ2Q7QUFDUztBQUNPO0FBQ0s7QUFDbUM7QUFDakQ7QUFDTztBQUNmO0FBQ3NDO0FBQ3pCO0FBQ007QUFDQztBQUNoQjtBQUM0QztBQUM5RztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IseUdBQW1CO0FBQzNDO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxhQUFhLE9BQW9DLElBQUksQ0FBRTtBQUN2RCxnQkFBZ0IsTUFBdUM7QUFDdkQ7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7QUFDbkY7QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxLQUFxQixFQUFFLEVBRTFCLENBQUM7QUFDTjtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsT0FBd0M7QUFDdkU7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksb0pBQW9KO0FBQ2hLLDhCQUE4Qiw2RkFBZ0I7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLDZGQUFlO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLDRFQUFTO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSw4QkFBOEIsNkVBQWM7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLDRFQUFlO0FBQzNDLDRCQUE0Qiw2RUFBZ0I7QUFDNUMsb0JBQW9CLHlHQUFrQixrQ0FBa0MsaUhBQXNCO0FBQzlGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFBaUUsZ0ZBQWM7QUFDL0UsK0RBQStELHlDQUF5QztBQUN4RztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxRQUFRLEVBQUUsTUFBTTtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLGtCQUFrQjtBQUNsQix1Q0FBdUMsUUFBUSxFQUFFLFFBQVE7QUFDekQ7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsK0NBQStDLG9CQUFvQjtBQUNuRTtBQUNBLHlCQUF5Qiw2RUFBYztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLHNGQUF5QjtBQUNqRTtBQUNBLG9DQUFvQyw0RUFBc0I7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzSkFBc0osb0VBQWM7QUFDcEssMElBQTBJLG9FQUFjO0FBQ3hKO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyw2RUFBZTtBQUNyRDtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0EsOEJBQThCLDZFQUFZO0FBQzFDO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsMkZBQW1CO0FBQ2pFO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0IseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsa0VBQVM7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxSUFBcUksNkVBQWU7QUFDcEo7QUFDQSwyR0FBMkcsaUhBQWlIO0FBQzVOO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGlCQUFpQiw2RUFBYztBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsd0ZBQTJCO0FBQ3ZELGtCQUFrQiw2RUFBYztBQUNoQywrQkFBK0IsNEVBQXNCO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLDBGQUFxQjtBQUNsRTtBQUNBLGtCQUFrQiw2RUFBWTtBQUM5QjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDViw2RUFBNkUsZ0ZBQWM7QUFDM0YsaUNBQWlDLFFBQVEsRUFBRSxRQUFRO0FBQ25ELDBCQUEwQix1RUFBUTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLE1BQU07QUFDTjtBQUNBLDRDQUE0Qyw2RkFBZTtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQywyRkFBbUI7QUFDckQ7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsNkVBQVk7QUFDMUI7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0IHsgZ2V0UmVxdWVzdE1ldGEgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yZXF1ZXN0LW1ldGFcIjtcbmltcG9ydCB7IGdldFRyYWNlciwgU3BhbktpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvdHJhY2UvdHJhY2VyXCI7XG5pbXBvcnQgeyBub3JtYWxpemVBcHBQYXRoIH0gZnJvbSBcIm5leHQvZGlzdC9zaGFyZWQvbGliL3JvdXRlci91dGlscy9hcHAtcGF0aHNcIjtcbmltcG9ydCB7IE5vZGVOZXh0UmVxdWVzdCwgTm9kZU5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Jhc2UtaHR0cC9ub2RlXCI7XG5pbXBvcnQgeyBOZXh0UmVxdWVzdEFkYXB0ZXIsIHNpZ25hbEZyb21Ob2RlUmVzcG9uc2UgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci93ZWIvc3BlYy1leHRlbnNpb24vYWRhcHRlcnMvbmV4dC1yZXF1ZXN0XCI7XG5pbXBvcnQgeyBCYXNlU2VydmVyU3BhbiB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi90cmFjZS9jb25zdGFudHNcIjtcbmltcG9ydCB7IGdldFJldmFsaWRhdGVSZWFzb24gfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9pbnN0cnVtZW50YXRpb24vdXRpbHNcIjtcbmltcG9ydCB7IHNlbmRSZXNwb25zZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3NlbmQtcmVzcG9uc2VcIjtcbmltcG9ydCB7IGZyb21Ob2RlT3V0Z29pbmdIdHRwSGVhZGVycywgdG9Ob2RlT3V0Z29pbmdIdHRwSGVhZGVycyB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3dlYi91dGlsc1wiO1xuaW1wb3J0IHsgZ2V0Q2FjaGVDb250cm9sSGVhZGVyIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL2NhY2hlLWNvbnRyb2xcIjtcbmltcG9ydCB7IElORklOSVRFX0NBQ0hFLCBORVhUX0NBQ0hFX1RBR1NfSEVBREVSIH0gZnJvbSBcIm5leHQvZGlzdC9saWIvY29uc3RhbnRzXCI7XG5pbXBvcnQgeyBOb0ZhbGxiYWNrRXJyb3IgfSBmcm9tIFwibmV4dC9kaXN0L3NoYXJlZC9saWIvbm8tZmFsbGJhY2stZXJyb3IuZXh0ZXJuYWxcIjtcbmltcG9ydCB7IENhY2hlZFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3Jlc3BvbnNlLWNhY2hlXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL29uZWJpcmQvZ2l0aHViL2Vib29rLW1jcC9tY3AtY2hhdC11aS9iYWNrZW5kL3NyYy9hcHAvYXBpL3NldHRpbmdzL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9zZXR0aW5ncy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3NldHRpbmdzXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9zZXR0aW5ncy9yb3V0ZVwiXG4gICAgfSxcbiAgICBkaXN0RGlyOiBwcm9jZXNzLmVudi5fX05FWFRfUkVMQVRJVkVfRElTVF9ESVIgfHwgJycsXG4gICAgcHJvamVjdERpcjogcHJvY2Vzcy5lbnYuX19ORVhUX1JFTEFUSVZFX1BST0pFQ1RfRElSIHx8ICcnLFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL29uZWJpcmQvZ2l0aHViL2Vib29rLW1jcC9tY3AtY2hhdC11aS9iYWNrZW5kL3NyYy9hcHAvYXBpL3NldHRpbmdzL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgd29ya0FzeW5jU3RvcmFnZSxcbiAgICAgICAgd29ya1VuaXRBc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIHBhdGNoRmV0Y2gsICB9O1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxLCByZXMsIGN0eCkge1xuICAgIHZhciBfbmV4dENvbmZpZ19leHBlcmltZW50YWw7XG4gICAgbGV0IHNyY1BhZ2UgPSBcIi9hcGkvc2V0dGluZ3Mvcm91dGVcIjtcbiAgICAvLyB0dXJib3BhY2sgZG9lc24ndCBub3JtYWxpemUgYC9pbmRleGAgaW4gdGhlIHBhZ2UgbmFtZVxuICAgIC8vIHNvIHdlIG5lZWQgdG8gdG8gcHJvY2VzcyBkeW5hbWljIHJvdXRlcyBwcm9wZXJseVxuICAgIC8vIFRPRE86IGZpeCB0dXJib3BhY2sgcHJvdmlkaW5nIGRpZmZlcmluZyB2YWx1ZSBmcm9tIHdlYnBhY2tcbiAgICBpZiAocHJvY2Vzcy5lbnYuVFVSQk9QQUNLKSB7XG4gICAgICAgIHNyY1BhZ2UgPSBzcmNQYWdlLnJlcGxhY2UoL1xcL2luZGV4JC8sICcnKSB8fCAnLyc7XG4gICAgfSBlbHNlIGlmIChzcmNQYWdlID09PSAnL2luZGV4Jykge1xuICAgICAgICAvLyB3ZSBhbHdheXMgbm9ybWFsaXplIC9pbmRleCBzcGVjaWZpY2FsbHlcbiAgICAgICAgc3JjUGFnZSA9ICcvJztcbiAgICB9XG4gICAgY29uc3QgbXVsdGlab25lRHJhZnRNb2RlID0gcHJvY2Vzcy5lbnYuX19ORVhUX01VTFRJX1pPTkVfRFJBRlRfTU9ERTtcbiAgICBjb25zdCBwcmVwYXJlUmVzdWx0ID0gYXdhaXQgcm91dGVNb2R1bGUucHJlcGFyZShyZXEsIHJlcywge1xuICAgICAgICBzcmNQYWdlLFxuICAgICAgICBtdWx0aVpvbmVEcmFmdE1vZGVcbiAgICB9KTtcbiAgICBpZiAoIXByZXBhcmVSZXN1bHQpIHtcbiAgICAgICAgcmVzLnN0YXR1c0NvZGUgPSA0MDA7XG4gICAgICAgIHJlcy5lbmQoJ0JhZCBSZXF1ZXN0Jyk7XG4gICAgICAgIGN0eC53YWl0VW50aWwgPT0gbnVsbCA/IHZvaWQgMCA6IGN0eC53YWl0VW50aWwuY2FsbChjdHgsIFByb21pc2UucmVzb2x2ZSgpKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHsgYnVpbGRJZCwgcGFyYW1zLCBuZXh0Q29uZmlnLCBpc0RyYWZ0TW9kZSwgcHJlcmVuZGVyTWFuaWZlc3QsIHJvdXRlclNlcnZlckNvbnRleHQsIGlzT25EZW1hbmRSZXZhbGlkYXRlLCByZXZhbGlkYXRlT25seUdlbmVyYXRlZCwgcmVzb2x2ZWRQYXRobmFtZSB9ID0gcHJlcGFyZVJlc3VsdDtcbiAgICBjb25zdCBub3JtYWxpemVkU3JjUGFnZSA9IG5vcm1hbGl6ZUFwcFBhdGgoc3JjUGFnZSk7XG4gICAgbGV0IGlzSXNyID0gQm9vbGVhbihwcmVyZW5kZXJNYW5pZmVzdC5keW5hbWljUm91dGVzW25vcm1hbGl6ZWRTcmNQYWdlXSB8fCBwcmVyZW5kZXJNYW5pZmVzdC5yb3V0ZXNbcmVzb2x2ZWRQYXRobmFtZV0pO1xuICAgIGlmIChpc0lzciAmJiAhaXNEcmFmdE1vZGUpIHtcbiAgICAgICAgY29uc3QgaXNQcmVyZW5kZXJlZCA9IEJvb2xlYW4ocHJlcmVuZGVyTWFuaWZlc3Qucm91dGVzW3Jlc29sdmVkUGF0aG5hbWVdKTtcbiAgICAgICAgY29uc3QgcHJlcmVuZGVySW5mbyA9IHByZXJlbmRlck1hbmlmZXN0LmR5bmFtaWNSb3V0ZXNbbm9ybWFsaXplZFNyY1BhZ2VdO1xuICAgICAgICBpZiAocHJlcmVuZGVySW5mbykge1xuICAgICAgICAgICAgaWYgKHByZXJlbmRlckluZm8uZmFsbGJhY2sgPT09IGZhbHNlICYmICFpc1ByZXJlbmRlcmVkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vRmFsbGJhY2tFcnJvcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGxldCBjYWNoZUtleSA9IG51bGw7XG4gICAgaWYgKGlzSXNyICYmICFyb3V0ZU1vZHVsZS5pc0RldiAmJiAhaXNEcmFmdE1vZGUpIHtcbiAgICAgICAgY2FjaGVLZXkgPSByZXNvbHZlZFBhdGhuYW1lO1xuICAgICAgICAvLyBlbnN1cmUgL2luZGV4IGFuZCAvIGlzIG5vcm1hbGl6ZWQgdG8gb25lIGtleVxuICAgICAgICBjYWNoZUtleSA9IGNhY2hlS2V5ID09PSAnL2luZGV4JyA/ICcvJyA6IGNhY2hlS2V5O1xuICAgIH1cbiAgICBjb25zdCBzdXBwb3J0c0R5bmFtaWNSZXNwb25zZSA9IC8vIElmIHdlJ3JlIGluIGRldmVsb3BtZW50LCB3ZSBhbHdheXMgc3VwcG9ydCBkeW5hbWljIEhUTUxcbiAgICByb3V0ZU1vZHVsZS5pc0RldiA9PT0gdHJ1ZSB8fCAvLyBJZiB0aGlzIGlzIG5vdCBTU0cgb3IgZG9lcyBub3QgaGF2ZSBzdGF0aWMgcGF0aHMsIHRoZW4gaXQgc3VwcG9ydHNcbiAgICAvLyBkeW5hbWljIEhUTUwuXG4gICAgIWlzSXNyO1xuICAgIC8vIFRoaXMgaXMgYSByZXZhbGlkYXRpb24gcmVxdWVzdCBpZiB0aGUgcmVxdWVzdCBpcyBmb3IgYSBzdGF0aWNcbiAgICAvLyBwYWdlIGFuZCBpdCBpcyBub3QgYmVpbmcgcmVzdW1lZCBmcm9tIGEgcG9zdHBvbmVkIHJlbmRlciBhbmRcbiAgICAvLyBpdCBpcyBub3QgYSBkeW5hbWljIFJTQyByZXF1ZXN0IHRoZW4gaXQgaXMgYSByZXZhbGlkYXRpb25cbiAgICAvLyByZXF1ZXN0LlxuICAgIGNvbnN0IGlzUmV2YWxpZGF0ZSA9IGlzSXNyICYmICFzdXBwb3J0c0R5bmFtaWNSZXNwb25zZTtcbiAgICBjb25zdCBtZXRob2QgPSByZXEubWV0aG9kIHx8ICdHRVQnO1xuICAgIGNvbnN0IHRyYWNlciA9IGdldFRyYWNlcigpO1xuICAgIGNvbnN0IGFjdGl2ZVNwYW4gPSB0cmFjZXIuZ2V0QWN0aXZlU2NvcGVTcGFuKCk7XG4gICAgY29uc3QgY29udGV4dCA9IHtcbiAgICAgICAgcGFyYW1zLFxuICAgICAgICBwcmVyZW5kZXJNYW5pZmVzdCxcbiAgICAgICAgcmVuZGVyT3B0czoge1xuICAgICAgICAgICAgZXhwZXJpbWVudGFsOiB7XG4gICAgICAgICAgICAgICAgZHluYW1pY0lPOiBCb29sZWFuKG5leHRDb25maWcuZXhwZXJpbWVudGFsLmR5bmFtaWNJTyksXG4gICAgICAgICAgICAgICAgYXV0aEludGVycnVwdHM6IEJvb2xlYW4obmV4dENvbmZpZy5leHBlcmltZW50YWwuYXV0aEludGVycnVwdHMpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VwcG9ydHNEeW5hbWljUmVzcG9uc2UsXG4gICAgICAgICAgICBpbmNyZW1lbnRhbENhY2hlOiBnZXRSZXF1ZXN0TWV0YShyZXEsICdpbmNyZW1lbnRhbENhY2hlJyksXG4gICAgICAgICAgICBjYWNoZUxpZmVQcm9maWxlczogKF9uZXh0Q29uZmlnX2V4cGVyaW1lbnRhbCA9IG5leHRDb25maWcuZXhwZXJpbWVudGFsKSA9PSBudWxsID8gdm9pZCAwIDogX25leHRDb25maWdfZXhwZXJpbWVudGFsLmNhY2hlTGlmZSxcbiAgICAgICAgICAgIGlzUmV2YWxpZGF0ZSxcbiAgICAgICAgICAgIHdhaXRVbnRpbDogY3R4LndhaXRVbnRpbCxcbiAgICAgICAgICAgIG9uQ2xvc2U6IChjYik9PntcbiAgICAgICAgICAgICAgICByZXMub24oJ2Nsb3NlJywgY2IpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uQWZ0ZXJUYXNrRXJyb3I6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIG9uSW5zdHJ1bWVudGF0aW9uUmVxdWVzdEVycm9yOiAoZXJyb3IsIF9yZXF1ZXN0LCBlcnJvckNvbnRleHQpPT5yb3V0ZU1vZHVsZS5vblJlcXVlc3RFcnJvcihyZXEsIGVycm9yLCBlcnJvckNvbnRleHQsIHJvdXRlclNlcnZlckNvbnRleHQpXG4gICAgICAgIH0sXG4gICAgICAgIHNoYXJlZENvbnRleHQ6IHtcbiAgICAgICAgICAgIGJ1aWxkSWRcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3Qgbm9kZU5leHRSZXEgPSBuZXcgTm9kZU5leHRSZXF1ZXN0KHJlcSk7XG4gICAgY29uc3Qgbm9kZU5leHRSZXMgPSBuZXcgTm9kZU5leHRSZXNwb25zZShyZXMpO1xuICAgIGNvbnN0IG5leHRSZXEgPSBOZXh0UmVxdWVzdEFkYXB0ZXIuZnJvbU5vZGVOZXh0UmVxdWVzdChub2RlTmV4dFJlcSwgc2lnbmFsRnJvbU5vZGVSZXNwb25zZShyZXMpKTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBpbnZva2VSb3V0ZU1vZHVsZSA9IGFzeW5jIChzcGFuKT0+e1xuICAgICAgICAgICAgcmV0dXJuIHJvdXRlTW9kdWxlLmhhbmRsZShuZXh0UmVxLCBjb250ZXh0KS5maW5hbGx5KCgpPT57XG4gICAgICAgICAgICAgICAgaWYgKCFzcGFuKSByZXR1cm47XG4gICAgICAgICAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGVzKHtcbiAgICAgICAgICAgICAgICAgICAgJ2h0dHAuc3RhdHVzX2NvZGUnOiByZXMuc3RhdHVzQ29kZSxcbiAgICAgICAgICAgICAgICAgICAgJ25leHQucnNjJzogZmFsc2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb25zdCByb290U3BhbkF0dHJpYnV0ZXMgPSB0cmFjZXIuZ2V0Um9vdFNwYW5BdHRyaWJ1dGVzKCk7XG4gICAgICAgICAgICAgICAgLy8gV2Ugd2VyZSB1bmFibGUgdG8gZ2V0IGF0dHJpYnV0ZXMsIHByb2JhYmx5IE9URUwgaXMgbm90IGVuYWJsZWRcbiAgICAgICAgICAgICAgICBpZiAoIXJvb3RTcGFuQXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyb290U3BhbkF0dHJpYnV0ZXMuZ2V0KCduZXh0LnNwYW5fdHlwZScpICE9PSBCYXNlU2VydmVyU3Bhbi5oYW5kbGVSZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgVW5leHBlY3RlZCByb290IHNwYW4gdHlwZSAnJHtyb290U3BhbkF0dHJpYnV0ZXMuZ2V0KCduZXh0LnNwYW5fdHlwZScpfScuIFBsZWFzZSByZXBvcnQgdGhpcyBOZXh0LmpzIGlzc3VlIGh0dHBzOi8vZ2l0aHViLmNvbS92ZXJjZWwvbmV4dC5qc2ApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHJvdXRlID0gcm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5yb3V0ZScpO1xuICAgICAgICAgICAgICAgIGlmIChyb3V0ZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gYCR7bWV0aG9kfSAke3JvdXRlfWA7XG4gICAgICAgICAgICAgICAgICAgIHNwYW4uc2V0QXR0cmlidXRlcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAnbmV4dC5yb3V0ZSc6IHJvdXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2h0dHAucm91dGUnOiByb3V0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICduZXh0LnNwYW5fbmFtZSc6IG5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHNwYW4udXBkYXRlTmFtZShuYW1lKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnVwZGF0ZU5hbWUoYCR7bWV0aG9kfSAke3JlcS51cmx9YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGhhbmRsZVJlc3BvbnNlID0gYXN5bmMgKGN1cnJlbnRTcGFuKT0+e1xuICAgICAgICAgICAgdmFyIF9jYWNoZUVudHJ5X3ZhbHVlO1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VHZW5lcmF0b3IgPSBhc3luYyAoeyBwcmV2aW91c0NhY2hlRW50cnkgfSk9PntcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWdldFJlcXVlc3RNZXRhKHJlcSwgJ21pbmltYWxNb2RlJykgJiYgaXNPbkRlbWFuZFJldmFsaWRhdGUgJiYgcmV2YWxpZGF0ZU9ubHlHZW5lcmF0ZWQgJiYgIXByZXZpb3VzQ2FjaGVFbnRyeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1c0NvZGUgPSA0MDQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBvbi1kZW1hbmQgcmV2YWxpZGF0ZSBhbHdheXMgc2V0cyB0aGlzIGhlYWRlclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcigneC1uZXh0anMtY2FjaGUnLCAnUkVWQUxJREFURUQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5lbmQoJ1RoaXMgcGFnZSBjb3VsZCBub3QgYmUgZm91bmQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaW52b2tlUm91dGVNb2R1bGUoY3VycmVudFNwYW4pO1xuICAgICAgICAgICAgICAgICAgICByZXEuZmV0Y2hNZXRyaWNzID0gY29udGV4dC5yZW5kZXJPcHRzLmZldGNoTWV0cmljcztcbiAgICAgICAgICAgICAgICAgICAgbGV0IHBlbmRpbmdXYWl0VW50aWwgPSBjb250ZXh0LnJlbmRlck9wdHMucGVuZGluZ1dhaXRVbnRpbDtcbiAgICAgICAgICAgICAgICAgICAgLy8gQXR0ZW1wdCB1c2luZyBwcm92aWRlZCB3YWl0VW50aWwgaWYgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIGl0J3Mgbm90IHdlIGZhbGxiYWNrIHRvIHNlbmRSZXNwb25zZSdzIGhhbmRsaW5nXG4gICAgICAgICAgICAgICAgICAgIGlmIChwZW5kaW5nV2FpdFVudGlsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3R4LndhaXRVbnRpbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC53YWl0VW50aWwocGVuZGluZ1dhaXRVbnRpbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ1dhaXRVbnRpbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjYWNoZVRhZ3MgPSBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkVGFncztcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHJlcXVlc3QgaXMgZm9yIGEgc3RhdGljIHJlc3BvbnNlLCB3ZSBjYW4gY2FjaGUgaXQgc28gbG9uZ1xuICAgICAgICAgICAgICAgICAgICAvLyBhcyBpdCdzIG5vdCBlZGdlLlxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNJc3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCByZXNwb25zZS5ibG9iKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDb3B5IHRoZSBoZWFkZXJzIGZyb20gdGhlIHJlc3BvbnNlLlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGVhZGVycyA9IHRvTm9kZU91dGdvaW5nSHR0cEhlYWRlcnMocmVzcG9uc2UuaGVhZGVycyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FjaGVUYWdzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1tORVhUX0NBQ0hFX1RBR1NfSEVBREVSXSA9IGNhY2hlVGFncztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaGVhZGVyc1snY29udGVudC10eXBlJ10gJiYgYmxvYi50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1snY29udGVudC10eXBlJ10gPSBibG9iLnR5cGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXZhbGlkYXRlID0gdHlwZW9mIGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRSZXZhbGlkYXRlID09PSAndW5kZWZpbmVkJyB8fCBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkUmV2YWxpZGF0ZSA+PSBJTkZJTklURV9DQUNIRSA/IGZhbHNlIDogY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZFJldmFsaWRhdGU7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleHBpcmUgPSB0eXBlb2YgY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZEV4cGlyZSA9PT0gJ3VuZGVmaW5lZCcgfHwgY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZEV4cGlyZSA+PSBJTkZJTklURV9DQUNIRSA/IHVuZGVmaW5lZCA6IGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRFeHBpcmU7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIGNhY2hlIGVudHJ5IGZvciB0aGUgcmVzcG9uc2UuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjYWNoZUVudHJ5ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtpbmQ6IENhY2hlZFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5OiBCdWZmZXIuZnJvbShhd2FpdCBibG9iLmFycmF5QnVmZmVyKCkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZUNvbnRyb2w6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2YWxpZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwaXJlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWNoZUVudHJ5O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VuZCByZXNwb25zZSB3aXRob3V0IGNhY2hpbmcgaWYgbm90IElTUlxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VuZFJlc3BvbnNlKG5vZGVOZXh0UmVxLCBub2RlTmV4dFJlcywgcmVzcG9uc2UsIGNvbnRleHQucmVuZGVyT3B0cy5wZW5kaW5nV2FpdFVudGlsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgYSBiYWNrZ3JvdW5kIHJldmFsaWRhdGUgd2UgbmVlZCB0byByZXBvcnRcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHJlcXVlc3QgZXJyb3IgaGVyZSBhcyBpdCB3b24ndCBiZSBidWJibGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcmV2aW91c0NhY2hlRW50cnkgPT0gbnVsbCA/IHZvaWQgMCA6IHByZXZpb3VzQ2FjaGVFbnRyeS5pc1N0YWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCByb3V0ZU1vZHVsZS5vblJlcXVlc3RFcnJvcihyZXEsIGVyciwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlcktpbmQ6ICdBcHAgUm91dGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0ZVBhdGg6IHNyY1BhZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVUeXBlOiAncm91dGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGVSZWFzb246IGdldFJldmFsaWRhdGVSZWFzb24oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1JldmFsaWRhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzT25EZW1hbmRSZXZhbGlkYXRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJvdXRlclNlcnZlckNvbnRleHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgY2FjaGVFbnRyeSA9IGF3YWl0IHJvdXRlTW9kdWxlLmhhbmRsZVJlc3BvbnNlKHtcbiAgICAgICAgICAgICAgICByZXEsXG4gICAgICAgICAgICAgICAgbmV4dENvbmZpZyxcbiAgICAgICAgICAgICAgICBjYWNoZUtleSxcbiAgICAgICAgICAgICAgICByb3V0ZUtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgICAgICAgICAgaXNGYWxsYmFjazogZmFsc2UsXG4gICAgICAgICAgICAgICAgcHJlcmVuZGVyTWFuaWZlc3QsXG4gICAgICAgICAgICAgICAgaXNSb3V0ZVBQUkVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlzT25EZW1hbmRSZXZhbGlkYXRlLFxuICAgICAgICAgICAgICAgIHJldmFsaWRhdGVPbmx5R2VuZXJhdGVkLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlR2VuZXJhdG9yLFxuICAgICAgICAgICAgICAgIHdhaXRVbnRpbDogY3R4LndhaXRVbnRpbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyB3ZSBkb24ndCBjcmVhdGUgYSBjYWNoZUVudHJ5IGZvciBJU1JcbiAgICAgICAgICAgIGlmICghaXNJc3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgoY2FjaGVFbnRyeSA9PSBudWxsID8gdm9pZCAwIDogKF9jYWNoZUVudHJ5X3ZhbHVlID0gY2FjaGVFbnRyeS52YWx1ZSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9jYWNoZUVudHJ5X3ZhbHVlLmtpbmQpICE9PSBDYWNoZWRSb3V0ZUtpbmQuQVBQX1JPVVRFKSB7XG4gICAgICAgICAgICAgICAgdmFyIF9jYWNoZUVudHJ5X3ZhbHVlMTtcbiAgICAgICAgICAgICAgICB0aHJvdyBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3IEVycm9yKGBJbnZhcmlhbnQ6IGFwcC1yb3V0ZSByZWNlaXZlZCBpbnZhbGlkIGNhY2hlIGVudHJ5ICR7Y2FjaGVFbnRyeSA9PSBudWxsID8gdm9pZCAwIDogKF9jYWNoZUVudHJ5X3ZhbHVlMSA9IGNhY2hlRW50cnkudmFsdWUpID09IG51bGwgPyB2b2lkIDAgOiBfY2FjaGVFbnRyeV92YWx1ZTEua2luZH1gKSwgXCJfX05FWFRfRVJST1JfQ09ERVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBcIkU3MDFcIixcbiAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFnZXRSZXF1ZXN0TWV0YShyZXEsICdtaW5pbWFsTW9kZScpKSB7XG4gICAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcigneC1uZXh0anMtY2FjaGUnLCBpc09uRGVtYW5kUmV2YWxpZGF0ZSA/ICdSRVZBTElEQVRFRCcgOiBjYWNoZUVudHJ5LmlzTWlzcyA/ICdNSVNTJyA6IGNhY2hlRW50cnkuaXNTdGFsZSA/ICdTVEFMRScgOiAnSElUJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBEcmFmdCBtb2RlIHNob3VsZCBuZXZlciBiZSBjYWNoZWRcbiAgICAgICAgICAgIGlmIChpc0RyYWZ0TW9kZSkge1xuICAgICAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0NhY2hlLUNvbnRyb2wnLCAncHJpdmF0ZSwgbm8tY2FjaGUsIG5vLXN0b3JlLCBtYXgtYWdlPTAsIG11c3QtcmV2YWxpZGF0ZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgaGVhZGVycyA9IGZyb21Ob2RlT3V0Z29pbmdIdHRwSGVhZGVycyhjYWNoZUVudHJ5LnZhbHVlLmhlYWRlcnMpO1xuICAgICAgICAgICAgaWYgKCEoZ2V0UmVxdWVzdE1ldGEocmVxLCAnbWluaW1hbE1vZGUnKSAmJiBpc0lzcikpIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzLmRlbGV0ZShORVhUX0NBQ0hFX1RBR1NfSEVBREVSKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElmIGNhY2hlIGNvbnRyb2wgaXMgYWxyZWFkeSBzZXQgb24gdGhlIHJlc3BvbnNlIHdlIGRvbid0XG4gICAgICAgICAgICAvLyBvdmVycmlkZSBpdCB0byBhbGxvdyB1c2VycyB0byBjdXN0b21pemUgaXQgdmlhIG5leHQuY29uZmlnXG4gICAgICAgICAgICBpZiAoY2FjaGVFbnRyeS5jYWNoZUNvbnRyb2wgJiYgIXJlcy5nZXRIZWFkZXIoJ0NhY2hlLUNvbnRyb2wnKSAmJiAhaGVhZGVycy5nZXQoJ0NhY2hlLUNvbnRyb2wnKSkge1xuICAgICAgICAgICAgICAgIGhlYWRlcnMuc2V0KCdDYWNoZS1Db250cm9sJywgZ2V0Q2FjaGVDb250cm9sSGVhZGVyKGNhY2hlRW50cnkuY2FjaGVDb250cm9sKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhd2FpdCBzZW5kUmVzcG9uc2Uobm9kZU5leHRSZXEsIG5vZGVOZXh0UmVzLCBuZXcgUmVzcG9uc2UoY2FjaGVFbnRyeS52YWx1ZS5ib2R5LCB7XG4gICAgICAgICAgICAgICAgaGVhZGVycyxcbiAgICAgICAgICAgICAgICBzdGF0dXM6IGNhY2hlRW50cnkudmFsdWUuc3RhdHVzIHx8IDIwMFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH07XG4gICAgICAgIC8vIFRPRE86IGFjdGl2ZVNwYW4gY29kZSBwYXRoIGlzIGZvciB3aGVuIHdyYXBwZWQgYnlcbiAgICAgICAgLy8gbmV4dC1zZXJ2ZXIgY2FuIGJlIHJlbW92ZWQgd2hlbiB0aGlzIGlzIG5vIGxvbmdlciB1c2VkXG4gICAgICAgIGlmIChhY3RpdmVTcGFuKSB7XG4gICAgICAgICAgICBhd2FpdCBoYW5kbGVSZXNwb25zZShhY3RpdmVTcGFuKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGF3YWl0IHRyYWNlci53aXRoUHJvcGFnYXRlZENvbnRleHQocmVxLmhlYWRlcnMsICgpPT50cmFjZXIudHJhY2UoQmFzZVNlcnZlclNwYW4uaGFuZGxlUmVxdWVzdCwge1xuICAgICAgICAgICAgICAgICAgICBzcGFuTmFtZTogYCR7bWV0aG9kfSAke3JlcS51cmx9YCxcbiAgICAgICAgICAgICAgICAgICAga2luZDogU3BhbktpbmQuU0VSVkVSLFxuICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnaHR0cC5tZXRob2QnOiBtZXRob2QsXG4gICAgICAgICAgICAgICAgICAgICAgICAnaHR0cC50YXJnZXQnOiByZXEudXJsXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBoYW5kbGVSZXNwb25zZSkpO1xuICAgICAgICB9XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIC8vIGlmIHdlIGFyZW4ndCB3cmFwcGVkIGJ5IGJhc2Utc2VydmVyIGhhbmRsZSBoZXJlXG4gICAgICAgIGlmICghYWN0aXZlU3BhbiAmJiAhKGVyciBpbnN0YW5jZW9mIE5vRmFsbGJhY2tFcnJvcikpIHtcbiAgICAgICAgICAgIGF3YWl0IHJvdXRlTW9kdWxlLm9uUmVxdWVzdEVycm9yKHJlcSwgZXJyLCB7XG4gICAgICAgICAgICAgICAgcm91dGVyS2luZDogJ0FwcCBSb3V0ZXInLFxuICAgICAgICAgICAgICAgIHJvdXRlUGF0aDogbm9ybWFsaXplZFNyY1BhZ2UsXG4gICAgICAgICAgICAgICAgcm91dGVUeXBlOiAncm91dGUnLFxuICAgICAgICAgICAgICAgIHJldmFsaWRhdGVSZWFzb246IGdldFJldmFsaWRhdGVSZWFzb24oe1xuICAgICAgICAgICAgICAgICAgICBpc1JldmFsaWRhdGUsXG4gICAgICAgICAgICAgICAgICAgIGlzT25EZW1hbmRSZXZhbGlkYXRlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIHJldGhyb3cgc28gdGhhdCB3ZSBjYW4gaGFuZGxlIHNlcnZpbmcgZXJyb3IgcGFnZVxuICAgICAgICAvLyBJZiB0aGlzIGlzIGR1cmluZyBzdGF0aWMgZ2VuZXJhdGlvbiwgdGhyb3cgdGhlIGVycm9yIGFnYWluLlxuICAgICAgICBpZiAoaXNJc3IpIHRocm93IGVycjtcbiAgICAgICAgLy8gT3RoZXJ3aXNlLCBzZW5kIGEgNTAwIHJlc3BvbnNlLlxuICAgICAgICBhd2FpdCBzZW5kUmVzcG9uc2Uobm9kZU5leHRSZXEsIG5vZGVOZXh0UmVzLCBuZXcgUmVzcG9uc2UobnVsbCwge1xuICAgICAgICAgICAgc3RhdHVzOiA1MDBcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fsettings%2Froute&page=%2Fapi%2Fsettings%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsettings%2Froute.ts&appDir=%2FUsers%2Fonebird%2Fgithub%2Febook-mcp%2Fmcp-chat-ui%2Fbackend%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fonebird%2Fgithub%2Febook-mcp%2Fmcp-chat-ui%2Fbackend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/settings/route.ts":
/*!***************************************!*\
  !*** ./src/app/api/settings/route.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   OPTIONS: () => (/* binding */ OPTIONS),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   PUT: () => (/* binding */ PUT)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_security__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/security */ \"(rsc)/./src/lib/security.ts\");\n/* harmony import */ var _lib_errors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/errors */ \"(rsc)/./src/lib/errors.ts\");\n/* harmony import */ var _lib_validation__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/validation */ \"(rsc)/./src/lib/validation.ts\");\n/* harmony import */ var _services_SecureSettingsManager__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/services/SecureSettingsManager */ \"(rsc)/./src/services/SecureSettingsManager.ts\");\n\n\n\n\n\nasync function getSettingsHandler(request) {\n    const settingsManager = (0,_services_SecureSettingsManager__WEBPACK_IMPORTED_MODULE_4__.getSecureSettingsManager)();\n    await settingsManager.initialize();\n    const settings = await settingsManager.getSettings();\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(settings);\n}\nasync function updateSettingsHandler(request) {\n    let body;\n    try {\n        body = await request.json();\n    } catch (error) {\n        throw new _lib_errors__WEBPACK_IMPORTED_MODULE_2__.ValidationError('Invalid JSON in request body');\n    }\n    const validatedSettings = (0,_lib_validation__WEBPACK_IMPORTED_MODULE_3__.validateSettings)(body);\n    const settingsManager = (0,_services_SecureSettingsManager__WEBPACK_IMPORTED_MODULE_4__.getSecureSettingsManager)();\n    await settingsManager.initialize();\n    const updatedSettings = await settingsManager.updateSettings(validatedSettings);\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(updatedSettings);\n}\nasync function settingsHandler(request) {\n    switch(request.method){\n        case 'GET':\n            return getSettingsHandler(request);\n        case 'POST':\n        case 'PUT':\n            return updateSettingsHandler(request);\n        default:\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Method not allowed',\n                message: 'Only GET, POST, and PUT methods are allowed'\n            }, {\n                status: 405\n            });\n    }\n}\nconst GET = (0,_lib_security__WEBPACK_IMPORTED_MODULE_1__.withSecurity)(getSettingsHandler);\nconst POST = (0,_lib_security__WEBPACK_IMPORTED_MODULE_1__.withSecurity)(updateSettingsHandler);\nconst PUT = (0,_lib_security__WEBPACK_IMPORTED_MODULE_1__.withSecurity)(updateSettingsHandler);\nconst OPTIONS = (0,_lib_security__WEBPACK_IMPORTED_MODULE_1__.withSecurity)(async ()=>new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(null, {\n        status: 200\n    }));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9zZXR0aW5ncy9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBMkM7QUFDRztBQUNDO0FBQ0s7QUFDd0I7QUFFNUUsZUFBZUssbUJBQW1CQyxPQUFnQjtJQUNoRCxNQUFNQyxrQkFBa0JILHlGQUF3QkE7SUFDaEQsTUFBTUcsZ0JBQWdCQyxVQUFVO0lBRWhDLE1BQU1DLFdBQVcsTUFBTUYsZ0JBQWdCRyxXQUFXO0lBQ2xELE9BQU9WLHFEQUFZQSxDQUFDVyxJQUFJLENBQUNGO0FBQzNCO0FBRUEsZUFBZUcsc0JBQXNCTixPQUFnQjtJQUNuRCxJQUFJTztJQUNKLElBQUk7UUFDRkEsT0FBTyxNQUFNUCxRQUFRSyxJQUFJO0lBQzNCLEVBQUUsT0FBT0csT0FBTztRQUNkLE1BQU0sSUFBSVosd0RBQWVBLENBQUM7SUFDNUI7SUFFQSxNQUFNYSxvQkFBb0JaLGlFQUFnQkEsQ0FBQ1U7SUFFM0MsTUFBTU4sa0JBQWtCSCx5RkFBd0JBO0lBQ2hELE1BQU1HLGdCQUFnQkMsVUFBVTtJQUVoQyxNQUFNUSxrQkFBa0IsTUFBTVQsZ0JBQWdCVSxjQUFjLENBQUNGO0lBQzdELE9BQU9mLHFEQUFZQSxDQUFDVyxJQUFJLENBQUNLO0FBQzNCO0FBRUEsZUFBZUUsZ0JBQWdCWixPQUFnQjtJQUM3QyxPQUFRQSxRQUFRYSxNQUFNO1FBQ3BCLEtBQUs7WUFDSCxPQUFPZCxtQkFBbUJDO1FBQzVCLEtBQUs7UUFDTCxLQUFLO1lBQ0gsT0FBT00sc0JBQXNCTjtRQUMvQjtZQUNFLE9BQU9OLHFEQUFZQSxDQUFDVyxJQUFJLENBQ3RCO2dCQUFFRyxPQUFPO2dCQUFzQk0sU0FBUztZQUE4QyxHQUN0RjtnQkFBRUMsUUFBUTtZQUFJO0lBRXBCO0FBQ0Y7QUFFTyxNQUFNQyxNQUFNckIsMkRBQVlBLENBQUNJLG9CQUFvQjtBQUM3QyxNQUFNa0IsT0FBT3RCLDJEQUFZQSxDQUFDVyx1QkFBdUI7QUFDakQsTUFBTVksTUFBTXZCLDJEQUFZQSxDQUFDVyx1QkFBdUI7QUFDaEQsTUFBTWEsVUFBVXhCLDJEQUFZQSxDQUFDLFVBQVksSUFBSUQscURBQVlBLENBQUMsTUFBTTtRQUFFcUIsUUFBUTtJQUFJLElBQUkiLCJzb3VyY2VzIjpbIi9Vc2Vycy9vbmViaXJkL2dpdGh1Yi9lYm9vay1tY3AvbWNwLWNoYXQtdWkvYmFja2VuZC9zcmMvYXBwL2FwaS9zZXR0aW5ncy9yb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyB3aXRoU2VjdXJpdHkgfSBmcm9tICdAL2xpYi9zZWN1cml0eSc7XG5pbXBvcnQgeyBWYWxpZGF0aW9uRXJyb3IgfSBmcm9tICdAL2xpYi9lcnJvcnMnO1xuaW1wb3J0IHsgdmFsaWRhdGVTZXR0aW5ncyB9IGZyb20gJ0AvbGliL3ZhbGlkYXRpb24nO1xuaW1wb3J0IHsgZ2V0U2VjdXJlU2V0dGluZ3NNYW5hZ2VyIH0gZnJvbSAnQC9zZXJ2aWNlcy9TZWN1cmVTZXR0aW5nc01hbmFnZXInO1xuXG5hc3luYyBmdW5jdGlvbiBnZXRTZXR0aW5nc0hhbmRsZXIocmVxdWVzdDogUmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gIGNvbnN0IHNldHRpbmdzTWFuYWdlciA9IGdldFNlY3VyZVNldHRpbmdzTWFuYWdlcigpO1xuICBhd2FpdCBzZXR0aW5nc01hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICBcbiAgY29uc3Qgc2V0dGluZ3MgPSBhd2FpdCBzZXR0aW5nc01hbmFnZXIuZ2V0U2V0dGluZ3MoKTtcbiAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHNldHRpbmdzKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlU2V0dGluZ3NIYW5kbGVyKHJlcXVlc3Q6IFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICBsZXQgYm9keTtcbiAgdHJ5IHtcbiAgICBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignSW52YWxpZCBKU09OIGluIHJlcXVlc3QgYm9keScpO1xuICB9XG4gIFxuICBjb25zdCB2YWxpZGF0ZWRTZXR0aW5ncyA9IHZhbGlkYXRlU2V0dGluZ3MoYm9keSk7XG4gIFxuICBjb25zdCBzZXR0aW5nc01hbmFnZXIgPSBnZXRTZWN1cmVTZXR0aW5nc01hbmFnZXIoKTtcbiAgYXdhaXQgc2V0dGluZ3NNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgXG4gIGNvbnN0IHVwZGF0ZWRTZXR0aW5ncyA9IGF3YWl0IHNldHRpbmdzTWFuYWdlci51cGRhdGVTZXR0aW5ncyh2YWxpZGF0ZWRTZXR0aW5ncyk7XG4gIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih1cGRhdGVkU2V0dGluZ3MpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZXR0aW5nc0hhbmRsZXIocmVxdWVzdDogUmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gIHN3aXRjaCAocmVxdWVzdC5tZXRob2QpIHtcbiAgICBjYXNlICdHRVQnOlxuICAgICAgcmV0dXJuIGdldFNldHRpbmdzSGFuZGxlcihyZXF1ZXN0KTtcbiAgICBjYXNlICdQT1NUJzpcbiAgICBjYXNlICdQVVQnOlxuICAgICAgcmV0dXJuIHVwZGF0ZVNldHRpbmdzSGFuZGxlcihyZXF1ZXN0KTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnTWV0aG9kIG5vdCBhbGxvd2VkJywgbWVzc2FnZTogJ09ubHkgR0VULCBQT1NULCBhbmQgUFVUIG1ldGhvZHMgYXJlIGFsbG93ZWQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDUgfVxuICAgICAgKTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgR0VUID0gd2l0aFNlY3VyaXR5KGdldFNldHRpbmdzSGFuZGxlcik7XG5leHBvcnQgY29uc3QgUE9TVCA9IHdpdGhTZWN1cml0eSh1cGRhdGVTZXR0aW5nc0hhbmRsZXIpO1xuZXhwb3J0IGNvbnN0IFBVVCA9IHdpdGhTZWN1cml0eSh1cGRhdGVTZXR0aW5nc0hhbmRsZXIpO1xuZXhwb3J0IGNvbnN0IE9QVElPTlMgPSB3aXRoU2VjdXJpdHkoYXN5bmMgKCkgPT4gbmV3IE5leHRSZXNwb25zZShudWxsLCB7IHN0YXR1czogMjAwIH0pKTsiXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwid2l0aFNlY3VyaXR5IiwiVmFsaWRhdGlvbkVycm9yIiwidmFsaWRhdGVTZXR0aW5ncyIsImdldFNlY3VyZVNldHRpbmdzTWFuYWdlciIsImdldFNldHRpbmdzSGFuZGxlciIsInJlcXVlc3QiLCJzZXR0aW5nc01hbmFnZXIiLCJpbml0aWFsaXplIiwic2V0dGluZ3MiLCJnZXRTZXR0aW5ncyIsImpzb24iLCJ1cGRhdGVTZXR0aW5nc0hhbmRsZXIiLCJib2R5IiwiZXJyb3IiLCJ2YWxpZGF0ZWRTZXR0aW5ncyIsInVwZGF0ZWRTZXR0aW5ncyIsInVwZGF0ZVNldHRpbmdzIiwic2V0dGluZ3NIYW5kbGVyIiwibWV0aG9kIiwibWVzc2FnZSIsInN0YXR1cyIsIkdFVCIsIlBPU1QiLCJQVVQiLCJPUFRJT05TIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/settings/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/cors.ts":
/*!*************************!*\
  !*** ./src/lib/cors.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   corsHeaders: () => (/* binding */ corsHeaders),\n/* harmony export */   getSecurityHeaders: () => (/* binding */ getSecurityHeaders),\n/* harmony export */   handleCors: () => (/* binding */ handleCors),\n/* harmony export */   withCors: () => (/* binding */ withCors)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n\n// Development: Allow localhost with any port\n// Production: Use specific allowed origins\nconst isDevelopment = \"development\" !== 'production';\nconst LOCALHOST_PATTERN = /^http:\\/\\/localhost:\\d+$/;\nconst ALLOWED_PORTS = [\n    3000,\n    4173,\n    5173,\n    5174,\n    5175,\n    5176,\n    5177,\n    5178,\n    5179,\n    8080\n]; // Common dev ports\nconst PRODUCTION_ORIGINS = [\n    'https://your-domain.com'\n];\nfunction corsHeaders(origin) {\n    let allowedOrigin;\n    if (isDevelopment) {\n        if (origin && LOCALHOST_PATTERN.test(origin)) {\n            // In development, allow any localhost port\n            allowedOrigin = origin;\n        } else {\n            // Default to common dev server port\n            allowedOrigin = 'http://localhost:5173';\n        }\n    } else {\n        // In production, use strict origin checking\n        if (origin && PRODUCTION_ORIGINS.includes(origin)) {\n            allowedOrigin = origin;\n        } else {\n            allowedOrigin = PRODUCTION_ORIGINS[0] || 'http://localhost:5173';\n        }\n    }\n    const headers = {\n        // CORS headers\n        'Access-Control-Allow-Origin': allowedOrigin,\n        'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n        'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Requested-With',\n        'Access-Control-Allow-Credentials': 'true',\n        'Access-Control-Max-Age': '86400'\n    };\n    // Add security headers if enabled\n    if (process.env.SECURITY_HEADERS_ENABLED !== 'false') {\n        Object.assign(headers, getSecurityHeaders());\n    }\n    return headers;\n}\nfunction getSecurityHeaders() {\n    return {\n        // Prevent XSS attacks\n        'X-XSS-Protection': '1; mode=block',\n        // Prevent MIME type sniffing\n        'X-Content-Type-Options': 'nosniff',\n        // Prevent clickjacking\n        'X-Frame-Options': 'DENY',\n        // Referrer policy\n        'Referrer-Policy': 'strict-origin-when-cross-origin',\n        // Content Security Policy (restrictive for API)\n        'Content-Security-Policy': \"default-src 'none'; frame-ancestors 'none';\",\n        // Permissions policy\n        'Permissions-Policy': 'camera=(), microphone=(), geolocation=(), payment=()',\n        // HSTS (only in production with HTTPS)\n        ... false && 0\n    };\n}\nfunction handleCors(request) {\n    const origin = request.headers.get('origin');\n    return corsHeaders(origin || undefined);\n}\nfunction withCors(handler) {\n    return async (request, context)=>{\n        // Convert Request to NextRequest for CORS handling\n        const nextRequest = request;\n        const corsHeadersObj = handleCors(nextRequest);\n        if (request.method === 'OPTIONS') {\n            return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(null, {\n                status: 200,\n                headers: corsHeadersObj\n            });\n        }\n        try {\n            const response = await handler(request, context);\n            // Add CORS headers to the response\n            Object.entries(corsHeadersObj).forEach(([key, value])=>{\n                response.headers.set(key, value);\n            });\n            return response;\n        } catch (error) {\n            console.error('CORS Handler Error:', error);\n            // Return proper JSON error response\n            const statusCode = error instanceof Error && 'statusCode' in error ? error.statusCode : 500;\n            const errorMessage = error instanceof Error ? error.message : 'Internal Server Error';\n            const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: error instanceof Error ? error.name : 'Error',\n                message: errorMessage,\n                statusCode\n            }, {\n                status: statusCode\n            });\n            // Add CORS headers to error response\n            Object.entries(corsHeadersObj).forEach(([key, value])=>{\n                response.headers.set(key, value);\n            });\n            return response;\n        }\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixxQ0FBcUM7WUFDckN0QixPQUFPZSxPQUFPLENBQUNKLGdCQUFnQkssT0FBTyxDQUFDLENBQUMsQ0FBQ0MsS0FBS0MsTUFBTTtnQkFDbERKLFNBQVNqQixPQUFPLENBQUNzQixHQUFHLENBQUNGLEtBQUtDO1lBQzVCO1lBRUEsT0FBT0o7UUFDVDtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9vbmViaXJkL2dpdGh1Yi9lYm9vay1tY3AvbWNwLWNoYXQtdWkvYmFja2VuZC9zcmMvbGliL2NvcnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcblxuLy8gRGV2ZWxvcG1lbnQ6IEFsbG93IGxvY2FsaG9zdCB3aXRoIGFueSBwb3J0XG4vLyBQcm9kdWN0aW9uOiBVc2Ugc3BlY2lmaWMgYWxsb3dlZCBvcmlnaW5zXG5jb25zdCBpc0RldmVsb3BtZW50ID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJztcblxuY29uc3QgTE9DQUxIT1NUX1BBVFRFUk4gPSAvXmh0dHA6XFwvXFwvbG9jYWxob3N0OlxcZCskLztcbmNvbnN0IEFMTE9XRURfUE9SVFMgPSBbMzAwMCwgNDE3MywgNTE3MywgNTE3NCwgNTE3NSwgNTE3NiwgNTE3NywgNTE3OCwgNTE3OSwgODA4MF07IC8vIENvbW1vbiBkZXYgcG9ydHNcblxuY29uc3QgUFJPRFVDVElPTl9PUklHSU5TID0gW1xuICAnaHR0cHM6Ly95b3VyLWRvbWFpbi5jb20nLCAvLyBBZGQgeW91ciBwcm9kdWN0aW9uIGRvbWFpbiBoZXJlXG5dO1xuXG5leHBvcnQgZnVuY3Rpb24gY29yc0hlYWRlcnMob3JpZ2luPzogc3RyaW5nKSB7XG4gIGxldCBhbGxvd2VkT3JpZ2luOiBzdHJpbmc7XG4gIFxuICBpZiAoaXNEZXZlbG9wbWVudCkge1xuICAgIGlmIChvcmlnaW4gJiYgTE9DQUxIT1NUX1BBVFRFUk4udGVzdChvcmlnaW4pKSB7XG4gICAgICAvLyBJbiBkZXZlbG9wbWVudCwgYWxsb3cgYW55IGxvY2FsaG9zdCBwb3J0XG4gICAgICBhbGxvd2VkT3JpZ2luID0gb3JpZ2luO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBEZWZhdWx0IHRvIGNvbW1vbiBkZXYgc2VydmVyIHBvcnRcbiAgICAgIGFsbG93ZWRPcmlnaW4gPSAnaHR0cDovL2xvY2FsaG9zdDo1MTczJztcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgLy8gSW4gcHJvZHVjdGlvbiwgdXNlIHN0cmljdCBvcmlnaW4gY2hlY2tpbmdcbiAgICBpZiAob3JpZ2luICYmIFBST0RVQ1RJT05fT1JJR0lOUy5pbmNsdWRlcyhvcmlnaW4pKSB7XG4gICAgICBhbGxvd2VkT3JpZ2luID0gb3JpZ2luO1xuICAgIH0gZWxzZSB7XG4gICAgICBhbGxvd2VkT3JpZ2luID0gUFJPRFVDVElPTl9PUklHSU5TWzBdIHx8ICdodHRwOi8vbG9jYWxob3N0OjUxNzMnO1xuICAgIH1cbiAgfVxuICBcbiAgY29uc3QgaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAvLyBDT1JTIGhlYWRlcnNcbiAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJzogYWxsb3dlZE9yaWdpbixcbiAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctTWV0aG9kcyc6ICdHRVQsIFBPU1QsIFBVVCwgREVMRVRFLCBPUFRJT05TJyxcbiAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVycyc6ICdDb250ZW50LVR5cGUsIEF1dGhvcml6YXRpb24sIFgtUmVxdWVzdGVkLVdpdGgnLFxuICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1DcmVkZW50aWFscyc6ICd0cnVlJyxcbiAgICAnQWNjZXNzLUNvbnRyb2wtTWF4LUFnZSc6ICc4NjQwMCcsIC8vIDI0IGhvdXJzXG4gIH07XG5cbiAgLy8gQWRkIHNlY3VyaXR5IGhlYWRlcnMgaWYgZW5hYmxlZFxuICBpZiAocHJvY2Vzcy5lbnYuU0VDVVJJVFlfSEVBREVSU19FTkFCTEVEICE9PSAnZmFsc2UnKSB7XG4gICAgT2JqZWN0LmFzc2lnbihoZWFkZXJzLCBnZXRTZWN1cml0eUhlYWRlcnMoKSk7XG4gIH1cblxuICByZXR1cm4gaGVhZGVycztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFNlY3VyaXR5SGVhZGVycygpOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+IHtcbiAgcmV0dXJuIHtcbiAgICAvLyBQcmV2ZW50IFhTUyBhdHRhY2tzXG4gICAgJ1gtWFNTLVByb3RlY3Rpb24nOiAnMTsgbW9kZT1ibG9jaycsXG4gICAgXG4gICAgLy8gUHJldmVudCBNSU1FIHR5cGUgc25pZmZpbmdcbiAgICAnWC1Db250ZW50LVR5cGUtT3B0aW9ucyc6ICdub3NuaWZmJyxcbiAgICBcbiAgICAvLyBQcmV2ZW50IGNsaWNramFja2luZ1xuICAgICdYLUZyYW1lLU9wdGlvbnMnOiAnREVOWScsXG4gICAgXG4gICAgLy8gUmVmZXJyZXIgcG9saWN5XG4gICAgJ1JlZmVycmVyLVBvbGljeSc6ICdzdHJpY3Qtb3JpZ2luLXdoZW4tY3Jvc3Mtb3JpZ2luJyxcbiAgICBcbiAgICAvLyBDb250ZW50IFNlY3VyaXR5IFBvbGljeSAocmVzdHJpY3RpdmUgZm9yIEFQSSlcbiAgICAnQ29udGVudC1TZWN1cml0eS1Qb2xpY3knOiBcImRlZmF1bHQtc3JjICdub25lJzsgZnJhbWUtYW5jZXN0b3JzICdub25lJztcIixcbiAgICBcbiAgICAvLyBQZXJtaXNzaW9ucyBwb2xpY3lcbiAgICAnUGVybWlzc2lvbnMtUG9saWN5JzogJ2NhbWVyYT0oKSwgbWljcm9waG9uZT0oKSwgZ2VvbG9jYXRpb249KCksIHBheW1lbnQ9KCknLFxuICAgIFxuICAgIC8vIEhTVFMgKG9ubHkgaW4gcHJvZHVjdGlvbiB3aXRoIEhUVFBTKVxuICAgIC4uLihwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nICYmIHtcbiAgICAgICdTdHJpY3QtVHJhbnNwb3J0LVNlY3VyaXR5JzogJ21heC1hZ2U9MzE1MzYwMDA7IGluY2x1ZGVTdWJEb21haW5zOyBwcmVsb2FkJ1xuICAgIH0pLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlQ29ycyhyZXF1ZXN0OiBOZXh0UmVxdWVzdCk6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4ge1xuICBjb25zdCBvcmlnaW4gPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCdvcmlnaW4nKTtcbiAgcmV0dXJuIGNvcnNIZWFkZXJzKG9yaWdpbiB8fCB1bmRlZmluZWQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gd2l0aENvcnMoaGFuZGxlcjogKHJlcXVlc3Q6IFJlcXVlc3QsIGNvbnRleHQ/OiBhbnkpID0+IFByb21pc2U8TmV4dFJlc3BvbnNlPikge1xuICByZXR1cm4gYXN5bmMgKHJlcXVlc3Q6IFJlcXVlc3QsIGNvbnRleHQ/OiBhbnkpID0+IHtcbiAgICAvLyBDb252ZXJ0IFJlcXVlc3QgdG8gTmV4dFJlcXVlc3QgZm9yIENPUlMgaGFuZGxpbmdcbiAgICBjb25zdCBuZXh0UmVxdWVzdCA9IHJlcXVlc3QgYXMgTmV4dFJlcXVlc3Q7XG4gICAgY29uc3QgY29yc0hlYWRlcnNPYmogPSBoYW5kbGVDb3JzKG5leHRSZXF1ZXN0KTtcbiAgICBcbiAgICBpZiAocmVxdWVzdC5tZXRob2QgPT09ICdPUFRJT05TJykge1xuICAgICAgcmV0dXJuIG5ldyBOZXh0UmVzcG9uc2UobnVsbCwgeyBzdGF0dXM6IDIwMCwgaGVhZGVyczogY29yc0hlYWRlcnNPYmogfSk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaGFuZGxlcihyZXF1ZXN0LCBjb250ZXh0KTtcbiAgICAgIFxuICAgICAgLy8gQWRkIENPUlMgaGVhZGVycyB0byB0aGUgcmVzcG9uc2VcbiAgICAgIE9iamVjdC5lbnRyaWVzKGNvcnNIZWFkZXJzT2JqKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgcmVzcG9uc2UuaGVhZGVycy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdDT1JTIEhhbmRsZXIgRXJyb3I6JywgZXJyb3IpO1xuICAgICAgXG4gICAgICAvLyBSZXR1cm4gcHJvcGVyIEpTT04gZXJyb3IgcmVzcG9uc2VcbiAgICAgIGNvbnN0IHN0YXR1c0NvZGUgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yICYmICdzdGF0dXNDb2RlJyBpbiBlcnJvciA/IFxuICAgICAgICAoZXJyb3IgYXMgYW55KS5zdGF0dXNDb2RlIDogNTAwO1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnSW50ZXJuYWwgU2VydmVyIEVycm9yJztcbiAgICAgIFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubmFtZSA6ICdFcnJvcicsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3JNZXNzYWdlLFxuICAgICAgICAgIHN0YXR1c0NvZGUsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiBzdGF0dXNDb2RlIH1cbiAgICAgICk7XG4gICAgICBcbiAgICAgIC8vIEFkZCBDT1JTIGhlYWRlcnMgdG8gZXJyb3IgcmVzcG9uc2VcbiAgICAgIE9iamVjdC5lbnRyaWVzKGNvcnNIZWFkZXJzT2JqKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgcmVzcG9uc2UuaGVhZGVycy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH1cbiAgfTtcbn0iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiaXNEZXZlbG9wbWVudCIsInByb2Nlc3MiLCJMT0NBTEhPU1RfUEFUVEVSTiIsIkFMTE9XRURfUE9SVFMiLCJQUk9EVUNUSU9OX09SSUdJTlMiLCJjb3JzSGVhZGVycyIsIm9yaWdpbiIsImFsbG93ZWRPcmlnaW4iLCJ0ZXN0IiwiaW5jbHVkZXMiLCJoZWFkZXJzIiwiZW52IiwiU0VDVVJJVFlfSEVBREVSU19FTkFCTEVEIiwiT2JqZWN0IiwiYXNzaWduIiwiZ2V0U2VjdXJpdHlIZWFkZXJzIiwiaGFuZGxlQ29ycyIsInJlcXVlc3QiLCJnZXQiLCJ1bmRlZmluZWQiLCJ3aXRoQ29ycyIsImhhbmRsZXIiLCJjb250ZXh0IiwibmV4dFJlcXVlc3QiLCJjb3JzSGVhZGVyc09iaiIsIm1ldGhvZCIsInN0YXR1cyIsInJlc3BvbnNlIiwiZW50cmllcyIsImZvckVhY2giLCJrZXkiLCJ2YWx1ZSIsInNldCIsImVycm9yIiwiY29uc29sZSIsInN0YXR1c0NvZGUiLCJFcnJvciIsImVycm9yTWVzc2FnZSIsIm1lc3NhZ2UiLCJqc29uIiwibmFtZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/cors.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/encryption.ts":
/*!*******************************!*\
  !*** ./src/lib/encryption.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EncryptionService: () => (/* binding */ EncryptionService),\n/* harmony export */   getEncryptionService: () => (/* binding */ getEncryptionService)\n/* harmony export */ });\n/* harmony import */ var crypto_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto-js */ \"(rsc)/./node_modules/crypto-js/index.js\");\n/* harmony import */ var crypto_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _errors__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./errors */ \"(rsc)/./src/lib/errors.ts\");\n\n\n/**\n * Encryption utility for securing sensitive data like API keys\n */ class EncryptionService {\n    constructor(){\n        // Get encryption key from environment or generate a default one\n        this.secretKey = process.env.ENCRYPTION_KEY || this.generateDefaultKey();\n        if (!process.env.ENCRYPTION_KEY) {\n            console.warn('ENCRYPTION_KEY not set in environment. Using generated key. This is not secure for production!');\n        }\n    }\n    /**\n   * Encrypt sensitive data\n   */ encrypt(data) {\n        try {\n            if (!data) return '';\n            const encrypted = crypto_js__WEBPACK_IMPORTED_MODULE_0___default().AES.encrypt(data, this.secretKey).toString();\n            return encrypted;\n        } catch (error) {\n            console.error('Encryption failed:', error);\n            throw new _errors__WEBPACK_IMPORTED_MODULE_1__.InternalServerError('Failed to encrypt data');\n        }\n    }\n    /**\n   * Decrypt sensitive data\n   */ decrypt(encryptedData) {\n        try {\n            if (!encryptedData) return '';\n            const bytes = crypto_js__WEBPACK_IMPORTED_MODULE_0___default().AES.decrypt(encryptedData, this.secretKey);\n            const decrypted = bytes.toString((crypto_js__WEBPACK_IMPORTED_MODULE_0___default().enc).Utf8);\n            if (!decrypted) {\n                throw new Error('Failed to decrypt data - invalid key or corrupted data');\n            }\n            return decrypted;\n        } catch (error) {\n            console.error('Decryption failed:', error);\n            throw new _errors__WEBPACK_IMPORTED_MODULE_1__.InternalServerError('Failed to decrypt data');\n        }\n    }\n    /**\n   * Hash data for secure comparison (one-way)\n   */ hash(data) {\n        try {\n            return crypto_js__WEBPACK_IMPORTED_MODULE_0___default().SHA256(data).toString();\n        } catch (error) {\n            console.error('Hashing failed:', error);\n            throw new _errors__WEBPACK_IMPORTED_MODULE_1__.InternalServerError('Failed to hash data');\n        }\n    }\n    /**\n   * Generate a secure random key\n   */ generateSecureKey() {\n        return crypto_js__WEBPACK_IMPORTED_MODULE_0___default().lib.WordArray.random(256 / 8).toString();\n    }\n    /**\n   * Mask sensitive data for display (show only last 4 characters with limited mask length)\n   */ maskApiKey(apiKey) {\n        if (!apiKey || apiKey.length < 8) {\n            return '';\n        }\n        const visibleChars = 4;\n        const maxMaskLength = 8; // Limit mask length to prevent UI overflow\n        const actualMaskLength = Math.min(maxMaskLength, Math.max(0, apiKey.length - visibleChars));\n        const maskedPart = ''.repeat(actualMaskLength);\n        const visiblePart = apiKey.slice(-visibleChars);\n        return maskedPart + visiblePart;\n    }\n    /**\n   * Validate if a string appears to be encrypted\n   */ isEncrypted(data) {\n        try {\n            // Try to decrypt - if it fails, it's likely not encrypted\n            this.decrypt(data);\n            return true;\n        } catch  {\n            return false;\n        }\n    }\n    generateDefaultKey() {\n        // Generate a consistent but unique key based on system info\n        // This is NOT secure for production - should use proper environment variable\n        const systemInfo = process.platform + process.arch + (process.env.HOME || process.env.USERPROFILE || 'default');\n        return crypto_js__WEBPACK_IMPORTED_MODULE_0___default().SHA256(systemInfo + 'mcp-chat-ui-default-key').toString();\n    }\n}\n// Singleton instance\nlet encryptionService = null;\nfunction getEncryptionService() {\n    if (!encryptionService) {\n        encryptionService = new EncryptionService();\n    }\n    return encryptionService;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDRjtBQUVBLHFCQUFxQjtBQUNyQixJQUFJa0Msb0JBQThDO0FBRTNDLFNBQVNDO0lBQ2QsSUFBSSxDQUFDRCxtQkFBbUI7UUFDdEJBLG9CQUFvQixJQUFJOUM7SUFDMUI7SUFDQSxPQUFPOEM7QUFDVCIsInNvdXJjZXMiOlsiL1VzZXJzL29uZWJpcmQvZ2l0aHViL2Vib29rLW1jcC9tY3AtY2hhdC11aS9iYWNrZW5kL3NyYy9saWIvZW5jcnlwdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ3J5cHRvSlMgZnJvbSAnY3J5cHRvLWpzJztcbmltcG9ydCB7IEludGVybmFsU2VydmVyRXJyb3IgfSBmcm9tICcuL2Vycm9ycyc7XG5cbi8qKlxuICogRW5jcnlwdGlvbiB1dGlsaXR5IGZvciBzZWN1cmluZyBzZW5zaXRpdmUgZGF0YSBsaWtlIEFQSSBrZXlzXG4gKi9cbmV4cG9ydCBjbGFzcyBFbmNyeXB0aW9uU2VydmljZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgc2VjcmV0S2V5OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgLy8gR2V0IGVuY3J5cHRpb24ga2V5IGZyb20gZW52aXJvbm1lbnQgb3IgZ2VuZXJhdGUgYSBkZWZhdWx0IG9uZVxuICAgIHRoaXMuc2VjcmV0S2V5ID0gcHJvY2Vzcy5lbnYuRU5DUllQVElPTl9LRVkgfHwgdGhpcy5nZW5lcmF0ZURlZmF1bHRLZXkoKTtcbiAgICBcbiAgICBpZiAoIXByb2Nlc3MuZW52LkVOQ1JZUFRJT05fS0VZKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0VOQ1JZUFRJT05fS0VZIG5vdCBzZXQgaW4gZW52aXJvbm1lbnQuIFVzaW5nIGdlbmVyYXRlZCBrZXkuIFRoaXMgaXMgbm90IHNlY3VyZSBmb3IgcHJvZHVjdGlvbiEnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRW5jcnlwdCBzZW5zaXRpdmUgZGF0YVxuICAgKi9cbiAgZW5jcnlwdChkYXRhOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHRyeSB7XG4gICAgICBpZiAoIWRhdGEpIHJldHVybiAnJztcbiAgICAgIFxuICAgICAgY29uc3QgZW5jcnlwdGVkID0gQ3J5cHRvSlMuQUVTLmVuY3J5cHQoZGF0YSwgdGhpcy5zZWNyZXRLZXkpLnRvU3RyaW5nKCk7XG4gICAgICByZXR1cm4gZW5jcnlwdGVkO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFbmNyeXB0aW9uIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvcignRmFpbGVkIHRvIGVuY3J5cHQgZGF0YScpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEZWNyeXB0IHNlbnNpdGl2ZSBkYXRhXG4gICAqL1xuICBkZWNyeXB0KGVuY3J5cHRlZERhdGE6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICghZW5jcnlwdGVkRGF0YSkgcmV0dXJuICcnO1xuICAgICAgXG4gICAgICBjb25zdCBieXRlcyA9IENyeXB0b0pTLkFFUy5kZWNyeXB0KGVuY3J5cHRlZERhdGEsIHRoaXMuc2VjcmV0S2V5KTtcbiAgICAgIGNvbnN0IGRlY3J5cHRlZCA9IGJ5dGVzLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5VdGY4KTtcbiAgICAgIFxuICAgICAgaWYgKCFkZWNyeXB0ZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gZGVjcnlwdCBkYXRhIC0gaW52YWxpZCBrZXkgb3IgY29ycnVwdGVkIGRhdGEnKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIGRlY3J5cHRlZDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRGVjcnlwdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3IoJ0ZhaWxlZCB0byBkZWNyeXB0IGRhdGEnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGFzaCBkYXRhIGZvciBzZWN1cmUgY29tcGFyaXNvbiAob25lLXdheSlcbiAgICovXG4gIGhhc2goZGF0YTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIENyeXB0b0pTLlNIQTI1NihkYXRhKS50b1N0cmluZygpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdIYXNoaW5nIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvcignRmFpbGVkIHRvIGhhc2ggZGF0YScpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBhIHNlY3VyZSByYW5kb20ga2V5XG4gICAqL1xuICBnZW5lcmF0ZVNlY3VyZUtleSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBDcnlwdG9KUy5saWIuV29yZEFycmF5LnJhbmRvbSgyNTYvOCkudG9TdHJpbmcoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNYXNrIHNlbnNpdGl2ZSBkYXRhIGZvciBkaXNwbGF5IChzaG93IG9ubHkgbGFzdCA0IGNoYXJhY3RlcnMgd2l0aCBsaW1pdGVkIG1hc2sgbGVuZ3RoKVxuICAgKi9cbiAgbWFza0FwaUtleShhcGlLZXk6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKCFhcGlLZXkgfHwgYXBpS2V5Lmxlbmd0aCA8IDgpIHtcbiAgICAgIHJldHVybiAn4oCi4oCi4oCi4oCiJztcbiAgICB9XG4gICAgXG4gICAgY29uc3QgdmlzaWJsZUNoYXJzID0gNDtcbiAgICBjb25zdCBtYXhNYXNrTGVuZ3RoID0gODsgLy8gTGltaXQgbWFzayBsZW5ndGggdG8gcHJldmVudCBVSSBvdmVyZmxvd1xuICAgIGNvbnN0IGFjdHVhbE1hc2tMZW5ndGggPSBNYXRoLm1pbihtYXhNYXNrTGVuZ3RoLCBNYXRoLm1heCgwLCBhcGlLZXkubGVuZ3RoIC0gdmlzaWJsZUNoYXJzKSk7XG4gICAgY29uc3QgbWFza2VkUGFydCA9ICfigKInLnJlcGVhdChhY3R1YWxNYXNrTGVuZ3RoKTtcbiAgICBjb25zdCB2aXNpYmxlUGFydCA9IGFwaUtleS5zbGljZSgtdmlzaWJsZUNoYXJzKTtcbiAgICBcbiAgICByZXR1cm4gbWFza2VkUGFydCArIHZpc2libGVQYXJ0O1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIGlmIGEgc3RyaW5nIGFwcGVhcnMgdG8gYmUgZW5jcnlwdGVkXG4gICAqL1xuICBpc0VuY3J5cHRlZChkYXRhOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICB0cnkge1xuICAgICAgLy8gVHJ5IHRvIGRlY3J5cHQgLSBpZiBpdCBmYWlscywgaXQncyBsaWtlbHkgbm90IGVuY3J5cHRlZFxuICAgICAgdGhpcy5kZWNyeXB0KGRhdGEpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZURlZmF1bHRLZXkoKTogc3RyaW5nIHtcbiAgICAvLyBHZW5lcmF0ZSBhIGNvbnNpc3RlbnQgYnV0IHVuaXF1ZSBrZXkgYmFzZWQgb24gc3lzdGVtIGluZm9cbiAgICAvLyBUaGlzIGlzIE5PVCBzZWN1cmUgZm9yIHByb2R1Y3Rpb24gLSBzaG91bGQgdXNlIHByb3BlciBlbnZpcm9ubWVudCB2YXJpYWJsZVxuICAgIGNvbnN0IHN5c3RlbUluZm8gPSBwcm9jZXNzLnBsYXRmb3JtICsgcHJvY2Vzcy5hcmNoICsgKHByb2Nlc3MuZW52LkhPTUUgfHwgcHJvY2Vzcy5lbnYuVVNFUlBST0ZJTEUgfHwgJ2RlZmF1bHQnKTtcbiAgICByZXR1cm4gQ3J5cHRvSlMuU0hBMjU2KHN5c3RlbUluZm8gKyAnbWNwLWNoYXQtdWktZGVmYXVsdC1rZXknKS50b1N0cmluZygpO1xuICB9XG59XG5cbi8vIFNpbmdsZXRvbiBpbnN0YW5jZVxubGV0IGVuY3J5cHRpb25TZXJ2aWNlOiBFbmNyeXB0aW9uU2VydmljZSB8IG51bGwgPSBudWxsO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RW5jcnlwdGlvblNlcnZpY2UoKTogRW5jcnlwdGlvblNlcnZpY2Uge1xuICBpZiAoIWVuY3J5cHRpb25TZXJ2aWNlKSB7XG4gICAgZW5jcnlwdGlvblNlcnZpY2UgPSBuZXcgRW5jcnlwdGlvblNlcnZpY2UoKTtcbiAgfVxuICByZXR1cm4gZW5jcnlwdGlvblNlcnZpY2U7XG59Il0sIm5hbWVzIjpbIkNyeXB0b0pTIiwiSW50ZXJuYWxTZXJ2ZXJFcnJvciIsIkVuY3J5cHRpb25TZXJ2aWNlIiwic2VjcmV0S2V5IiwicHJvY2VzcyIsImVudiIsIkVOQ1JZUFRJT05fS0VZIiwiZ2VuZXJhdGVEZWZhdWx0S2V5IiwiY29uc29sZSIsIndhcm4iLCJlbmNyeXB0IiwiZGF0YSIsImVuY3J5cHRlZCIsIkFFUyIsInRvU3RyaW5nIiwiZXJyb3IiLCJkZWNyeXB0IiwiZW5jcnlwdGVkRGF0YSIsImJ5dGVzIiwiZGVjcnlwdGVkIiwiZW5jIiwiVXRmOCIsIkVycm9yIiwiaGFzaCIsIlNIQTI1NiIsImdlbmVyYXRlU2VjdXJlS2V5IiwibGliIiwiV29yZEFycmF5IiwicmFuZG9tIiwibWFza0FwaUtleSIsImFwaUtleSIsImxlbmd0aCIsInZpc2libGVDaGFycyIsIm1heE1hc2tMZW5ndGgiLCJhY3R1YWxNYXNrTGVuZ3RoIiwiTWF0aCIsIm1pbiIsIm1heCIsIm1hc2tlZFBhcnQiLCJyZXBlYXQiLCJ2aXNpYmxlUGFydCIsInNsaWNlIiwiaXNFbmNyeXB0ZWQiLCJzeXN0ZW1JbmZvIiwicGxhdGZvcm0iLCJhcmNoIiwiSE9NRSIsIlVTRVJQUk9GSUxFIiwiZW5jcnlwdGlvblNlcnZpY2UiLCJnZXRFbmNyeXB0aW9uU2VydmljZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/encryption.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/errors.ts":
/*!***************************!*\
  !*** ./src/lib/errors.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AppError: () => (/* binding */ AppError),\n/* harmony export */   InternalServerError: () => (/* binding */ InternalServerError),\n/* harmony export */   NotFoundError: () => (/* binding */ NotFoundError),\n/* harmony export */   ToolExecutionError: () => (/* binding */ ToolExecutionError),\n/* harmony export */   UnauthorizedError: () => (/* binding */ UnauthorizedError),\n/* harmony export */   ValidationError: () => (/* binding */ ValidationError),\n/* harmony export */   createErrorResponse: () => (/* binding */ createErrorResponse),\n/* harmony export */   handleAsyncRoute: () => (/* binding */ handleAsyncRoute)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n\nclass AppError extends Error {\n    constructor(message, statusCode = 500, isOperational = true){\n        super(message);\n        this.statusCode = statusCode;\n        this.isOperational = isOperational;\n        Error.captureStackTrace(this, this.constructor);\n    }\n}\nclass ValidationError extends AppError {\n    constructor(message){\n        super(message, 400);\n    }\n}\nclass NotFoundError extends AppError {\n    constructor(message = 'Resource not found'){\n        super(message, 404);\n    }\n}\nclass UnauthorizedError extends AppError {\n    constructor(message = 'Unauthorized'){\n        super(message, 401);\n    }\n}\nclass InternalServerError extends AppError {\n    constructor(message = 'Internal server error'){\n        super(message, 500);\n    }\n}\nclass ToolExecutionError extends AppError {\n    constructor(message, statusCode = 500){\n        super(message, statusCode);\n    }\n}\nfunction createErrorResponse(error) {\n    console.error('API Error:', error);\n    if (error instanceof AppError) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: error.constructor.name,\n            message: error.message,\n            statusCode: error.statusCode\n        }, {\n            status: error.statusCode\n        });\n    }\n    if (error instanceof Error) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'InternalServerError',\n            message: error.message,\n            statusCode: 500\n        }, {\n            status: 500\n        });\n    }\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        error: 'UnknownError',\n        message: 'An unknown error occurred',\n        statusCode: 500\n    }, {\n        status: 500\n    });\n}\nfunction handleAsyncRoute(handler) {\n    return async (request, context)=>{\n        try {\n            return await handler(request, context);\n        } catch (error) {\n            return createErrorResponse(error);\n        }\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2Vycm9ycy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBd0Q7QUFHakQsTUFBTUMsaUJBQWlCQztJQUk1QixZQUFZQyxPQUFlLEVBQUVDLGFBQXFCLEdBQUcsRUFBRUMsZ0JBQXlCLElBQUksQ0FBRTtRQUNwRixLQUFLLENBQUNGO1FBQ04sSUFBSSxDQUFDQyxVQUFVLEdBQUdBO1FBQ2xCLElBQUksQ0FBQ0MsYUFBYSxHQUFHQTtRQUVyQkgsTUFBTUksaUJBQWlCLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxXQUFXO0lBQ2hEO0FBQ0Y7QUFFTyxNQUFNQyx3QkFBd0JOO0lBQ25DLFlBQVlFLE9BQWUsQ0FBRTtRQUMzQixLQUFLLENBQUNBLFNBQVM7SUFDakI7QUFDRjtBQUVPLE1BQU1LLHNCQUFzQlA7SUFDakMsWUFBWUUsVUFBa0Isb0JBQW9CLENBQUU7UUFDbEQsS0FBSyxDQUFDQSxTQUFTO0lBQ2pCO0FBQ0Y7QUFFTyxNQUFNTSwwQkFBMEJSO0lBQ3JDLFlBQVlFLFVBQWtCLGNBQWMsQ0FBRTtRQUM1QyxLQUFLLENBQUNBLFNBQVM7SUFDakI7QUFDRjtBQUVPLE1BQU1PLDRCQUE0QlQ7SUFDdkMsWUFBWUUsVUFBa0IsdUJBQXVCLENBQUU7UUFDckQsS0FBSyxDQUFDQSxTQUFTO0lBQ2pCO0FBQ0Y7QUFFTyxNQUFNUSwyQkFBMkJWO0lBQ3RDLFlBQVlFLE9BQWUsRUFBRUMsYUFBcUIsR0FBRyxDQUFFO1FBQ3JELEtBQUssQ0FBQ0QsU0FBU0M7SUFDakI7QUFDRjtBQUVPLFNBQVNRLG9CQUFvQkMsS0FBYztJQUNoREMsUUFBUUQsS0FBSyxDQUFDLGNBQWNBO0lBRTVCLElBQUlBLGlCQUFpQlosVUFBVTtRQUM3QixPQUFPRCxxREFBWUEsQ0FBQ2UsSUFBSSxDQUN0QjtZQUNFRixPQUFPQSxNQUFNLFdBQVcsQ0FBQ0csSUFBSTtZQUM3QmIsU0FBU1UsTUFBTVYsT0FBTztZQUN0QkMsWUFBWVMsTUFBTVQsVUFBVTtRQUM5QixHQUNBO1lBQUVhLFFBQVFKLE1BQU1ULFVBQVU7UUFBQztJQUUvQjtJQUVBLElBQUlTLGlCQUFpQlgsT0FBTztRQUMxQixPQUFPRixxREFBWUEsQ0FBQ2UsSUFBSSxDQUN0QjtZQUNFRixPQUFPO1lBQ1BWLFNBQVNVLE1BQU1WLE9BQU87WUFDdEJDLFlBQVk7UUFDZCxHQUNBO1lBQUVhLFFBQVE7UUFBSTtJQUVsQjtJQUVBLE9BQU9qQixxREFBWUEsQ0FBQ2UsSUFBSSxDQUN0QjtRQUNFRixPQUFPO1FBQ1BWLFNBQVM7UUFDVEMsWUFBWTtJQUNkLEdBQ0E7UUFBRWEsUUFBUTtJQUFJO0FBRWxCO0FBRU8sU0FBU0MsaUJBQ2RDLE9BQW1FO0lBRW5FLE9BQU8sT0FBT0MsU0FBa0JDO1FBQzlCLElBQUk7WUFDRixPQUFPLE1BQU1GLFFBQVFDLFNBQVNDO1FBQ2hDLEVBQUUsT0FBT1IsT0FBTztZQUNkLE9BQU9ELG9CQUFvQkM7UUFDN0I7SUFDRjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvb25lYmlyZC9naXRodWIvZWJvb2stbWNwL21jcC1jaGF0LXVpL2JhY2tlbmQvc3JjL2xpYi9lcnJvcnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IEFwaUVycm9yIH0gZnJvbSAnQC90eXBlcyc7XG5cbmV4cG9ydCBjbGFzcyBBcHBFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgcHVibGljIHN0YXR1c0NvZGU6IG51bWJlcjtcbiAgcHVibGljIGlzT3BlcmF0aW9uYWw6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nLCBzdGF0dXNDb2RlOiBudW1iZXIgPSA1MDAsIGlzT3BlcmF0aW9uYWw6IGJvb2xlYW4gPSB0cnVlKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gICAgdGhpcy5zdGF0dXNDb2RlID0gc3RhdHVzQ29kZTtcbiAgICB0aGlzLmlzT3BlcmF0aW9uYWwgPSBpc09wZXJhdGlvbmFsO1xuXG4gICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgdGhpcy5jb25zdHJ1Y3Rvcik7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFZhbGlkYXRpb25FcnJvciBleHRlbmRzIEFwcEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nKSB7XG4gICAgc3VwZXIobWVzc2FnZSwgNDAwKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgTm90Rm91bmRFcnJvciBleHRlbmRzIEFwcEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nID0gJ1Jlc291cmNlIG5vdCBmb3VuZCcpIHtcbiAgICBzdXBlcihtZXNzYWdlLCA0MDQpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBVbmF1dGhvcml6ZWRFcnJvciBleHRlbmRzIEFwcEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nID0gJ1VuYXV0aG9yaXplZCcpIHtcbiAgICBzdXBlcihtZXNzYWdlLCA0MDEpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBJbnRlcm5hbFNlcnZlckVycm9yIGV4dGVuZHMgQXBwRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcgPSAnSW50ZXJuYWwgc2VydmVyIGVycm9yJykge1xuICAgIHN1cGVyKG1lc3NhZ2UsIDUwMCk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFRvb2xFeGVjdXRpb25FcnJvciBleHRlbmRzIEFwcEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nLCBzdGF0dXNDb2RlOiBudW1iZXIgPSA1MDApIHtcbiAgICBzdXBlcihtZXNzYWdlLCBzdGF0dXNDb2RlKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRXJyb3JSZXNwb25zZShlcnJvcjogdW5rbm93bik6IE5leHRSZXNwb25zZTxBcGlFcnJvcj4ge1xuICBjb25zb2xlLmVycm9yKCdBUEkgRXJyb3I6JywgZXJyb3IpO1xuXG4gIGlmIChlcnJvciBpbnN0YW5jZW9mIEFwcEVycm9yKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAge1xuICAgICAgICBlcnJvcjogZXJyb3IuY29uc3RydWN0b3IubmFtZSxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyb3Iuc3RhdHVzQ29kZSxcbiAgICAgIH0sXG4gICAgICB7IHN0YXR1czogZXJyb3Iuc3RhdHVzQ29kZSB9XG4gICAgKTtcbiAgfVxuXG4gIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAge1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsU2VydmVyRXJyb3InLFxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICBzdGF0dXNDb2RlOiA1MDAsXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxuXG4gIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICB7XG4gICAgICBlcnJvcjogJ1Vua25vd25FcnJvcicsXG4gICAgICBtZXNzYWdlOiAnQW4gdW5rbm93biBlcnJvciBvY2N1cnJlZCcsXG4gICAgICBzdGF0dXNDb2RlOiA1MDAsXG4gICAgfSxcbiAgICB7IHN0YXR1czogNTAwIH1cbiAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZUFzeW5jUm91dGUoXG4gIGhhbmRsZXI6IChyZXF1ZXN0OiBSZXF1ZXN0LCBjb250ZXh0PzogYW55KSA9PiBQcm9taXNlPE5leHRSZXNwb25zZT5cbikge1xuICByZXR1cm4gYXN5bmMgKHJlcXVlc3Q6IFJlcXVlc3QsIGNvbnRleHQ/OiBhbnkpID0+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGhhbmRsZXIocmVxdWVzdCwgY29udGV4dCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiBjcmVhdGVFcnJvclJlc3BvbnNlKGVycm9yKTtcbiAgICB9XG4gIH07XG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIkFwcEVycm9yIiwiRXJyb3IiLCJtZXNzYWdlIiwic3RhdHVzQ29kZSIsImlzT3BlcmF0aW9uYWwiLCJjYXB0dXJlU3RhY2tUcmFjZSIsIlZhbGlkYXRpb25FcnJvciIsIk5vdEZvdW5kRXJyb3IiLCJVbmF1dGhvcml6ZWRFcnJvciIsIkludGVybmFsU2VydmVyRXJyb3IiLCJUb29sRXhlY3V0aW9uRXJyb3IiLCJjcmVhdGVFcnJvclJlc3BvbnNlIiwiZXJyb3IiLCJjb25zb2xlIiwianNvbiIsIm5hbWUiLCJzdGF0dXMiLCJoYW5kbGVBc3luY1JvdXRlIiwiaGFuZGxlciIsInJlcXVlc3QiLCJjb250ZXh0Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/errors.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/rateLimit.ts":
/*!******************************!*\
  !*** ./src/lib/rateLimit.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   validateAndSanitizeInput: () => (/* binding */ validateAndSanitizeInput),\n/* harmony export */   validateJsonInput: () => (/* binding */ validateJsonInput),\n/* harmony export */   withRateLimit: () => (/* binding */ withRateLimit)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _errors__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./errors */ \"(rsc)/./src/lib/errors.ts\");\n\n\nclass RateLimiter {\n    constructor(windowMs = 15 * 60 * 1000, maxRequests = 100){\n        this.requests = new Map();\n        this.windowMs = windowMs;\n        this.maxRequests = maxRequests;\n        // Clean up expired entries every 5 minutes\n        this.cleanupInterval = setInterval(()=>{\n            this.cleanup();\n        }, 5 * 60 * 1000);\n    }\n    /**\n   * Check if request is within rate limit\n   */ checkLimit(identifier) {\n        const now = Date.now();\n        const entry = this.requests.get(identifier);\n        if (!entry || now > entry.resetTime) {\n            // First request or window expired\n            const resetTime = now + this.windowMs;\n            this.requests.set(identifier, {\n                count: 1,\n                resetTime\n            });\n            return {\n                allowed: true,\n                remaining: this.maxRequests - 1,\n                resetTime\n            };\n        }\n        if (entry.count >= this.maxRequests) {\n            // Rate limit exceeded\n            return {\n                allowed: false,\n                remaining: 0,\n                resetTime: entry.resetTime\n            };\n        }\n        // Increment count\n        entry.count++;\n        this.requests.set(identifier, entry);\n        return {\n            allowed: true,\n            remaining: this.maxRequests - entry.count,\n            resetTime: entry.resetTime\n        };\n    }\n    /**\n   * Clean up expired entries\n   */ cleanup() {\n        const now = Date.now();\n        for (const [key, entry] of this.requests.entries()){\n            if (now > entry.resetTime) {\n                this.requests.delete(key);\n            }\n        }\n    }\n    /**\n   * Shutdown the rate limiter\n   */ shutdown() {\n        if (this.cleanupInterval) {\n            clearInterval(this.cleanupInterval);\n            this.cleanupInterval = undefined;\n        }\n    }\n}\n// Global rate limiter instance\nlet rateLimiter = null;\nfunction getRateLimiter() {\n    if (!rateLimiter) {\n        const windowMs = parseInt(process.env.RATE_LIMIT_WINDOW_MS || '900000'); // 15 minutes\n        const maxRequests = parseInt(process.env.RATE_LIMIT_MAX_REQUESTS || '100');\n        rateLimiter = new RateLimiter(windowMs, maxRequests);\n    }\n    return rateLimiter;\n}\n/**\n * Get client identifier for rate limiting\n */ function getClientIdentifier(request) {\n    // Try to get real IP from various headers (for reverse proxy setups)\n    const forwarded = request.headers.get('x-forwarded-for');\n    const realIp = request.headers.get('x-real-ip');\n    const cfConnectingIp = request.headers.get('cf-connecting-ip');\n    const ip = forwarded?.split(',')[0] || realIp || cfConnectingIp || request.ip || 'unknown';\n    // In development, use a more permissive identifier\n    if (true) {\n        return `dev-${ip}`;\n    }\n    return ip;\n}\n/**\n * Rate limiting middleware\n */ function withRateLimit(handler, options = {}) {\n    return async (request, context)=>{\n        // Skip rate limiting if disabled\n        if (process.env.RATE_LIMIT_ENABLED === 'false') {\n            return handler(request, context);\n        }\n        const nextRequest = request;\n        const identifier = getClientIdentifier(nextRequest);\n        const limiter = getRateLimiter();\n        const { allowed, remaining, resetTime } = limiter.checkLimit(identifier);\n        if (!allowed) {\n            const resetDate = new Date(resetTime);\n            const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Rate limit exceeded',\n                message: `Too many requests. Try again after ${resetDate.toISOString()}`,\n                statusCode: 429\n            }, {\n                status: 429\n            });\n            // Add rate limit headers\n            response.headers.set('X-RateLimit-Limit', limiter['maxRequests'].toString());\n            response.headers.set('X-RateLimit-Remaining', remaining.toString());\n            response.headers.set('X-RateLimit-Reset', Math.ceil(resetTime / 1000).toString());\n            response.headers.set('Retry-After', Math.ceil((resetTime - Date.now()) / 1000).toString());\n            return response;\n        }\n        try {\n            const response = await handler(request, context);\n            // Add rate limit headers to successful responses\n            response.headers.set('X-RateLimit-Limit', limiter['maxRequests'].toString());\n            response.headers.set('X-RateLimit-Remaining', remaining.toString());\n            response.headers.set('X-RateLimit-Reset', Math.ceil(resetTime / 1000).toString());\n            return response;\n        } catch (error) {\n            console.error('Rate Limited Handler Error:', error);\n            // Ensure we return a proper JSON error response\n            if (error instanceof Error && 'statusCode' in error) {\n                const statusCode = error.statusCode || 500;\n                const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: error.name || 'Error',\n                    message: error.message,\n                    statusCode\n                }, {\n                    status: statusCode\n                });\n                // Add rate limit headers to error responses too\n                response.headers.set('X-RateLimit-Limit', limiter['maxRequests'].toString());\n                response.headers.set('X-RateLimit-Remaining', remaining.toString());\n                response.headers.set('X-RateLimit-Reset', Math.ceil(resetTime / 1000).toString());\n                return response;\n            }\n            throw error;\n        }\n    };\n}\n/**\n * Enhanced input validation with rate limiting considerations\n */ function validateAndSanitizeInput(input, maxLength = 10000) {\n    if (typeof input !== 'string') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_1__.ValidationError('Input must be a string');\n    }\n    if (input.length > maxLength) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_1__.ValidationError(`Input too long. Maximum length is ${maxLength} characters`);\n    }\n    // Basic XSS prevention\n    const sanitized = input.replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, '').replace(/javascript:/gi, '').replace(/on\\w+\\s*=/gi, '').replace(/data:text\\/html/gi, '').trim();\n    return sanitized;\n}\n/**\n * Validate JSON input with size limits\n */ function validateJsonInput(input, maxSize = 1024 * 1024) {\n    if (input.length > maxSize) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_1__.ValidationError(`JSON input too large. Maximum size is ${maxSize} bytes`);\n    }\n    try {\n        return JSON.parse(input);\n    } catch (error) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_1__.ValidationError('Invalid JSON format');\n    }\n}\n// Cleanup on process exit\nprocess.on('SIGTERM', ()=>{\n    if (rateLimiter) {\n        rateLimiter.shutdown();\n    }\n});\nprocess.on('SIGINT', ()=>{\n    if (rateLimiter) {\n        rateLimiter.shutdown();\n    }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFVLEVBQUVDLFlBQW9CLEtBQUs7SUFDNUUsSUFBSSxPQUFPRCxVQUFVLFVBQVU7UUFDN0IsTUFBTSxJQUFJL0Qsb0RBQWVBLENBQUM7SUFDNUI7SUFFQSxJQUFJK0QsTUFBTUUsTUFBTSxHQUFHRCxXQUFXO1FBQzVCLE1BQU0sSUFBSWhFLG9EQUFlQSxDQUFDLENBQUMsa0NBQWtDLEVBQUVnRSxVQUFVLFdBQVcsQ0FBQztJQUN2RjtJQUVBLHVCQUF1QjtJQUN2QixNQUFNRSxZQUFZSCxNQUNmSSxPQUFPLENBQUMsdURBQXVELElBQy9EQSxPQUFPLENBQUMsaUJBQWlCLElBQ3pCQSxPQUFPLENBQUMsZUFBZSxJQUN2QkEsT0FBTyxDQUFDLHFCQUFxQixJQUM3QkMsSUFBSTtJQUVQLE9BQU9GO0FBQ1Q7QUFFQTs7Q0FFQyxHQUNNLFNBQVNHLGtCQUFrQk4sS0FBYSxFQUFFTyxVQUFrQixPQUFPLElBQUk7SUFDNUUsSUFBSVAsTUFBTUUsTUFBTSxHQUFHSyxTQUFTO1FBQzFCLE1BQU0sSUFBSXRFLG9EQUFlQSxDQUFDLENBQUMsc0NBQXNDLEVBQUVzRSxRQUFRLE1BQU0sQ0FBQztJQUNwRjtJQUVBLElBQUk7UUFDRixPQUFPQyxLQUFLQyxLQUFLLENBQUNUO0lBQ3BCLEVBQUUsT0FBT1osT0FBTztRQUNkLE1BQU0sSUFBSW5ELG9EQUFlQSxDQUFDO0lBQzVCO0FBQ0Y7QUFFQSwwQkFBMEI7QUFDMUI2QixRQUFRNEMsRUFBRSxDQUFDLFdBQVc7SUFDcEIsSUFBSS9DLGFBQWE7UUFDZkEsWUFBWUgsUUFBUTtJQUN0QjtBQUNGO0FBRUFNLFFBQVE0QyxFQUFFLENBQUMsVUFBVTtJQUNuQixJQUFJL0MsYUFBYTtRQUNmQSxZQUFZSCxRQUFRO0lBQ3RCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9vbmViaXJkL2dpdGh1Yi9lYm9vay1tY3AvbWNwLWNoYXQtdWkvYmFja2VuZC9zcmMvbGliL3JhdGVMaW1pdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgVmFsaWRhdGlvbkVycm9yIH0gZnJvbSAnLi9lcnJvcnMnO1xuXG5pbnRlcmZhY2UgUmF0ZUxpbWl0RW50cnkge1xuICBjb3VudDogbnVtYmVyO1xuICByZXNldFRpbWU6IG51bWJlcjtcbn1cblxuY2xhc3MgUmF0ZUxpbWl0ZXIge1xuICBwcml2YXRlIHJlcXVlc3RzID0gbmV3IE1hcDxzdHJpbmcsIFJhdGVMaW1pdEVudHJ5PigpO1xuICBwcml2YXRlIHJlYWRvbmx5IHdpbmRvd01zOiBudW1iZXI7XG4gIHByaXZhdGUgcmVhZG9ubHkgbWF4UmVxdWVzdHM6IG51bWJlcjtcbiAgcHJpdmF0ZSBjbGVhbnVwSW50ZXJ2YWw/OiBOb2RlSlMuVGltZW91dDtcblxuICBjb25zdHJ1Y3Rvcih3aW5kb3dNczogbnVtYmVyID0gMTUgKiA2MCAqIDEwMDAsIG1heFJlcXVlc3RzOiBudW1iZXIgPSAxMDApIHtcbiAgICB0aGlzLndpbmRvd01zID0gd2luZG93TXM7XG4gICAgdGhpcy5tYXhSZXF1ZXN0cyA9IG1heFJlcXVlc3RzO1xuICAgIFxuICAgIC8vIENsZWFuIHVwIGV4cGlyZWQgZW50cmllcyBldmVyeSA1IG1pbnV0ZXNcbiAgICB0aGlzLmNsZWFudXBJbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgIHRoaXMuY2xlYW51cCgpO1xuICAgIH0sIDUgKiA2MCAqIDEwMDApO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHJlcXVlc3QgaXMgd2l0aGluIHJhdGUgbGltaXRcbiAgICovXG4gIGNoZWNrTGltaXQoaWRlbnRpZmllcjogc3RyaW5nKTogeyBhbGxvd2VkOiBib29sZWFuOyByZW1haW5pbmc6IG51bWJlcjsgcmVzZXRUaW1lOiBudW1iZXIgfSB7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCBlbnRyeSA9IHRoaXMucmVxdWVzdHMuZ2V0KGlkZW50aWZpZXIpO1xuXG4gICAgaWYgKCFlbnRyeSB8fCBub3cgPiBlbnRyeS5yZXNldFRpbWUpIHtcbiAgICAgIC8vIEZpcnN0IHJlcXVlc3Qgb3Igd2luZG93IGV4cGlyZWRcbiAgICAgIGNvbnN0IHJlc2V0VGltZSA9IG5vdyArIHRoaXMud2luZG93TXM7XG4gICAgICB0aGlzLnJlcXVlc3RzLnNldChpZGVudGlmaWVyLCB7IGNvdW50OiAxLCByZXNldFRpbWUgfSk7XG4gICAgICByZXR1cm4geyBhbGxvd2VkOiB0cnVlLCByZW1haW5pbmc6IHRoaXMubWF4UmVxdWVzdHMgLSAxLCByZXNldFRpbWUgfTtcbiAgICB9XG5cbiAgICBpZiAoZW50cnkuY291bnQgPj0gdGhpcy5tYXhSZXF1ZXN0cykge1xuICAgICAgLy8gUmF0ZSBsaW1pdCBleGNlZWRlZFxuICAgICAgcmV0dXJuIHsgYWxsb3dlZDogZmFsc2UsIHJlbWFpbmluZzogMCwgcmVzZXRUaW1lOiBlbnRyeS5yZXNldFRpbWUgfTtcbiAgICB9XG5cbiAgICAvLyBJbmNyZW1lbnQgY291bnRcbiAgICBlbnRyeS5jb3VudCsrO1xuICAgIHRoaXMucmVxdWVzdHMuc2V0KGlkZW50aWZpZXIsIGVudHJ5KTtcbiAgICByZXR1cm4geyBhbGxvd2VkOiB0cnVlLCByZW1haW5pbmc6IHRoaXMubWF4UmVxdWVzdHMgLSBlbnRyeS5jb3VudCwgcmVzZXRUaW1lOiBlbnRyeS5yZXNldFRpbWUgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbiB1cCBleHBpcmVkIGVudHJpZXNcbiAgICovXG4gIHByaXZhdGUgY2xlYW51cCgpOiB2b2lkIHtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGZvciAoY29uc3QgW2tleSwgZW50cnldIG9mIHRoaXMucmVxdWVzdHMuZW50cmllcygpKSB7XG4gICAgICBpZiAobm93ID4gZW50cnkucmVzZXRUaW1lKSB7XG4gICAgICAgIHRoaXMucmVxdWVzdHMuZGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNodXRkb3duIHRoZSByYXRlIGxpbWl0ZXJcbiAgICovXG4gIHNodXRkb3duKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmNsZWFudXBJbnRlcnZhbCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmNsZWFudXBJbnRlcnZhbCk7XG4gICAgICB0aGlzLmNsZWFudXBJbnRlcnZhbCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cbn1cblxuLy8gR2xvYmFsIHJhdGUgbGltaXRlciBpbnN0YW5jZVxubGV0IHJhdGVMaW1pdGVyOiBSYXRlTGltaXRlciB8IG51bGwgPSBudWxsO1xuXG5mdW5jdGlvbiBnZXRSYXRlTGltaXRlcigpOiBSYXRlTGltaXRlciB7XG4gIGlmICghcmF0ZUxpbWl0ZXIpIHtcbiAgICBjb25zdCB3aW5kb3dNcyA9IHBhcnNlSW50KHByb2Nlc3MuZW52LlJBVEVfTElNSVRfV0lORE9XX01TIHx8ICc5MDAwMDAnKTsgLy8gMTUgbWludXRlc1xuICAgIGNvbnN0IG1heFJlcXVlc3RzID0gcGFyc2VJbnQocHJvY2Vzcy5lbnYuUkFURV9MSU1JVF9NQVhfUkVRVUVTVFMgfHwgJzEwMCcpO1xuICAgIHJhdGVMaW1pdGVyID0gbmV3IFJhdGVMaW1pdGVyKHdpbmRvd01zLCBtYXhSZXF1ZXN0cyk7XG4gIH1cbiAgcmV0dXJuIHJhdGVMaW1pdGVyO1xufVxuXG4vKipcbiAqIEdldCBjbGllbnQgaWRlbnRpZmllciBmb3IgcmF0ZSBsaW1pdGluZ1xuICovXG5mdW5jdGlvbiBnZXRDbGllbnRJZGVudGlmaWVyKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KTogc3RyaW5nIHtcbiAgLy8gVHJ5IHRvIGdldCByZWFsIElQIGZyb20gdmFyaW91cyBoZWFkZXJzIChmb3IgcmV2ZXJzZSBwcm94eSBzZXR1cHMpXG4gIGNvbnN0IGZvcndhcmRlZCA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ3gtZm9yd2FyZGVkLWZvcicpO1xuICBjb25zdCByZWFsSXAgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LXJlYWwtaXAnKTtcbiAgY29uc3QgY2ZDb25uZWN0aW5nSXAgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCdjZi1jb25uZWN0aW5nLWlwJyk7XG4gIFxuICBjb25zdCBpcCA9IGZvcndhcmRlZD8uc3BsaXQoJywnKVswXSB8fCByZWFsSXAgfHwgY2ZDb25uZWN0aW5nSXAgfHwgXG4gICAgICAgICAgICAgcmVxdWVzdC5pcCB8fCAndW5rbm93bic7XG4gIFxuICAvLyBJbiBkZXZlbG9wbWVudCwgdXNlIGEgbW9yZSBwZXJtaXNzaXZlIGlkZW50aWZpZXJcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gICAgcmV0dXJuIGBkZXYtJHtpcH1gO1xuICB9XG4gIFxuICByZXR1cm4gaXA7XG59XG5cbi8qKlxuICogUmF0ZSBsaW1pdGluZyBtaWRkbGV3YXJlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3aXRoUmF0ZUxpbWl0KFxuICBoYW5kbGVyOiAocmVxdWVzdDogUmVxdWVzdCwgY29udGV4dD86IGFueSkgPT4gUHJvbWlzZTxOZXh0UmVzcG9uc2U+LFxuICBvcHRpb25zOiB7IHdpbmRvd01zPzogbnVtYmVyOyBtYXhSZXF1ZXN0cz86IG51bWJlciB9ID0ge31cbikge1xuICByZXR1cm4gYXN5bmMgKHJlcXVlc3Q6IFJlcXVlc3QsIGNvbnRleHQ/OiBhbnkpID0+IHtcbiAgICAvLyBTa2lwIHJhdGUgbGltaXRpbmcgaWYgZGlzYWJsZWRcbiAgICBpZiAocHJvY2Vzcy5lbnYuUkFURV9MSU1JVF9FTkFCTEVEID09PSAnZmFsc2UnKSB7XG4gICAgICByZXR1cm4gaGFuZGxlcihyZXF1ZXN0LCBjb250ZXh0KTtcbiAgICB9XG5cbiAgICBjb25zdCBuZXh0UmVxdWVzdCA9IHJlcXVlc3QgYXMgTmV4dFJlcXVlc3Q7XG4gICAgY29uc3QgaWRlbnRpZmllciA9IGdldENsaWVudElkZW50aWZpZXIobmV4dFJlcXVlc3QpO1xuICAgIGNvbnN0IGxpbWl0ZXIgPSBnZXRSYXRlTGltaXRlcigpO1xuICAgIFxuICAgIGNvbnN0IHsgYWxsb3dlZCwgcmVtYWluaW5nLCByZXNldFRpbWUgfSA9IGxpbWl0ZXIuY2hlY2tMaW1pdChpZGVudGlmaWVyKTtcbiAgICBcbiAgICBpZiAoIWFsbG93ZWQpIHtcbiAgICAgIGNvbnN0IHJlc2V0RGF0ZSA9IG5ldyBEYXRlKHJlc2V0VGltZSk7XG4gICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgZXJyb3I6ICdSYXRlIGxpbWl0IGV4Y2VlZGVkJyxcbiAgICAgICAgICBtZXNzYWdlOiBgVG9vIG1hbnkgcmVxdWVzdHMuIFRyeSBhZ2FpbiBhZnRlciAke3Jlc2V0RGF0ZS50b0lTT1N0cmluZygpfWAsXG4gICAgICAgICAgc3RhdHVzQ29kZTogNDI5LFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDI5IH1cbiAgICAgICk7XG4gICAgICBcbiAgICAgIC8vIEFkZCByYXRlIGxpbWl0IGhlYWRlcnNcbiAgICAgIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdYLVJhdGVMaW1pdC1MaW1pdCcsIGxpbWl0ZXJbJ21heFJlcXVlc3RzJ10udG9TdHJpbmcoKSk7XG4gICAgICByZXNwb25zZS5oZWFkZXJzLnNldCgnWC1SYXRlTGltaXQtUmVtYWluaW5nJywgcmVtYWluaW5nLnRvU3RyaW5nKCkpO1xuICAgICAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtUmF0ZUxpbWl0LVJlc2V0JywgTWF0aC5jZWlsKHJlc2V0VGltZSAvIDEwMDApLnRvU3RyaW5nKCkpO1xuICAgICAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1JldHJ5LUFmdGVyJywgTWF0aC5jZWlsKChyZXNldFRpbWUgLSBEYXRlLm5vdygpKSAvIDEwMDApLnRvU3RyaW5nKCkpO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaGFuZGxlcihyZXF1ZXN0LCBjb250ZXh0KTtcbiAgICAgIFxuICAgICAgLy8gQWRkIHJhdGUgbGltaXQgaGVhZGVycyB0byBzdWNjZXNzZnVsIHJlc3BvbnNlc1xuICAgICAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtUmF0ZUxpbWl0LUxpbWl0JywgbGltaXRlclsnbWF4UmVxdWVzdHMnXS50b1N0cmluZygpKTtcbiAgICAgIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdYLVJhdGVMaW1pdC1SZW1haW5pbmcnLCByZW1haW5pbmcudG9TdHJpbmcoKSk7XG4gICAgICByZXNwb25zZS5oZWFkZXJzLnNldCgnWC1SYXRlTGltaXQtUmVzZXQnLCBNYXRoLmNlaWwocmVzZXRUaW1lIC8gMTAwMCkudG9TdHJpbmcoKSk7XG4gICAgICBcbiAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignUmF0ZSBMaW1pdGVkIEhhbmRsZXIgRXJyb3I6JywgZXJyb3IpO1xuICAgICAgXG4gICAgICAvLyBFbnN1cmUgd2UgcmV0dXJuIGEgcHJvcGVyIEpTT04gZXJyb3IgcmVzcG9uc2VcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yICYmICdzdGF0dXNDb2RlJyBpbiBlcnJvcikge1xuICAgICAgICBjb25zdCBzdGF0dXNDb2RlID0gKGVycm9yIGFzIGFueSkuc3RhdHVzQ29kZSB8fCA1MDA7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgZXJyb3I6IGVycm9yLm5hbWUgfHwgJ0Vycm9yJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgICBzdGF0dXNDb2RlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IHN0YXR1c0NvZGUgfVxuICAgICAgICApO1xuICAgICAgICBcbiAgICAgICAgLy8gQWRkIHJhdGUgbGltaXQgaGVhZGVycyB0byBlcnJvciByZXNwb25zZXMgdG9vXG4gICAgICAgIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdYLVJhdGVMaW1pdC1MaW1pdCcsIGxpbWl0ZXJbJ21heFJlcXVlc3RzJ10udG9TdHJpbmcoKSk7XG4gICAgICAgIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdYLVJhdGVMaW1pdC1SZW1haW5pbmcnLCByZW1haW5pbmcudG9TdHJpbmcoKSk7XG4gICAgICAgIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdYLVJhdGVMaW1pdC1SZXNldCcsIE1hdGguY2VpbChyZXNldFRpbWUgLyAxMDAwKS50b1N0cmluZygpKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9O1xufVxuXG4vKipcbiAqIEVuaGFuY2VkIGlucHV0IHZhbGlkYXRpb24gd2l0aCByYXRlIGxpbWl0aW5nIGNvbnNpZGVyYXRpb25zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUFuZFNhbml0aXplSW5wdXQoaW5wdXQ6IGFueSwgbWF4TGVuZ3RoOiBudW1iZXIgPSAxMDAwMCk6IHN0cmluZyB7XG4gIGlmICh0eXBlb2YgaW5wdXQgIT09ICdzdHJpbmcnKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignSW5wdXQgbXVzdCBiZSBhIHN0cmluZycpO1xuICB9XG4gIFxuICBpZiAoaW5wdXQubGVuZ3RoID4gbWF4TGVuZ3RoKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihgSW5wdXQgdG9vIGxvbmcuIE1heGltdW0gbGVuZ3RoIGlzICR7bWF4TGVuZ3RofSBjaGFyYWN0ZXJzYCk7XG4gIH1cbiAgXG4gIC8vIEJhc2ljIFhTUyBwcmV2ZW50aW9uXG4gIGNvbnN0IHNhbml0aXplZCA9IGlucHV0XG4gICAgLnJlcGxhY2UoLzxzY3JpcHRcXGJbXjxdKig/Oig/ITxcXC9zY3JpcHQ+KTxbXjxdKikqPFxcL3NjcmlwdD4vZ2ksICcnKVxuICAgIC5yZXBsYWNlKC9qYXZhc2NyaXB0Oi9naSwgJycpXG4gICAgLnJlcGxhY2UoL29uXFx3K1xccyo9L2dpLCAnJylcbiAgICAucmVwbGFjZSgvZGF0YTp0ZXh0XFwvaHRtbC9naSwgJycpXG4gICAgLnRyaW0oKTtcbiAgXG4gIHJldHVybiBzYW5pdGl6ZWQ7XG59XG5cbi8qKlxuICogVmFsaWRhdGUgSlNPTiBpbnB1dCB3aXRoIHNpemUgbGltaXRzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUpzb25JbnB1dChpbnB1dDogc3RyaW5nLCBtYXhTaXplOiBudW1iZXIgPSAxMDI0ICogMTAyNCk6IGFueSB7XG4gIGlmIChpbnB1dC5sZW5ndGggPiBtYXhTaXplKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihgSlNPTiBpbnB1dCB0b28gbGFyZ2UuIE1heGltdW0gc2l6ZSBpcyAke21heFNpemV9IGJ5dGVzYCk7XG4gIH1cbiAgXG4gIHRyeSB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UoaW5wdXQpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ0ludmFsaWQgSlNPTiBmb3JtYXQnKTtcbiAgfVxufVxuXG4vLyBDbGVhbnVwIG9uIHByb2Nlc3MgZXhpdFxucHJvY2Vzcy5vbignU0lHVEVSTScsICgpID0+IHtcbiAgaWYgKHJhdGVMaW1pdGVyKSB7XG4gICAgcmF0ZUxpbWl0ZXIuc2h1dGRvd24oKTtcbiAgfVxufSk7XG5cbnByb2Nlc3Mub24oJ1NJR0lOVCcsICgpID0+IHtcbiAgaWYgKHJhdGVMaW1pdGVyKSB7XG4gICAgcmF0ZUxpbWl0ZXIuc2h1dGRvd24oKTtcbiAgfVxufSk7Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIlZhbGlkYXRpb25FcnJvciIsIlJhdGVMaW1pdGVyIiwid2luZG93TXMiLCJtYXhSZXF1ZXN0cyIsInJlcXVlc3RzIiwiTWFwIiwiY2xlYW51cEludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJjbGVhbnVwIiwiY2hlY2tMaW1pdCIsImlkZW50aWZpZXIiLCJub3ciLCJEYXRlIiwiZW50cnkiLCJnZXQiLCJyZXNldFRpbWUiLCJzZXQiLCJjb3VudCIsImFsbG93ZWQiLCJyZW1haW5pbmciLCJrZXkiLCJlbnRyaWVzIiwiZGVsZXRlIiwic2h1dGRvd24iLCJjbGVhckludGVydmFsIiwidW5kZWZpbmVkIiwicmF0ZUxpbWl0ZXIiLCJnZXRSYXRlTGltaXRlciIsInBhcnNlSW50IiwicHJvY2VzcyIsImVudiIsIlJBVEVfTElNSVRfV0lORE9XX01TIiwiUkFURV9MSU1JVF9NQVhfUkVRVUVTVFMiLCJnZXRDbGllbnRJZGVudGlmaWVyIiwicmVxdWVzdCIsImZvcndhcmRlZCIsImhlYWRlcnMiLCJyZWFsSXAiLCJjZkNvbm5lY3RpbmdJcCIsImlwIiwic3BsaXQiLCJ3aXRoUmF0ZUxpbWl0IiwiaGFuZGxlciIsIm9wdGlvbnMiLCJjb250ZXh0IiwiUkFURV9MSU1JVF9FTkFCTEVEIiwibmV4dFJlcXVlc3QiLCJsaW1pdGVyIiwicmVzZXREYXRlIiwicmVzcG9uc2UiLCJqc29uIiwiZXJyb3IiLCJtZXNzYWdlIiwidG9JU09TdHJpbmciLCJzdGF0dXNDb2RlIiwic3RhdHVzIiwidG9TdHJpbmciLCJNYXRoIiwiY2VpbCIsImNvbnNvbGUiLCJFcnJvciIsIm5hbWUiLCJ2YWxpZGF0ZUFuZFNhbml0aXplSW5wdXQiLCJpbnB1dCIsIm1heExlbmd0aCIsImxlbmd0aCIsInNhbml0aXplZCIsInJlcGxhY2UiLCJ0cmltIiwidmFsaWRhdGVKc29uSW5wdXQiLCJtYXhTaXplIiwiSlNPTiIsInBhcnNlIiwib24iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/rateLimit.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/security.ts":
/*!*****************************!*\
  !*** ./src/lib/security.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addSecurityHeaders: () => (/* binding */ addSecurityHeaders),\n/* harmony export */   generateSecureToken: () => (/* binding */ generateSecureToken),\n/* harmony export */   logSecurityEvent: () => (/* binding */ logSecurityEvent),\n/* harmony export */   sanitizeRequestBody: () => (/* binding */ sanitizeRequestBody),\n/* harmony export */   validateFileUpload: () => (/* binding */ validateFileUpload),\n/* harmony export */   withSecurity: () => (/* binding */ withSecurity)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _cors__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./cors */ \"(rsc)/./src/lib/cors.ts\");\n/* harmony import */ var _rateLimit__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./rateLimit */ \"(rsc)/./src/lib/rateLimit.ts\");\n/* harmony import */ var _errors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./errors */ \"(rsc)/./src/lib/errors.ts\");\n\n\n\n\n/**\n * Comprehensive security middleware that combines all security features\n */ function withSecurity(handler, options = {}) {\n    const { rateLimit = true, cors = true, validation = true, maxBodySize = 1024 * 1024 } = options;\n    let secureHandler = handler;\n    // Apply validation middleware\n    if (validation) {\n        secureHandler = withValidation(secureHandler, {\n            maxBodySize\n        });\n    }\n    // Apply rate limiting\n    if (rateLimit) {\n        secureHandler = (0,_rateLimit__WEBPACK_IMPORTED_MODULE_2__.withRateLimit)(secureHandler);\n    }\n    // Apply CORS\n    if (cors) {\n        secureHandler = (0,_cors__WEBPACK_IMPORTED_MODULE_1__.withCors)(secureHandler);\n    }\n    // Apply error handling\n    secureHandler = (0,_errors__WEBPACK_IMPORTED_MODULE_3__.handleAsyncRoute)(secureHandler);\n    return secureHandler;\n}\n/**\n * Input validation middleware\n */ function withValidation(handler, options) {\n    return async (request, context)=>{\n        const nextRequest = request;\n        // Check content length\n        const contentLength = nextRequest.headers.get('content-length');\n        if (contentLength && parseInt(contentLength) > options.maxBodySize) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Payload too large',\n                message: `Request body exceeds maximum size of ${options.maxBodySize} bytes`,\n                statusCode: 413\n            }, {\n                status: 413\n            });\n        }\n        // Validate content type for POST/PUT requests\n        if ([\n            'POST',\n            'PUT',\n            'PATCH'\n        ].includes(request.method)) {\n            const contentType = nextRequest.headers.get('content-type');\n            if (contentType && !contentType.includes('application/json')) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: 'Invalid content type',\n                    message: 'Content-Type must be application/json',\n                    statusCode: 415\n                }, {\n                    status: 415\n                });\n            }\n        }\n        // Check for suspicious headers\n        const suspiciousHeaders = [\n            'x-forwarded-host',\n            'x-original-url',\n            'x-rewrite-url'\n        ];\n        for (const header of suspiciousHeaders){\n            if (nextRequest.headers.get(header)) {\n                console.warn(` Suspicious header detected: ${header}`, {\n                    url: request.url,\n                    ip: nextRequest.headers.get('x-forwarded-for') || 'unknown',\n                    userAgent: nextRequest.headers.get('user-agent') || 'unknown'\n                });\n            }\n        }\n        // Validate URL path\n        const url = new URL(request.url);\n        if (containsSuspiciousPatterns(url.pathname)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Invalid request',\n                message: 'Request contains suspicious patterns',\n                statusCode: 400\n            }, {\n                status: 400\n            });\n        }\n        return handler(request, context);\n    };\n}\n/**\n * Check for suspicious patterns in URL paths\n */ function containsSuspiciousPatterns(path) {\n    const suspiciousPatterns = [\n        /\\.\\./,\n        /\\/\\//,\n        /%2e%2e/i,\n        /%00/i,\n        /\\x00/,\n        /<script/i,\n        /javascript:/i,\n        /vbscript:/i,\n        /data:text\\/html/i,\n        /on\\w+=/i\n    ];\n    return suspiciousPatterns.some((pattern)=>pattern.test(path));\n}\n/**\n * Security headers for API responses\n */ function addSecurityHeaders(response) {\n    // Remove server information\n    response.headers.delete('server');\n    response.headers.delete('x-powered-by');\n    // Add security headers\n    response.headers.set('X-Content-Type-Options', 'nosniff');\n    response.headers.set('X-Frame-Options', 'DENY');\n    response.headers.set('X-XSS-Protection', '1; mode=block');\n    response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');\n    response.headers.set('Permissions-Policy', 'camera=(), microphone=(), geolocation=()');\n    // Content Security Policy for API\n    response.headers.set('Content-Security-Policy', \"default-src 'none'; frame-ancestors 'none';\");\n    // HSTS in production\n    if (false) {}\n    return response;\n}\n/**\n * Sanitize request body to prevent injection attacks\n */ function sanitizeRequestBody(body) {\n    if (typeof body === 'string') {\n        return sanitizeString(body);\n    }\n    if (Array.isArray(body)) {\n        return body.map((item)=>sanitizeRequestBody(item));\n    }\n    if (body && typeof body === 'object') {\n        const sanitized = {};\n        for (const [key, value] of Object.entries(body)){\n            // Sanitize keys\n            const sanitizedKey = sanitizeString(key);\n            sanitized[sanitizedKey] = sanitizeRequestBody(value);\n        }\n        return sanitized;\n    }\n    return body;\n}\n/**\n * Sanitize string values\n */ function sanitizeString(str) {\n    if (typeof str !== 'string') {\n        return str;\n    }\n    // Remove dangerous patterns\n    return str.replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, '').replace(/<iframe\\b[^<]*(?:(?!<\\/iframe>)<[^<]*)*<\\/iframe>/gi, '').replace(/javascript:/gi, '').replace(/vbscript:/gi, '').replace(/data:text\\/html/gi, '').replace(/on\\w+\\s*=/gi, '').trim();\n}\n/**\n * Log security events\n */ function logSecurityEvent(event, details) {\n    const logEntry = {\n        timestamp: new Date().toISOString(),\n        event,\n        severity: details.severity || 'medium',\n        ip: details.ip || 'unknown',\n        userAgent: details.userAgent || 'unknown',\n        ...details\n    };\n    // In production, this would go to a proper logging service\n    if (details.severity === 'high') {\n        console.error(' HIGH SEVERITY SECURITY EVENT:', logEntry);\n    } else if (details.severity === 'medium') {\n        console.warn(' SECURITY EVENT:', logEntry);\n    } else {\n        console.info(' Security event:', logEntry);\n    }\n}\n/**\n * Validate file upload (if needed in the future)\n */ function validateFileUpload(file, options = {}) {\n    const { maxSize = 10 * 1024 * 1024, allowedTypes = [\n        'application/json',\n        'text/plain'\n    ], allowedExtensions = [\n        '.json',\n        '.txt'\n    ] } = options;\n    if (file.size > maxSize) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_3__.ValidationError(`File size exceeds maximum of ${maxSize} bytes`);\n    }\n    if (!allowedTypes.includes(file.type)) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_3__.ValidationError(`File type ${file.type} is not allowed`);\n    }\n    const extension = file.name.toLowerCase().substring(file.name.lastIndexOf('.'));\n    if (!allowedExtensions.includes(extension)) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_3__.ValidationError(`File extension ${extension} is not allowed`);\n    }\n}\n/**\n * Generate secure random tokens\n */ function generateSecureToken(length = 32) {\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    let result = '';\n    // Use crypto.getRandomValues if available (browser/Node.js)\n    if (typeof crypto !== 'undefined' && crypto.getRandomValues) {\n        const array = new Uint8Array(length);\n        crypto.getRandomValues(array);\n        for(let i = 0; i < length; i++){\n            result += chars[array[i] % chars.length];\n        }\n    } else {\n        // Fallback to Math.random (less secure)\n        for(let i = 0; i < length; i++){\n            result += chars[Math.floor(Math.random() * chars.length)];\n        }\n    }\n    return result;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZC9naXRodWIvZWJvb2stbWNwL21jcC1jaGF0LXVpL2JhY2tlbmQvc3JjL2xpYi9zZWN1cml0eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgd2l0aENvcnMgfSBmcm9tICcuL2NvcnMnO1xuaW1wb3J0IHsgd2l0aFJhdGVMaW1pdCB9IGZyb20gJy4vcmF0ZUxpbWl0JztcbmltcG9ydCB7IGhhbmRsZUFzeW5jUm91dGUsIFZhbGlkYXRpb25FcnJvciB9IGZyb20gJy4vZXJyb3JzJztcblxuLyoqXG4gKiBDb21wcmVoZW5zaXZlIHNlY3VyaXR5IG1pZGRsZXdhcmUgdGhhdCBjb21iaW5lcyBhbGwgc2VjdXJpdHkgZmVhdHVyZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhTZWN1cml0eShcbiAgaGFuZGxlcjogKHJlcXVlc3Q6IFJlcXVlc3QsIGNvbnRleHQ/OiBhbnkpID0+IFByb21pc2U8TmV4dFJlc3BvbnNlPixcbiAgb3B0aW9uczoge1xuICAgIHJhdGVMaW1pdD86IGJvb2xlYW47XG4gICAgY29ycz86IGJvb2xlYW47XG4gICAgdmFsaWRhdGlvbj86IGJvb2xlYW47XG4gICAgbWF4Qm9keVNpemU/OiBudW1iZXI7XG4gIH0gPSB7fVxuKSB7XG4gIGNvbnN0IHtcbiAgICByYXRlTGltaXQgPSB0cnVlLFxuICAgIGNvcnMgPSB0cnVlLFxuICAgIHZhbGlkYXRpb24gPSB0cnVlLFxuICAgIG1heEJvZHlTaXplID0gMTAyNCAqIDEwMjQsIC8vIDFNQiBkZWZhdWx0XG4gIH0gPSBvcHRpb25zO1xuXG4gIGxldCBzZWN1cmVIYW5kbGVyID0gaGFuZGxlcjtcblxuICAvLyBBcHBseSB2YWxpZGF0aW9uIG1pZGRsZXdhcmVcbiAgaWYgKHZhbGlkYXRpb24pIHtcbiAgICBzZWN1cmVIYW5kbGVyID0gd2l0aFZhbGlkYXRpb24oc2VjdXJlSGFuZGxlciwgeyBtYXhCb2R5U2l6ZSB9KTtcbiAgfVxuXG4gIC8vIEFwcGx5IHJhdGUgbGltaXRpbmdcbiAgaWYgKHJhdGVMaW1pdCkge1xuICAgIHNlY3VyZUhhbmRsZXIgPSB3aXRoUmF0ZUxpbWl0KHNlY3VyZUhhbmRsZXIpO1xuICB9XG5cbiAgLy8gQXBwbHkgQ09SU1xuICBpZiAoY29ycykge1xuICAgIHNlY3VyZUhhbmRsZXIgPSB3aXRoQ29ycyhzZWN1cmVIYW5kbGVyKTtcbiAgfVxuXG4gIC8vIEFwcGx5IGVycm9yIGhhbmRsaW5nXG4gIHNlY3VyZUhhbmRsZXIgPSBoYW5kbGVBc3luY1JvdXRlKHNlY3VyZUhhbmRsZXIpO1xuXG4gIHJldHVybiBzZWN1cmVIYW5kbGVyO1xufVxuXG4vKipcbiAqIElucHV0IHZhbGlkYXRpb24gbWlkZGxld2FyZVxuICovXG5mdW5jdGlvbiB3aXRoVmFsaWRhdGlvbihcbiAgaGFuZGxlcjogKHJlcXVlc3Q6IFJlcXVlc3QsIGNvbnRleHQ/OiBhbnkpID0+IFByb21pc2U8TmV4dFJlc3BvbnNlPixcbiAgb3B0aW9uczogeyBtYXhCb2R5U2l6ZTogbnVtYmVyIH1cbikge1xuICByZXR1cm4gYXN5bmMgKHJlcXVlc3Q6IFJlcXVlc3QsIGNvbnRleHQ/OiBhbnkpID0+IHtcbiAgICBjb25zdCBuZXh0UmVxdWVzdCA9IHJlcXVlc3QgYXMgTmV4dFJlcXVlc3Q7XG5cbiAgICAvLyBDaGVjayBjb250ZW50IGxlbmd0aFxuICAgIGNvbnN0IGNvbnRlbnRMZW5ndGggPSBuZXh0UmVxdWVzdC5oZWFkZXJzLmdldCgnY29udGVudC1sZW5ndGgnKTtcbiAgICBpZiAoY29udGVudExlbmd0aCAmJiBwYXJzZUludChjb250ZW50TGVuZ3RoKSA+IG9wdGlvbnMubWF4Qm9keVNpemUpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIGVycm9yOiAnUGF5bG9hZCB0b28gbGFyZ2UnLFxuICAgICAgICAgIG1lc3NhZ2U6IGBSZXF1ZXN0IGJvZHkgZXhjZWVkcyBtYXhpbXVtIHNpemUgb2YgJHtvcHRpb25zLm1heEJvZHlTaXplfSBieXRlc2AsXG4gICAgICAgICAgc3RhdHVzQ29kZTogNDEzLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDEzIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgY29udGVudCB0eXBlIGZvciBQT1NUL1BVVCByZXF1ZXN0c1xuICAgIGlmIChbJ1BPU1QnLCAnUFVUJywgJ1BBVENIJ10uaW5jbHVkZXMocmVxdWVzdC5tZXRob2QpKSB7XG4gICAgICBjb25zdCBjb250ZW50VHlwZSA9IG5leHRSZXF1ZXN0LmhlYWRlcnMuZ2V0KCdjb250ZW50LXR5cGUnKTtcbiAgICAgIGlmIChjb250ZW50VHlwZSAmJiAhY29udGVudFR5cGUuaW5jbHVkZXMoJ2FwcGxpY2F0aW9uL2pzb24nKSkge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgZXJyb3I6ICdJbnZhbGlkIGNvbnRlbnQgdHlwZScsXG4gICAgICAgICAgICBtZXNzYWdlOiAnQ29udGVudC1UeXBlIG11c3QgYmUgYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICBzdGF0dXNDb2RlOiA0MTUsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDE1IH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3Igc3VzcGljaW91cyBoZWFkZXJzXG4gICAgY29uc3Qgc3VzcGljaW91c0hlYWRlcnMgPSBbXG4gICAgICAneC1mb3J3YXJkZWQtaG9zdCcsXG4gICAgICAneC1vcmlnaW5hbC11cmwnLFxuICAgICAgJ3gtcmV3cml0ZS11cmwnLFxuICAgIF07XG5cbiAgICBmb3IgKGNvbnN0IGhlYWRlciBvZiBzdXNwaWNpb3VzSGVhZGVycykge1xuICAgICAgaWYgKG5leHRSZXF1ZXN0LmhlYWRlcnMuZ2V0KGhlYWRlcikpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGDwn5qoIFN1c3BpY2lvdXMgaGVhZGVyIGRldGVjdGVkOiAke2hlYWRlcn1gLCB7XG4gICAgICAgICAgdXJsOiByZXF1ZXN0LnVybCxcbiAgICAgICAgICBpcDogbmV4dFJlcXVlc3QuaGVhZGVycy5nZXQoJ3gtZm9yd2FyZGVkLWZvcicpIHx8ICd1bmtub3duJyxcbiAgICAgICAgICB1c2VyQWdlbnQ6IG5leHRSZXF1ZXN0LmhlYWRlcnMuZ2V0KCd1c2VyLWFnZW50JykgfHwgJ3Vua25vd24nLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBVUkwgcGF0aFxuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpO1xuICAgIGlmIChjb250YWluc1N1c3BpY2lvdXNQYXR0ZXJucyh1cmwucGF0aG5hbWUpKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBlcnJvcjogJ0ludmFsaWQgcmVxdWVzdCcsXG4gICAgICAgICAgbWVzc2FnZTogJ1JlcXVlc3QgY29udGFpbnMgc3VzcGljaW91cyBwYXR0ZXJucycsXG4gICAgICAgICAgc3RhdHVzQ29kZTogNDAwLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGhhbmRsZXIocmVxdWVzdCwgY29udGV4dCk7XG4gIH07XG59XG5cbi8qKlxuICogQ2hlY2sgZm9yIHN1c3BpY2lvdXMgcGF0dGVybnMgaW4gVVJMIHBhdGhzXG4gKi9cbmZ1bmN0aW9uIGNvbnRhaW5zU3VzcGljaW91c1BhdHRlcm5zKHBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBjb25zdCBzdXNwaWNpb3VzUGF0dGVybnMgPSBbXG4gICAgL1xcLlxcLi8sICAvLyBQYXRoIHRyYXZlcnNhbFxuICAgIC9cXC9cXC8vLCAgLy8gRG91YmxlIHNsYXNoZXNcbiAgICAvJTJlJTJlL2ksICAvLyBVUkwgZW5jb2RlZCBwYXRoIHRyYXZlcnNhbFxuICAgIC8lMDAvaSwgIC8vIE51bGwgYnl0ZXNcbiAgICAvXFx4MDAvLCAgLy8gTnVsbCBieXRlc1xuICAgIC88c2NyaXB0L2ksICAvLyBTY3JpcHQgdGFnc1xuICAgIC9qYXZhc2NyaXB0Oi9pLCAgLy8gSmF2YVNjcmlwdCBwcm90b2NvbFxuICAgIC92YnNjcmlwdDovaSwgIC8vIFZCU2NyaXB0IHByb3RvY29sXG4gICAgL2RhdGE6dGV4dFxcL2h0bWwvaSwgIC8vIERhdGEgVVJMcyB3aXRoIEhUTUxcbiAgICAvb25cXHcrPS9pLCAgLy8gRXZlbnQgaGFuZGxlcnNcbiAgXTtcblxuICByZXR1cm4gc3VzcGljaW91c1BhdHRlcm5zLnNvbWUocGF0dGVybiA9PiBwYXR0ZXJuLnRlc3QocGF0aCkpO1xufVxuXG4vKipcbiAqIFNlY3VyaXR5IGhlYWRlcnMgZm9yIEFQSSByZXNwb25zZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFkZFNlY3VyaXR5SGVhZGVycyhyZXNwb25zZTogTmV4dFJlc3BvbnNlKTogTmV4dFJlc3BvbnNlIHtcbiAgLy8gUmVtb3ZlIHNlcnZlciBpbmZvcm1hdGlvblxuICByZXNwb25zZS5oZWFkZXJzLmRlbGV0ZSgnc2VydmVyJyk7XG4gIHJlc3BvbnNlLmhlYWRlcnMuZGVsZXRlKCd4LXBvd2VyZWQtYnknKTtcblxuICAvLyBBZGQgc2VjdXJpdHkgaGVhZGVyc1xuICByZXNwb25zZS5oZWFkZXJzLnNldCgnWC1Db250ZW50LVR5cGUtT3B0aW9ucycsICdub3NuaWZmJyk7XG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdYLUZyYW1lLU9wdGlvbnMnLCAnREVOWScpO1xuICByZXNwb25zZS5oZWFkZXJzLnNldCgnWC1YU1MtUHJvdGVjdGlvbicsICcxOyBtb2RlPWJsb2NrJyk7XG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdSZWZlcnJlci1Qb2xpY3knLCAnc3RyaWN0LW9yaWdpbi13aGVuLWNyb3NzLW9yaWdpbicpO1xuICByZXNwb25zZS5oZWFkZXJzLnNldCgnUGVybWlzc2lvbnMtUG9saWN5JywgJ2NhbWVyYT0oKSwgbWljcm9waG9uZT0oKSwgZ2VvbG9jYXRpb249KCknKTtcblxuICAvLyBDb250ZW50IFNlY3VyaXR5IFBvbGljeSBmb3IgQVBJXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KFxuICAgICdDb250ZW50LVNlY3VyaXR5LVBvbGljeScsXG4gICAgXCJkZWZhdWx0LXNyYyAnbm9uZSc7IGZyYW1lLWFuY2VzdG9ycyAnbm9uZSc7XCJcbiAgKTtcblxuICAvLyBIU1RTIGluIHByb2R1Y3Rpb25cbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicpIHtcbiAgICByZXNwb25zZS5oZWFkZXJzLnNldChcbiAgICAgICdTdHJpY3QtVHJhbnNwb3J0LVNlY3VyaXR5JyxcbiAgICAgICdtYXgtYWdlPTMxNTM2MDAwOyBpbmNsdWRlU3ViRG9tYWluczsgcHJlbG9hZCdcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIHJlc3BvbnNlO1xufVxuXG4vKipcbiAqIFNhbml0aXplIHJlcXVlc3QgYm9keSB0byBwcmV2ZW50IGluamVjdGlvbiBhdHRhY2tzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzYW5pdGl6ZVJlcXVlc3RCb2R5KGJvZHk6IGFueSk6IGFueSB7XG4gIGlmICh0eXBlb2YgYm9keSA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gc2FuaXRpemVTdHJpbmcoYm9keSk7XG4gIH1cblxuICBpZiAoQXJyYXkuaXNBcnJheShib2R5KSkge1xuICAgIHJldHVybiBib2R5Lm1hcChpdGVtID0+IHNhbml0aXplUmVxdWVzdEJvZHkoaXRlbSkpO1xuICB9XG5cbiAgaWYgKGJvZHkgJiYgdHlwZW9mIGJvZHkgPT09ICdvYmplY3QnKSB7XG4gICAgY29uc3Qgc2FuaXRpemVkOiBhbnkgPSB7fTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhib2R5KSkge1xuICAgICAgLy8gU2FuaXRpemUga2V5c1xuICAgICAgY29uc3Qgc2FuaXRpemVkS2V5ID0gc2FuaXRpemVTdHJpbmcoa2V5KTtcbiAgICAgIHNhbml0aXplZFtzYW5pdGl6ZWRLZXldID0gc2FuaXRpemVSZXF1ZXN0Qm9keSh2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiBzYW5pdGl6ZWQ7XG4gIH1cblxuICByZXR1cm4gYm9keTtcbn1cblxuLyoqXG4gKiBTYW5pdGl6ZSBzdHJpbmcgdmFsdWVzXG4gKi9cbmZ1bmN0aW9uIHNhbml0aXplU3RyaW5nKHN0cjogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKHR5cGVvZiBzdHIgIT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIHN0cjtcbiAgfVxuXG4gIC8vIFJlbW92ZSBkYW5nZXJvdXMgcGF0dGVybnNcbiAgcmV0dXJuIHN0clxuICAgIC5yZXBsYWNlKC88c2NyaXB0XFxiW148XSooPzooPyE8XFwvc2NyaXB0Pik8W148XSopKjxcXC9zY3JpcHQ+L2dpLCAnJylcbiAgICAucmVwbGFjZSgvPGlmcmFtZVxcYltePF0qKD86KD8hPFxcL2lmcmFtZT4pPFtePF0qKSo8XFwvaWZyYW1lPi9naSwgJycpXG4gICAgLnJlcGxhY2UoL2phdmFzY3JpcHQ6L2dpLCAnJylcbiAgICAucmVwbGFjZSgvdmJzY3JpcHQ6L2dpLCAnJylcbiAgICAucmVwbGFjZSgvZGF0YTp0ZXh0XFwvaHRtbC9naSwgJycpXG4gICAgLnJlcGxhY2UoL29uXFx3K1xccyo9L2dpLCAnJylcbiAgICAudHJpbSgpO1xufVxuXG4vKipcbiAqIExvZyBzZWN1cml0eSBldmVudHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxvZ1NlY3VyaXR5RXZlbnQoXG4gIGV2ZW50OiBzdHJpbmcsXG4gIGRldGFpbHM6IHtcbiAgICByZXF1ZXN0PzogUmVxdWVzdDtcbiAgICBpcD86IHN0cmluZztcbiAgICB1c2VyQWdlbnQ/OiBzdHJpbmc7XG4gICAgc2V2ZXJpdHk/OiAnbG93JyB8ICdtZWRpdW0nIHwgJ2hpZ2gnO1xuICAgIFtrZXk6IHN0cmluZ106IGFueTtcbiAgfVxuKTogdm9pZCB7XG4gIGNvbnN0IGxvZ0VudHJ5ID0ge1xuICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIGV2ZW50LFxuICAgIHNldmVyaXR5OiBkZXRhaWxzLnNldmVyaXR5IHx8ICdtZWRpdW0nLFxuICAgIGlwOiBkZXRhaWxzLmlwIHx8ICd1bmtub3duJyxcbiAgICB1c2VyQWdlbnQ6IGRldGFpbHMudXNlckFnZW50IHx8ICd1bmtub3duJyxcbiAgICAuLi5kZXRhaWxzLFxuICB9O1xuXG4gIC8vIEluIHByb2R1Y3Rpb24sIHRoaXMgd291bGQgZ28gdG8gYSBwcm9wZXIgbG9nZ2luZyBzZXJ2aWNlXG4gIGlmIChkZXRhaWxzLnNldmVyaXR5ID09PSAnaGlnaCcpIHtcbiAgICBjb25zb2xlLmVycm9yKCfwn5qoIEhJR0ggU0VWRVJJVFkgU0VDVVJJVFkgRVZFTlQ6JywgbG9nRW50cnkpO1xuICB9IGVsc2UgaWYgKGRldGFpbHMuc2V2ZXJpdHkgPT09ICdtZWRpdW0nKSB7XG4gICAgY29uc29sZS53YXJuKCfimqDvuI8gU0VDVVJJVFkgRVZFTlQ6JywgbG9nRW50cnkpO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUuaW5mbygn4oS577iPIFNlY3VyaXR5IGV2ZW50OicsIGxvZ0VudHJ5KTtcbiAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlIGZpbGUgdXBsb2FkIChpZiBuZWVkZWQgaW4gdGhlIGZ1dHVyZSlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlRmlsZVVwbG9hZChcbiAgZmlsZTogRmlsZSxcbiAgb3B0aW9uczoge1xuICAgIG1heFNpemU/OiBudW1iZXI7XG4gICAgYWxsb3dlZFR5cGVzPzogc3RyaW5nW107XG4gICAgYWxsb3dlZEV4dGVuc2lvbnM/OiBzdHJpbmdbXTtcbiAgfSA9IHt9XG4pOiB2b2lkIHtcbiAgY29uc3Qge1xuICAgIG1heFNpemUgPSAxMCAqIDEwMjQgKiAxMDI0LCAvLyAxME1CXG4gICAgYWxsb3dlZFR5cGVzID0gWydhcHBsaWNhdGlvbi9qc29uJywgJ3RleHQvcGxhaW4nXSxcbiAgICBhbGxvd2VkRXh0ZW5zaW9ucyA9IFsnLmpzb24nLCAnLnR4dCddLFxuICB9ID0gb3B0aW9ucztcblxuICBpZiAoZmlsZS5zaXplID4gbWF4U2l6ZSkge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoYEZpbGUgc2l6ZSBleGNlZWRzIG1heGltdW0gb2YgJHttYXhTaXplfSBieXRlc2ApO1xuICB9XG5cbiAgaWYgKCFhbGxvd2VkVHlwZXMuaW5jbHVkZXMoZmlsZS50eXBlKSkge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoYEZpbGUgdHlwZSAke2ZpbGUudHlwZX0gaXMgbm90IGFsbG93ZWRgKTtcbiAgfVxuXG4gIGNvbnN0IGV4dGVuc2lvbiA9IGZpbGUubmFtZS50b0xvd2VyQ2FzZSgpLnN1YnN0cmluZyhmaWxlLm5hbWUubGFzdEluZGV4T2YoJy4nKSk7XG4gIGlmICghYWxsb3dlZEV4dGVuc2lvbnMuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoYEZpbGUgZXh0ZW5zaW9uICR7ZXh0ZW5zaW9ufSBpcyBub3QgYWxsb3dlZGApO1xuICB9XG59XG5cbi8qKlxuICogR2VuZXJhdGUgc2VjdXJlIHJhbmRvbSB0b2tlbnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlU2VjdXJlVG9rZW4obGVuZ3RoOiBudW1iZXIgPSAzMik6IHN0cmluZyB7XG4gIGNvbnN0IGNoYXJzID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5JztcbiAgbGV0IHJlc3VsdCA9ICcnO1xuICBcbiAgLy8gVXNlIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMgaWYgYXZhaWxhYmxlIChicm93c2VyL05vZGUuanMpXG4gIGlmICh0eXBlb2YgY3J5cHRvICE9PSAndW5kZWZpbmVkJyAmJiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKSB7XG4gICAgY29uc3QgYXJyYXkgPSBuZXcgVWludDhBcnJheShsZW5ndGgpO1xuICAgIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMoYXJyYXkpO1xuICAgIFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHJlc3VsdCArPSBjaGFyc1thcnJheVtpXSAlIGNoYXJzLmxlbmd0aF07XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIC8vIEZhbGxiYWNrIHRvIE1hdGgucmFuZG9tIChsZXNzIHNlY3VyZSlcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICByZXN1bHQgKz0gY2hhcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY2hhcnMubGVuZ3RoKV07XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gcmVzdWx0O1xufSJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJ3aXRoQ29ycyIsIndpdGhSYXRlTGltaXQiLCJoYW5kbGVBc3luY1JvdXRlIiwiVmFsaWRhdGlvbkVycm9yIiwid2l0aFNlY3VyaXR5IiwiaGFuZGxlciIsIm9wdGlvbnMiLCJyYXRlTGltaXQiLCJjb3JzIiwidmFsaWRhdGlvbiIsIm1heEJvZHlTaXplIiwic2VjdXJlSGFuZGxlciIsIndpdGhWYWxpZGF0aW9uIiwicmVxdWVzdCIsImNvbnRleHQiLCJuZXh0UmVxdWVzdCIsImNvbnRlbnRMZW5ndGgiLCJoZWFkZXJzIiwiZ2V0IiwicGFyc2VJbnQiLCJqc29uIiwiZXJyb3IiLCJtZXNzYWdlIiwic3RhdHVzQ29kZSIsInN0YXR1cyIsImluY2x1ZGVzIiwibWV0aG9kIiwiY29udGVudFR5cGUiLCJzdXNwaWNpb3VzSGVhZGVycyIsImhlYWRlciIsImNvbnNvbGUiLCJ3YXJuIiwidXJsIiwiaXAiLCJ1c2VyQWdlbnQiLCJVUkwiLCJjb250YWluc1N1c3BpY2lvdXNQYXR0ZXJucyIsInBhdGhuYW1lIiwicGF0aCIsInN1c3BpY2lvdXNQYXR0ZXJucyIsInNvbWUiLCJwYXR0ZXJuIiwidGVzdCIsImFkZFNlY3VyaXR5SGVhZGVycyIsInJlc3BvbnNlIiwiZGVsZXRlIiwic2V0IiwicHJvY2VzcyIsInNhbml0aXplUmVxdWVzdEJvZHkiLCJib2R5Iiwic2FuaXRpemVTdHJpbmciLCJBcnJheSIsImlzQXJyYXkiLCJtYXAiLCJpdGVtIiwic2FuaXRpemVkIiwia2V5IiwidmFsdWUiLCJPYmplY3QiLCJlbnRyaWVzIiwic2FuaXRpemVkS2V5Iiwic3RyIiwicmVwbGFjZSIsInRyaW0iLCJsb2dTZWN1cml0eUV2ZW50IiwiZXZlbnQiLCJkZXRhaWxzIiwibG9nRW50cnkiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidG9JU09TdHJpbmciLCJzZXZlcml0eSIsImluZm8iLCJ2YWxpZGF0ZUZpbGVVcGxvYWQiLCJmaWxlIiwibWF4U2l6ZSIsImFsbG93ZWRUeXBlcyIsImFsbG93ZWRFeHRlbnNpb25zIiwic2l6ZSIsInR5cGUiLCJleHRlbnNpb24iLCJuYW1lIiwidG9Mb3dlckNhc2UiLCJzdWJzdHJpbmciLCJsYXN0SW5kZXhPZiIsImdlbmVyYXRlU2VjdXJlVG9rZW4iLCJsZW5ndGgiLCJjaGFycyIsInJlc3VsdCIsImNyeXB0byIsImdldFJhbmRvbVZhbHVlcyIsImFycmF5IiwiVWludDhBcnJheSIsImkiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/security.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/validation.ts":
/*!*******************************!*\
  !*** ./src/lib/validation.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   sanitizeInput: () => (/* binding */ sanitizeInput),\n/* harmony export */   validateApiKey: () => (/* binding */ validateApiKey),\n/* harmony export */   validateChatRequest: () => (/* binding */ validateChatRequest),\n/* harmony export */   validateEmail: () => (/* binding */ validateEmail),\n/* harmony export */   validateMCPServerConfig: () => (/* binding */ validateMCPServerConfig),\n/* harmony export */   validateRunToolRequest: () => (/* binding */ validateRunToolRequest),\n/* harmony export */   validateSettings: () => (/* binding */ validateSettings),\n/* harmony export */   validateStringLength: () => (/* binding */ validateStringLength),\n/* harmony export */   validateToolCall: () => (/* binding */ validateToolCall),\n/* harmony export */   validateUrl: () => (/* binding */ validateUrl),\n/* harmony export */   validateUserPreferences: () => (/* binding */ validateUserPreferences)\n/* harmony export */ });\n/* harmony import */ var _errors__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./errors */ \"(rsc)/./src/lib/errors.ts\");\n\nfunction validateChatRequest(data) {\n    if (!data || typeof data !== 'object') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Request body must be a valid JSON object');\n    }\n    const { messages, sessionId, provider, model, apiKey, baseUrl, systemPrompt, temperature, maxTokens, availableTools } = data;\n    if (!Array.isArray(messages)) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Messages must be an array');\n    }\n    if (messages.length === 0) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Messages array cannot be empty');\n    }\n    // Validate each message\n    messages.forEach((message, index)=>{\n        if (!message.id || typeof message.id !== 'string' || message.id.trim().length === 0) {\n            throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`Message at index ${index} must have a valid non-empty id`);\n        }\n        // Validate message ID format (prevent injection)\n        if (!/^[a-zA-Z0-9_-]+$/.test(message.id)) {\n            throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`Message at index ${index} has invalid ID format`);\n        }\n        if (!message.role || ![\n            'user',\n            'assistant',\n            'tool',\n            'system'\n        ].includes(message.role)) {\n            throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`Message at index ${index} must have a valid role`);\n        }\n        if (typeof message.content !== 'string') {\n            throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`Message at index ${index} must have string content`);\n        }\n        // Validate content length\n        validateStringLength(message.content, `Message ${index} content`, 50000);\n        // Sanitize message content to prevent XSS\n        message.content = sanitizeInput(message.content);\n        // Validate timestamp if present\n        if (message.timestamp && !(message.timestamp instanceof Date) && isNaN(Date.parse(message.timestamp))) {\n            throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`Message at index ${index} has invalid timestamp`);\n        }\n        // Validate tool calls if present\n        if (message.toolCalls && Array.isArray(message.toolCalls)) {\n            message.toolCalls.forEach((toolCall, toolIndex)=>{\n                validateToolCall(toolCall, `Message ${index}, tool call ${toolIndex}`);\n            });\n        }\n    });\n    if (!sessionId || typeof sessionId !== 'string') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Session ID must be a valid string');\n    }\n    // Validate session ID format\n    if (!/^[a-zA-Z0-9_-]+$/.test(sessionId)) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Session ID contains invalid characters');\n    }\n    validateStringLength(sessionId, 'Session ID', 100);\n    if (!provider || ![\n        'openai',\n        'deepseek',\n        'openrouter'\n    ].includes(provider)) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Provider must be one of: openai, deepseek, openrouter');\n    }\n    if (!model || typeof model !== 'string') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Model must be a valid string');\n    }\n    // Validate optional parameters\n    if (apiKey !== undefined && typeof apiKey !== 'string') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('API key must be a string');\n    }\n    if (baseUrl !== undefined && typeof baseUrl !== 'string') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Base URL must be a string');\n    }\n    if (systemPrompt !== undefined && typeof systemPrompt !== 'string') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('System prompt must be a string');\n    }\n    if (temperature !== undefined && (typeof temperature !== 'number' || temperature < 0 || temperature > 2)) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Temperature must be a number between 0 and 2');\n    }\n    if (maxTokens !== undefined && (typeof maxTokens !== 'number' || maxTokens <= 0)) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Max tokens must be a positive number');\n    }\n    if (availableTools !== undefined && !Array.isArray(availableTools)) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Available tools must be an array');\n    }\n    return {\n        messages: messages.map((msg)=>({\n                ...msg,\n                timestamp: msg.timestamp ? new Date(msg.timestamp) : new Date()\n            })),\n        sessionId,\n        provider: provider,\n        model,\n        apiKey,\n        baseUrl,\n        systemPrompt,\n        temperature,\n        maxTokens,\n        availableTools\n    };\n}\nfunction validateRunToolRequest(data) {\n    if (!data || typeof data !== 'object') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Request body must be a valid JSON object');\n    }\n    const { toolCall, sessionId, messages } = data;\n    validateToolCall(toolCall, 'Tool call');\n    if (!sessionId || typeof sessionId !== 'string') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Session ID must be a valid string');\n    }\n    if (!Array.isArray(messages)) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Messages must be an array');\n    }\n    return {\n        toolCall,\n        sessionId,\n        messages: messages.map((msg)=>({\n                ...msg,\n                timestamp: msg.timestamp ? new Date(msg.timestamp) : new Date()\n            }))\n    };\n}\nfunction validateSettings(data) {\n    if (!data || typeof data !== 'object') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Settings must be a valid JSON object');\n    }\n    // Validate LLM providers if present\n    if (data.llmProviders) {\n        if (!Array.isArray(data.llmProviders)) {\n            throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('LLM providers must be an array');\n        }\n        data.llmProviders.forEach((provider, index)=>{\n            if (!provider || typeof provider !== 'object') {\n                throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`LLM provider at index ${index} must be a valid object`);\n            }\n            if (!provider.id || typeof provider.id !== 'string') {\n                throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`LLM provider at index ${index} must have a valid id`);\n            }\n            if (!/^[a-zA-Z0-9_-]+$/.test(provider.id)) {\n                throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`LLM provider at index ${index} has invalid ID format`);\n            }\n            if (!provider.name || ![\n                'openai',\n                'deepseek',\n                'openrouter'\n            ].includes(provider.name)) {\n                throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`LLM provider at index ${index} must have a valid name`);\n            }\n            // Only validate API key if it's provided, not empty, and not masked\n            if (provider.apiKey && typeof provider.apiKey === 'string' && provider.apiKey.trim() !== '' && !provider.apiKey.includes('*') && !provider.apiKey.includes('')) {\n                validateApiKey(provider.apiKey, provider.name);\n            }\n            if (provider.baseUrl && typeof provider.baseUrl === 'string') {\n                if (!validateUrl(provider.baseUrl)) {\n                    throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`LLM provider at index ${index} has invalid base URL`);\n                }\n            }\n        });\n    }\n    // Validate MCP servers if present\n    if (data.mcpServers) {\n        if (!Array.isArray(data.mcpServers)) {\n            throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('MCP servers must be an array');\n        }\n        data.mcpServers.forEach((server, index)=>{\n            try {\n                validateMCPServerConfig(server);\n            } catch (error) {\n                throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`MCP server at index ${index}: ${error.message}`);\n            }\n        });\n    }\n    // Validate preferences if present\n    if (data.preferences) {\n        try {\n            validateUserPreferences(data.preferences);\n        } catch (error) {\n            throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`User preferences: ${error.message}`);\n        }\n    }\n    return data;\n}\nfunction sanitizeInput(input) {\n    if (typeof input !== 'string') {\n        return '';\n    }\n    // Enhanced XSS prevention\n    return input.replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, '').replace(/<iframe\\b[^<]*(?:(?!<\\/iframe>)<[^<]*)*<\\/iframe>/gi, '').replace(/<object\\b[^<]*(?:(?!<\\/object>)<[^<]*)*<\\/object>/gi, '').replace(/<embed\\b[^<]*(?:(?!<\\/embed>)<[^<]*)*<\\/embed>/gi, '').replace(/javascript:/gi, '').replace(/vbscript:/gi, '').replace(/data:text\\/html/gi, '').replace(/on\\w+\\s*=/gi, '').replace(/style\\s*=\\s*[\"'][^\"']*expression\\s*\\(/gi, '').trim();\n}\nfunction validateStringLength(input, fieldName, maxLength = 1000) {\n    if (input.length > maxLength) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`${fieldName} exceeds maximum length of ${maxLength} characters`);\n    }\n}\nfunction validateEmail(email) {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return emailRegex.test(email);\n}\nfunction validateUrl(url) {\n    try {\n        const parsed = new URL(url);\n        return [\n            'http:',\n            'https:'\n        ].includes(parsed.protocol);\n    } catch  {\n        return false;\n    }\n}\nfunction validateToolCall(toolCall, context = 'Tool call') {\n    if (!toolCall || typeof toolCall !== 'object') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`${context} must be a valid object`);\n    }\n    if (!toolCall.id || typeof toolCall.id !== 'string') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`${context} must have a valid id`);\n    }\n    // Validate tool call ID format\n    if (!/^[a-zA-Z0-9_-]+$/.test(toolCall.id)) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`${context} has invalid ID format`);\n    }\n    if (toolCall.type !== 'function') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`${context} type must be \"function\"`);\n    }\n    if (!toolCall.function || typeof toolCall.function !== 'object') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`${context} must have a valid function object`);\n    }\n    if (!toolCall.function.name || typeof toolCall.function.name !== 'string') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`${context} function must have a valid name`);\n    }\n    // Validate function name format (prevent injection)\n    if (!/^[a-zA-Z][a-zA-Z0-9_]*$/.test(toolCall.function.name)) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`${context} function name has invalid format`);\n    }\n    validateStringLength(toolCall.function.name, `${context} function name`, 100);\n    if (typeof toolCall.function.arguments !== 'string') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`${context} function arguments must be a string`);\n    }\n    // Validate arguments as JSON\n    try {\n        JSON.parse(toolCall.function.arguments);\n    } catch  {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`${context} function arguments must be valid JSON`);\n    }\n    validateStringLength(toolCall.function.arguments, `${context} function arguments`, 10000);\n}\nfunction validateApiKey(apiKey, provider) {\n    if (!apiKey || typeof apiKey !== 'string') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('API key must be a valid string');\n    }\n    // Basic length validation\n    if (apiKey.length < 10) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('API key is too short');\n    }\n    if (apiKey.length > 200) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('API key is too long');\n    }\n    // Provider-specific validation\n    switch(provider){\n        case 'openai':\n            if (!apiKey.startsWith('sk-')) {\n                throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('OpenAI API key must start with \"sk-\"');\n            }\n            break;\n        case 'deepseek':\n            if (!apiKey.startsWith('sk-')) {\n                throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('DeepSeek API key must start with \"sk-\"');\n            }\n            break;\n        case 'openrouter':\n            if (!apiKey.startsWith('sk-or-')) {\n                throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('OpenRouter API key must start with \"sk-or-\"');\n            }\n            break;\n    }\n    // Check for suspicious patterns\n    const suspiciousPatterns = [\n        /\\s/,\n        /[<>]/,\n        /javascript:/i,\n        /data:/i\n    ];\n    for (const pattern of suspiciousPatterns){\n        if (pattern.test(apiKey)) {\n            throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('API key contains invalid characters');\n        }\n    }\n}\nfunction validateMCPServerConfig(config) {\n    if (!config || typeof config !== 'object') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('MCP server config must be a valid object');\n    }\n    if (!config.id || typeof config.id !== 'string') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('MCP server config must have a valid id');\n    }\n    // Validate ID format\n    if (!/^[a-zA-Z0-9_-]+$/.test(config.id)) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('MCP server config ID has invalid format');\n    }\n    if (!config.name || typeof config.name !== 'string') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('MCP server config must have a valid name');\n    }\n    validateStringLength(config.name, 'MCP server name', 100);\n    if (!config.command || typeof config.command !== 'string') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('MCP server config must have a valid command');\n    }\n    // Validate command (prevent command injection)\n    if (!/^[a-zA-Z0-9_./\\-]+$/.test(config.command)) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('MCP server command contains invalid characters');\n    }\n    if (!Array.isArray(config.args)) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('MCP server args must be an array');\n    }\n    // Validate each argument\n    config.args.forEach((arg, index)=>{\n        if (typeof arg !== 'string') {\n            throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`MCP server arg at index ${index} must be a string`);\n        }\n        validateStringLength(arg, `MCP server arg ${index}`, 500);\n    });\n    // Validate environment variables if present\n    if (config.env && typeof config.env === 'object') {\n        Object.entries(config.env).forEach(([key, value])=>{\n            if (typeof key !== 'string' || typeof value !== 'string') {\n                throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('MCP server environment variables must be strings');\n            }\n            // Validate environment variable names\n            if (!/^[A-Z_][A-Z0-9_]*$/.test(key)) {\n                throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError(`Invalid environment variable name: ${key}`);\n            }\n            validateStringLength(key, 'Environment variable name', 100);\n            validateStringLength(value, 'Environment variable value', 1000);\n        });\n    }\n}\nfunction validateUserPreferences(preferences) {\n    if (!preferences || typeof preferences !== 'object') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('User preferences must be a valid object');\n    }\n    if (preferences.theme && ![\n        'light',\n        'dark',\n        'system'\n    ].includes(preferences.theme)) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Theme must be one of: light, dark, system');\n    }\n    if (preferences.language && ![\n        'en',\n        'zh'\n    ].includes(preferences.language)) {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('Language must be one of: en, zh');\n    }\n    if (preferences.autoScroll !== undefined && typeof preferences.autoScroll !== 'boolean') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('autoScroll must be a boolean');\n    }\n    if (preferences.soundEnabled !== undefined && typeof preferences.soundEnabled !== 'boolean') {\n        throw new _errors__WEBPACK_IMPORTED_MODULE_0__.ValidationError('soundEnabled must be a boolean');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ3RFO0lBQ0Y7QUFDRjtBQUVPLFNBQVM1Qix3QkFBd0JELFdBQWdCO0lBQ3RELElBQUksQ0FBQ0EsZUFBZSxPQUFPQSxnQkFBZ0IsVUFBVTtRQUNuRCxNQUFNLElBQUloRCxvREFBZUEsQ0FBQztJQUM1QjtJQUVBLElBQUlnRCxZQUFZOEIsS0FBSyxJQUFJLENBQUM7UUFBQztRQUFTO1FBQVE7S0FBUyxDQUFDdkQsUUFBUSxDQUFDeUIsWUFBWThCLEtBQUssR0FBRztRQUNqRixNQUFNLElBQUk5RSxvREFBZUEsQ0FBQztJQUM1QjtJQUVBLElBQUlnRCxZQUFZK0IsUUFBUSxJQUFJLENBQUM7UUFBQztRQUFNO0tBQUssQ0FBQ3hELFFBQVEsQ0FBQ3lCLFlBQVkrQixRQUFRLEdBQUc7UUFDeEUsTUFBTSxJQUFJL0Usb0RBQWVBLENBQUM7SUFDNUI7SUFFQSxJQUFJZ0QsWUFBWWdDLFVBQVUsS0FBSzdDLGFBQWEsT0FBT2EsWUFBWWdDLFVBQVUsS0FBSyxXQUFXO1FBQ3ZGLE1BQU0sSUFBSWhGLG9EQUFlQSxDQUFDO0lBQzVCO0lBRUEsSUFBSWdELFlBQVlpQyxZQUFZLEtBQUs5QyxhQUFhLE9BQU9hLFlBQVlpQyxZQUFZLEtBQUssV0FBVztRQUMzRixNQUFNLElBQUlqRixvREFBZUEsQ0FBQztJQUM1QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvb25lYmlyZC9naXRodWIvZWJvb2stbWNwL21jcC1jaGF0LXVpL2JhY2tlbmQvc3JjL2xpYi92YWxpZGF0aW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZhbGlkYXRpb25FcnJvciB9IGZyb20gJy4vZXJyb3JzJztcbmltcG9ydCB7IENoYXRSZXF1ZXN0LCBSdW5Ub29sUmVxdWVzdCwgTExNUHJvdmlkZXIgfSBmcm9tICdAL3R5cGVzJztcblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlQ2hhdFJlcXVlc3QoZGF0YTogYW55KTogQ2hhdFJlcXVlc3Qge1xuICBpZiAoIWRhdGEgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignUmVxdWVzdCBib2R5IG11c3QgYmUgYSB2YWxpZCBKU09OIG9iamVjdCcpO1xuICB9XG5cbiAgY29uc3QgeyBcbiAgICBtZXNzYWdlcywgXG4gICAgc2Vzc2lvbklkLCBcbiAgICBwcm92aWRlciwgXG4gICAgbW9kZWwsIFxuICAgIGFwaUtleSwgXG4gICAgYmFzZVVybCwgXG4gICAgc3lzdGVtUHJvbXB0LCBcbiAgICB0ZW1wZXJhdHVyZSwgXG4gICAgbWF4VG9rZW5zLCBcbiAgICBhdmFpbGFibGVUb29scyBcbiAgfSA9IGRhdGE7XG5cbiAgaWYgKCFBcnJheS5pc0FycmF5KG1lc3NhZ2VzKSkge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ01lc3NhZ2VzIG11c3QgYmUgYW4gYXJyYXknKTtcbiAgfVxuXG4gIGlmIChtZXNzYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCdNZXNzYWdlcyBhcnJheSBjYW5ub3QgYmUgZW1wdHknKTtcbiAgfVxuXG4gIC8vIFZhbGlkYXRlIGVhY2ggbWVzc2FnZVxuICBtZXNzYWdlcy5mb3JFYWNoKChtZXNzYWdlOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICBpZiAoIW1lc3NhZ2UuaWQgfHwgdHlwZW9mIG1lc3NhZ2UuaWQgIT09ICdzdHJpbmcnIHx8IG1lc3NhZ2UuaWQudHJpbSgpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihgTWVzc2FnZSBhdCBpbmRleCAke2luZGV4fSBtdXN0IGhhdmUgYSB2YWxpZCBub24tZW1wdHkgaWRgKTtcbiAgICB9XG4gICAgXG4gICAgLy8gVmFsaWRhdGUgbWVzc2FnZSBJRCBmb3JtYXQgKHByZXZlbnQgaW5qZWN0aW9uKVxuICAgIGlmICghL15bYS16QS1aMC05Xy1dKyQvLnRlc3QobWVzc2FnZS5pZCkpIHtcbiAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoYE1lc3NhZ2UgYXQgaW5kZXggJHtpbmRleH0gaGFzIGludmFsaWQgSUQgZm9ybWF0YCk7XG4gICAgfVxuICAgIFxuICAgIGlmICghbWVzc2FnZS5yb2xlIHx8ICFbJ3VzZXInLCAnYXNzaXN0YW50JywgJ3Rvb2wnLCAnc3lzdGVtJ10uaW5jbHVkZXMobWVzc2FnZS5yb2xlKSkge1xuICAgICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihgTWVzc2FnZSBhdCBpbmRleCAke2luZGV4fSBtdXN0IGhhdmUgYSB2YWxpZCByb2xlYCk7XG4gICAgfVxuICAgIFxuICAgIGlmICh0eXBlb2YgbWVzc2FnZS5jb250ZW50ICE9PSAnc3RyaW5nJykge1xuICAgICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihgTWVzc2FnZSBhdCBpbmRleCAke2luZGV4fSBtdXN0IGhhdmUgc3RyaW5nIGNvbnRlbnRgKTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBjb250ZW50IGxlbmd0aFxuICAgIHZhbGlkYXRlU3RyaW5nTGVuZ3RoKG1lc3NhZ2UuY29udGVudCwgYE1lc3NhZ2UgJHtpbmRleH0gY29udGVudGAsIDUwMDAwKTtcblxuICAgIC8vIFNhbml0aXplIG1lc3NhZ2UgY29udGVudCB0byBwcmV2ZW50IFhTU1xuICAgIG1lc3NhZ2UuY29udGVudCA9IHNhbml0aXplSW5wdXQobWVzc2FnZS5jb250ZW50KTtcbiAgICBcbiAgICAvLyBWYWxpZGF0ZSB0aW1lc3RhbXAgaWYgcHJlc2VudFxuICAgIGlmIChtZXNzYWdlLnRpbWVzdGFtcCAmJiAhKG1lc3NhZ2UudGltZXN0YW1wIGluc3RhbmNlb2YgRGF0ZSkgJiYgaXNOYU4oRGF0ZS5wYXJzZShtZXNzYWdlLnRpbWVzdGFtcCkpKSB7XG4gICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKGBNZXNzYWdlIGF0IGluZGV4ICR7aW5kZXh9IGhhcyBpbnZhbGlkIHRpbWVzdGFtcGApO1xuICAgIH1cbiAgICBcbiAgICAvLyBWYWxpZGF0ZSB0b29sIGNhbGxzIGlmIHByZXNlbnRcbiAgICBpZiAobWVzc2FnZS50b29sQ2FsbHMgJiYgQXJyYXkuaXNBcnJheShtZXNzYWdlLnRvb2xDYWxscykpIHtcbiAgICAgIG1lc3NhZ2UudG9vbENhbGxzLmZvckVhY2goKHRvb2xDYWxsOiBhbnksIHRvb2xJbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgIHZhbGlkYXRlVG9vbENhbGwodG9vbENhbGwsIGBNZXNzYWdlICR7aW5kZXh9LCB0b29sIGNhbGwgJHt0b29sSW5kZXh9YCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIGlmICghc2Vzc2lvbklkIHx8IHR5cGVvZiBzZXNzaW9uSWQgIT09ICdzdHJpbmcnKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignU2Vzc2lvbiBJRCBtdXN0IGJlIGEgdmFsaWQgc3RyaW5nJyk7XG4gIH1cbiAgXG4gIC8vIFZhbGlkYXRlIHNlc3Npb24gSUQgZm9ybWF0XG4gIGlmICghL15bYS16QS1aMC05Xy1dKyQvLnRlc3Qoc2Vzc2lvbklkKSkge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ1Nlc3Npb24gSUQgY29udGFpbnMgaW52YWxpZCBjaGFyYWN0ZXJzJyk7XG4gIH1cbiAgXG4gIHZhbGlkYXRlU3RyaW5nTGVuZ3RoKHNlc3Npb25JZCwgJ1Nlc3Npb24gSUQnLCAxMDApO1xuXG4gIGlmICghcHJvdmlkZXIgfHwgIVsnb3BlbmFpJywgJ2RlZXBzZWVrJywgJ29wZW5yb3V0ZXInXS5pbmNsdWRlcyhwcm92aWRlcikpIHtcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCdQcm92aWRlciBtdXN0IGJlIG9uZSBvZjogb3BlbmFpLCBkZWVwc2Vlaywgb3BlbnJvdXRlcicpO1xuICB9XG5cbiAgaWYgKCFtb2RlbCB8fCB0eXBlb2YgbW9kZWwgIT09ICdzdHJpbmcnKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignTW9kZWwgbXVzdCBiZSBhIHZhbGlkIHN0cmluZycpO1xuICB9XG5cbiAgLy8gVmFsaWRhdGUgb3B0aW9uYWwgcGFyYW1ldGVyc1xuICBpZiAoYXBpS2V5ICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIGFwaUtleSAhPT0gJ3N0cmluZycpIHtcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCdBUEkga2V5IG11c3QgYmUgYSBzdHJpbmcnKTtcbiAgfVxuXG4gIGlmIChiYXNlVXJsICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIGJhc2VVcmwgIT09ICdzdHJpbmcnKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignQmFzZSBVUkwgbXVzdCBiZSBhIHN0cmluZycpO1xuICB9XG5cbiAgaWYgKHN5c3RlbVByb21wdCAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBzeXN0ZW1Qcm9tcHQgIT09ICdzdHJpbmcnKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignU3lzdGVtIHByb21wdCBtdXN0IGJlIGEgc3RyaW5nJyk7XG4gIH1cblxuICBpZiAodGVtcGVyYXR1cmUgIT09IHVuZGVmaW5lZCAmJiAodHlwZW9mIHRlbXBlcmF0dXJlICE9PSAnbnVtYmVyJyB8fCB0ZW1wZXJhdHVyZSA8IDAgfHwgdGVtcGVyYXR1cmUgPiAyKSkge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ1RlbXBlcmF0dXJlIG11c3QgYmUgYSBudW1iZXIgYmV0d2VlbiAwIGFuZCAyJyk7XG4gIH1cblxuICBpZiAobWF4VG9rZW5zICE9PSB1bmRlZmluZWQgJiYgKHR5cGVvZiBtYXhUb2tlbnMgIT09ICdudW1iZXInIHx8IG1heFRva2VucyA8PSAwKSkge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ01heCB0b2tlbnMgbXVzdCBiZSBhIHBvc2l0aXZlIG51bWJlcicpO1xuICB9XG5cbiAgaWYgKGF2YWlsYWJsZVRvb2xzICE9PSB1bmRlZmluZWQgJiYgIUFycmF5LmlzQXJyYXkoYXZhaWxhYmxlVG9vbHMpKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignQXZhaWxhYmxlIHRvb2xzIG11c3QgYmUgYW4gYXJyYXknKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgbWVzc2FnZXM6IG1lc3NhZ2VzLm1hcCgobXNnOiBhbnkpID0+ICh7XG4gICAgICAuLi5tc2csXG4gICAgICB0aW1lc3RhbXA6IG1zZy50aW1lc3RhbXAgPyBuZXcgRGF0ZShtc2cudGltZXN0YW1wKSA6IG5ldyBEYXRlKCksXG4gICAgfSkpLFxuICAgIHNlc3Npb25JZCxcbiAgICBwcm92aWRlcjogcHJvdmlkZXIgYXMgTExNUHJvdmlkZXIsXG4gICAgbW9kZWwsXG4gICAgYXBpS2V5LFxuICAgIGJhc2VVcmwsXG4gICAgc3lzdGVtUHJvbXB0LFxuICAgIHRlbXBlcmF0dXJlLFxuICAgIG1heFRva2VucyxcbiAgICBhdmFpbGFibGVUb29scyxcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlUnVuVG9vbFJlcXVlc3QoZGF0YTogYW55KTogUnVuVG9vbFJlcXVlc3Qge1xuICBpZiAoIWRhdGEgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignUmVxdWVzdCBib2R5IG11c3QgYmUgYSB2YWxpZCBKU09OIG9iamVjdCcpO1xuICB9XG5cbiAgY29uc3QgeyB0b29sQ2FsbCwgc2Vzc2lvbklkLCBtZXNzYWdlcyB9ID0gZGF0YTtcblxuICB2YWxpZGF0ZVRvb2xDYWxsKHRvb2xDYWxsLCAnVG9vbCBjYWxsJyk7XG5cbiAgaWYgKCFzZXNzaW9uSWQgfHwgdHlwZW9mIHNlc3Npb25JZCAhPT0gJ3N0cmluZycpIHtcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCdTZXNzaW9uIElEIG11c3QgYmUgYSB2YWxpZCBzdHJpbmcnKTtcbiAgfVxuXG4gIGlmICghQXJyYXkuaXNBcnJheShtZXNzYWdlcykpIHtcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCdNZXNzYWdlcyBtdXN0IGJlIGFuIGFycmF5Jyk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHRvb2xDYWxsLFxuICAgIHNlc3Npb25JZCxcbiAgICBtZXNzYWdlczogbWVzc2FnZXMubWFwKChtc2c6IGFueSkgPT4gKHtcbiAgICAgIC4uLm1zZyxcbiAgICAgIHRpbWVzdGFtcDogbXNnLnRpbWVzdGFtcCA/IG5ldyBEYXRlKG1zZy50aW1lc3RhbXApIDogbmV3IERhdGUoKSxcbiAgICB9KSksXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVNldHRpbmdzKGRhdGE6IGFueSkge1xuICBpZiAoIWRhdGEgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignU2V0dGluZ3MgbXVzdCBiZSBhIHZhbGlkIEpTT04gb2JqZWN0Jyk7XG4gIH1cblxuICAvLyBWYWxpZGF0ZSBMTE0gcHJvdmlkZXJzIGlmIHByZXNlbnRcbiAgaWYgKGRhdGEubGxtUHJvdmlkZXJzKSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGRhdGEubGxtUHJvdmlkZXJzKSkge1xuICAgICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignTExNIHByb3ZpZGVycyBtdXN0IGJlIGFuIGFycmF5Jyk7XG4gICAgfVxuXG4gICAgZGF0YS5sbG1Qcm92aWRlcnMuZm9yRWFjaCgocHJvdmlkZXI6IGFueSwgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgaWYgKCFwcm92aWRlciB8fCB0eXBlb2YgcHJvdmlkZXIgIT09ICdvYmplY3QnKSB7XG4gICAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoYExMTSBwcm92aWRlciBhdCBpbmRleCAke2luZGV4fSBtdXN0IGJlIGEgdmFsaWQgb2JqZWN0YCk7XG4gICAgICB9XG5cbiAgICAgIGlmICghcHJvdmlkZXIuaWQgfHwgdHlwZW9mIHByb3ZpZGVyLmlkICE9PSAnc3RyaW5nJykge1xuICAgICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKGBMTE0gcHJvdmlkZXIgYXQgaW5kZXggJHtpbmRleH0gbXVzdCBoYXZlIGEgdmFsaWQgaWRgKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCEvXlthLXpBLVowLTlfLV0rJC8udGVzdChwcm92aWRlci5pZCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihgTExNIHByb3ZpZGVyIGF0IGluZGV4ICR7aW5kZXh9IGhhcyBpbnZhbGlkIElEIGZvcm1hdGApO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXByb3ZpZGVyLm5hbWUgfHwgIVsnb3BlbmFpJywgJ2RlZXBzZWVrJywgJ29wZW5yb3V0ZXInXS5pbmNsdWRlcyhwcm92aWRlci5uYW1lKSkge1xuICAgICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKGBMTE0gcHJvdmlkZXIgYXQgaW5kZXggJHtpbmRleH0gbXVzdCBoYXZlIGEgdmFsaWQgbmFtZWApO1xuICAgICAgfVxuXG4gICAgICAvLyBPbmx5IHZhbGlkYXRlIEFQSSBrZXkgaWYgaXQncyBwcm92aWRlZCwgbm90IGVtcHR5LCBhbmQgbm90IG1hc2tlZFxuICAgICAgaWYgKHByb3ZpZGVyLmFwaUtleSAmJiBcbiAgICAgICAgICB0eXBlb2YgcHJvdmlkZXIuYXBpS2V5ID09PSAnc3RyaW5nJyAmJiBcbiAgICAgICAgICBwcm92aWRlci5hcGlLZXkudHJpbSgpICE9PSAnJyAmJiBcbiAgICAgICAgICAhcHJvdmlkZXIuYXBpS2V5LmluY2x1ZGVzKCcqJykgJiYgXG4gICAgICAgICAgIXByb3ZpZGVyLmFwaUtleS5pbmNsdWRlcygn4oCiJykpIHtcbiAgICAgICAgdmFsaWRhdGVBcGlLZXkocHJvdmlkZXIuYXBpS2V5LCBwcm92aWRlci5uYW1lKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHByb3ZpZGVyLmJhc2VVcmwgJiYgdHlwZW9mIHByb3ZpZGVyLmJhc2VVcmwgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGlmICghdmFsaWRhdGVVcmwocHJvdmlkZXIuYmFzZVVybCkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKGBMTE0gcHJvdmlkZXIgYXQgaW5kZXggJHtpbmRleH0gaGFzIGludmFsaWQgYmFzZSBVUkxgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLy8gVmFsaWRhdGUgTUNQIHNlcnZlcnMgaWYgcHJlc2VudFxuICBpZiAoZGF0YS5tY3BTZXJ2ZXJzKSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGRhdGEubWNwU2VydmVycykpIHtcbiAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ01DUCBzZXJ2ZXJzIG11c3QgYmUgYW4gYXJyYXknKTtcbiAgICB9XG5cbiAgICBkYXRhLm1jcFNlcnZlcnMuZm9yRWFjaCgoc2VydmVyOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhbGlkYXRlTUNQU2VydmVyQ29uZmlnKHNlcnZlcik7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKGBNQ1Agc2VydmVyIGF0IGluZGV4ICR7aW5kZXh9OiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyBWYWxpZGF0ZSBwcmVmZXJlbmNlcyBpZiBwcmVzZW50XG4gIGlmIChkYXRhLnByZWZlcmVuY2VzKSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhbGlkYXRlVXNlclByZWZlcmVuY2VzKGRhdGEucHJlZmVyZW5jZXMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKGBVc2VyIHByZWZlcmVuY2VzOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzYW5pdGl6ZUlucHV0KGlucHV0OiBzdHJpbmcpOiBzdHJpbmcge1xuICBpZiAodHlwZW9mIGlucHV0ICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiAnJztcbiAgfVxuICBcbiAgLy8gRW5oYW5jZWQgWFNTIHByZXZlbnRpb25cbiAgcmV0dXJuIGlucHV0XG4gICAgLnJlcGxhY2UoLzxzY3JpcHRcXGJbXjxdKig/Oig/ITxcXC9zY3JpcHQ+KTxbXjxdKikqPFxcL3NjcmlwdD4vZ2ksICcnKVxuICAgIC5yZXBsYWNlKC88aWZyYW1lXFxiW148XSooPzooPyE8XFwvaWZyYW1lPik8W148XSopKjxcXC9pZnJhbWU+L2dpLCAnJylcbiAgICAucmVwbGFjZSgvPG9iamVjdFxcYltePF0qKD86KD8hPFxcL29iamVjdD4pPFtePF0qKSo8XFwvb2JqZWN0Pi9naSwgJycpXG4gICAgLnJlcGxhY2UoLzxlbWJlZFxcYltePF0qKD86KD8hPFxcL2VtYmVkPik8W148XSopKjxcXC9lbWJlZD4vZ2ksICcnKVxuICAgIC5yZXBsYWNlKC9qYXZhc2NyaXB0Oi9naSwgJycpXG4gICAgLnJlcGxhY2UoL3Zic2NyaXB0Oi9naSwgJycpXG4gICAgLnJlcGxhY2UoL2RhdGE6dGV4dFxcL2h0bWwvZ2ksICcnKVxuICAgIC5yZXBsYWNlKC9vblxcdytcXHMqPS9naSwgJycpXG4gICAgLnJlcGxhY2UoL3N0eWxlXFxzKj1cXHMqW1wiJ11bXlwiJ10qZXhwcmVzc2lvblxccypcXCgvZ2ksICcnKVxuICAgIC50cmltKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVN0cmluZ0xlbmd0aChpbnB1dDogc3RyaW5nLCBmaWVsZE5hbWU6IHN0cmluZywgbWF4TGVuZ3RoOiBudW1iZXIgPSAxMDAwKTogdm9pZCB7XG4gIGlmIChpbnB1dC5sZW5ndGggPiBtYXhMZW5ndGgpIHtcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKGAke2ZpZWxkTmFtZX0gZXhjZWVkcyBtYXhpbXVtIGxlbmd0aCBvZiAke21heExlbmd0aH0gY2hhcmFjdGVyc2ApO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUVtYWlsKGVtYWlsOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgY29uc3QgZW1haWxSZWdleCA9IC9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvO1xuICByZXR1cm4gZW1haWxSZWdleC50ZXN0KGVtYWlsKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlVXJsKHVybDogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcGFyc2VkID0gbmV3IFVSTCh1cmwpO1xuICAgIHJldHVybiBbJ2h0dHA6JywgJ2h0dHBzOiddLmluY2x1ZGVzKHBhcnNlZC5wcm90b2NvbCk7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVUb29sQ2FsbCh0b29sQ2FsbDogYW55LCBjb250ZXh0OiBzdHJpbmcgPSAnVG9vbCBjYWxsJyk6IHZvaWQge1xuICBpZiAoIXRvb2xDYWxsIHx8IHR5cGVvZiB0b29sQ2FsbCAhPT0gJ29iamVjdCcpIHtcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKGAke2NvbnRleHR9IG11c3QgYmUgYSB2YWxpZCBvYmplY3RgKTtcbiAgfVxuXG4gIGlmICghdG9vbENhbGwuaWQgfHwgdHlwZW9mIHRvb2xDYWxsLmlkICE9PSAnc3RyaW5nJykge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoYCR7Y29udGV4dH0gbXVzdCBoYXZlIGEgdmFsaWQgaWRgKTtcbiAgfVxuXG4gIC8vIFZhbGlkYXRlIHRvb2wgY2FsbCBJRCBmb3JtYXRcbiAgaWYgKCEvXlthLXpBLVowLTlfLV0rJC8udGVzdCh0b29sQ2FsbC5pZCkpIHtcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKGAke2NvbnRleHR9IGhhcyBpbnZhbGlkIElEIGZvcm1hdGApO1xuICB9XG5cbiAgaWYgKHRvb2xDYWxsLnR5cGUgIT09ICdmdW5jdGlvbicpIHtcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKGAke2NvbnRleHR9IHR5cGUgbXVzdCBiZSBcImZ1bmN0aW9uXCJgKTtcbiAgfVxuXG4gIGlmICghdG9vbENhbGwuZnVuY3Rpb24gfHwgdHlwZW9mIHRvb2xDYWxsLmZ1bmN0aW9uICE9PSAnb2JqZWN0Jykge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoYCR7Y29udGV4dH0gbXVzdCBoYXZlIGEgdmFsaWQgZnVuY3Rpb24gb2JqZWN0YCk7XG4gIH1cblxuICBpZiAoIXRvb2xDYWxsLmZ1bmN0aW9uLm5hbWUgfHwgdHlwZW9mIHRvb2xDYWxsLmZ1bmN0aW9uLm5hbWUgIT09ICdzdHJpbmcnKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihgJHtjb250ZXh0fSBmdW5jdGlvbiBtdXN0IGhhdmUgYSB2YWxpZCBuYW1lYCk7XG4gIH1cblxuICAvLyBWYWxpZGF0ZSBmdW5jdGlvbiBuYW1lIGZvcm1hdCAocHJldmVudCBpbmplY3Rpb24pXG4gIGlmICghL15bYS16QS1aXVthLXpBLVowLTlfXSokLy50ZXN0KHRvb2xDYWxsLmZ1bmN0aW9uLm5hbWUpKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihgJHtjb250ZXh0fSBmdW5jdGlvbiBuYW1lIGhhcyBpbnZhbGlkIGZvcm1hdGApO1xuICB9XG5cbiAgdmFsaWRhdGVTdHJpbmdMZW5ndGgodG9vbENhbGwuZnVuY3Rpb24ubmFtZSwgYCR7Y29udGV4dH0gZnVuY3Rpb24gbmFtZWAsIDEwMCk7XG5cbiAgaWYgKHR5cGVvZiB0b29sQ2FsbC5mdW5jdGlvbi5hcmd1bWVudHMgIT09ICdzdHJpbmcnKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihgJHtjb250ZXh0fSBmdW5jdGlvbiBhcmd1bWVudHMgbXVzdCBiZSBhIHN0cmluZ2ApO1xuICB9XG5cbiAgLy8gVmFsaWRhdGUgYXJndW1lbnRzIGFzIEpTT05cbiAgdHJ5IHtcbiAgICBKU09OLnBhcnNlKHRvb2xDYWxsLmZ1bmN0aW9uLmFyZ3VtZW50cyk7XG4gIH0gY2F0Y2gge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoYCR7Y29udGV4dH0gZnVuY3Rpb24gYXJndW1lbnRzIG11c3QgYmUgdmFsaWQgSlNPTmApO1xuICB9XG5cbiAgdmFsaWRhdGVTdHJpbmdMZW5ndGgodG9vbENhbGwuZnVuY3Rpb24uYXJndW1lbnRzLCBgJHtjb250ZXh0fSBmdW5jdGlvbiBhcmd1bWVudHNgLCAxMDAwMCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUFwaUtleShhcGlLZXk6IHN0cmluZywgcHJvdmlkZXI6IHN0cmluZyk6IHZvaWQge1xuICBpZiAoIWFwaUtleSB8fCB0eXBlb2YgYXBpS2V5ICE9PSAnc3RyaW5nJykge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ0FQSSBrZXkgbXVzdCBiZSBhIHZhbGlkIHN0cmluZycpO1xuICB9XG5cbiAgLy8gQmFzaWMgbGVuZ3RoIHZhbGlkYXRpb25cbiAgaWYgKGFwaUtleS5sZW5ndGggPCAxMCkge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ0FQSSBrZXkgaXMgdG9vIHNob3J0Jyk7XG4gIH1cblxuICBpZiAoYXBpS2V5Lmxlbmd0aCA+IDIwMCkge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ0FQSSBrZXkgaXMgdG9vIGxvbmcnKTtcbiAgfVxuXG4gIC8vIFByb3ZpZGVyLXNwZWNpZmljIHZhbGlkYXRpb25cbiAgc3dpdGNoIChwcm92aWRlcikge1xuICAgIGNhc2UgJ29wZW5haSc6XG4gICAgICBpZiAoIWFwaUtleS5zdGFydHNXaXRoKCdzay0nKSkge1xuICAgICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCdPcGVuQUkgQVBJIGtleSBtdXN0IHN0YXJ0IHdpdGggXCJzay1cIicpO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnZGVlcHNlZWsnOlxuICAgICAgaWYgKCFhcGlLZXkuc3RhcnRzV2l0aCgnc2stJykpIHtcbiAgICAgICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignRGVlcFNlZWsgQVBJIGtleSBtdXN0IHN0YXJ0IHdpdGggXCJzay1cIicpO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnb3BlbnJvdXRlcic6XG4gICAgICBpZiAoIWFwaUtleS5zdGFydHNXaXRoKCdzay1vci0nKSkge1xuICAgICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCdPcGVuUm91dGVyIEFQSSBrZXkgbXVzdCBzdGFydCB3aXRoIFwic2stb3ItXCInKTtcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICB9XG5cbiAgLy8gQ2hlY2sgZm9yIHN1c3BpY2lvdXMgcGF0dGVybnNcbiAgY29uc3Qgc3VzcGljaW91c1BhdHRlcm5zID0gW1xuICAgIC9cXHMvLCAgLy8gTm8gd2hpdGVzcGFjZSBhbGxvd2VkXG4gICAgL1s8Pl0vLCAgLy8gTm8gYW5nbGUgYnJhY2tldHNcbiAgICAvamF2YXNjcmlwdDovaSwgIC8vIE5vIGphdmFzY3JpcHQgcHJvdG9jb2xcbiAgICAvZGF0YTovaSwgIC8vIE5vIGRhdGEgVVJMc1xuICBdO1xuXG4gIGZvciAoY29uc3QgcGF0dGVybiBvZiBzdXNwaWNpb3VzUGF0dGVybnMpIHtcbiAgICBpZiAocGF0dGVybi50ZXN0KGFwaUtleSkpIHtcbiAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ0FQSSBrZXkgY29udGFpbnMgaW52YWxpZCBjaGFyYWN0ZXJzJyk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZU1DUFNlcnZlckNvbmZpZyhjb25maWc6IGFueSk6IHZvaWQge1xuICBpZiAoIWNvbmZpZyB8fCB0eXBlb2YgY29uZmlnICE9PSAnb2JqZWN0Jykge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ01DUCBzZXJ2ZXIgY29uZmlnIG11c3QgYmUgYSB2YWxpZCBvYmplY3QnKTtcbiAgfVxuXG4gIGlmICghY29uZmlnLmlkIHx8IHR5cGVvZiBjb25maWcuaWQgIT09ICdzdHJpbmcnKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignTUNQIHNlcnZlciBjb25maWcgbXVzdCBoYXZlIGEgdmFsaWQgaWQnKTtcbiAgfVxuXG4gIC8vIFZhbGlkYXRlIElEIGZvcm1hdFxuICBpZiAoIS9eW2EtekEtWjAtOV8tXSskLy50ZXN0KGNvbmZpZy5pZCkpIHtcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCdNQ1Agc2VydmVyIGNvbmZpZyBJRCBoYXMgaW52YWxpZCBmb3JtYXQnKTtcbiAgfVxuXG4gIGlmICghY29uZmlnLm5hbWUgfHwgdHlwZW9mIGNvbmZpZy5uYW1lICE9PSAnc3RyaW5nJykge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ01DUCBzZXJ2ZXIgY29uZmlnIG11c3QgaGF2ZSBhIHZhbGlkIG5hbWUnKTtcbiAgfVxuXG4gIHZhbGlkYXRlU3RyaW5nTGVuZ3RoKGNvbmZpZy5uYW1lLCAnTUNQIHNlcnZlciBuYW1lJywgMTAwKTtcblxuICBpZiAoIWNvbmZpZy5jb21tYW5kIHx8IHR5cGVvZiBjb25maWcuY29tbWFuZCAhPT0gJ3N0cmluZycpIHtcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCdNQ1Agc2VydmVyIGNvbmZpZyBtdXN0IGhhdmUgYSB2YWxpZCBjb21tYW5kJyk7XG4gIH1cblxuICAvLyBWYWxpZGF0ZSBjb21tYW5kIChwcmV2ZW50IGNvbW1hbmQgaW5qZWN0aW9uKVxuICBpZiAoIS9eW2EtekEtWjAtOV8uL1xcLV0rJC8udGVzdChjb25maWcuY29tbWFuZCkpIHtcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCdNQ1Agc2VydmVyIGNvbW1hbmQgY29udGFpbnMgaW52YWxpZCBjaGFyYWN0ZXJzJyk7XG4gIH1cblxuICBpZiAoIUFycmF5LmlzQXJyYXkoY29uZmlnLmFyZ3MpKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignTUNQIHNlcnZlciBhcmdzIG11c3QgYmUgYW4gYXJyYXknKTtcbiAgfVxuXG4gIC8vIFZhbGlkYXRlIGVhY2ggYXJndW1lbnRcbiAgY29uZmlnLmFyZ3MuZm9yRWFjaCgoYXJnOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICBpZiAodHlwZW9mIGFyZyAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoYE1DUCBzZXJ2ZXIgYXJnIGF0IGluZGV4ICR7aW5kZXh9IG11c3QgYmUgYSBzdHJpbmdgKTtcbiAgICB9XG4gICAgdmFsaWRhdGVTdHJpbmdMZW5ndGgoYXJnLCBgTUNQIHNlcnZlciBhcmcgJHtpbmRleH1gLCA1MDApO1xuICB9KTtcblxuICAvLyBWYWxpZGF0ZSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgaWYgcHJlc2VudFxuICBpZiAoY29uZmlnLmVudiAmJiB0eXBlb2YgY29uZmlnLmVudiA9PT0gJ29iamVjdCcpIHtcbiAgICBPYmplY3QuZW50cmllcyhjb25maWcuZW52KS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgIGlmICh0eXBlb2Yga2V5ICE9PSAnc3RyaW5nJyB8fCB0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ01DUCBzZXJ2ZXIgZW52aXJvbm1lbnQgdmFyaWFibGVzIG11c3QgYmUgc3RyaW5ncycpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBWYWxpZGF0ZSBlbnZpcm9ubWVudCB2YXJpYWJsZSBuYW1lc1xuICAgICAgaWYgKCEvXltBLVpfXVtBLVowLTlfXSokLy50ZXN0KGtleSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihgSW52YWxpZCBlbnZpcm9ubWVudCB2YXJpYWJsZSBuYW1lOiAke2tleX1gKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdmFsaWRhdGVTdHJpbmdMZW5ndGgoa2V5LCAnRW52aXJvbm1lbnQgdmFyaWFibGUgbmFtZScsIDEwMCk7XG4gICAgICB2YWxpZGF0ZVN0cmluZ0xlbmd0aCh2YWx1ZSBhcyBzdHJpbmcsICdFbnZpcm9ubWVudCB2YXJpYWJsZSB2YWx1ZScsIDEwMDApO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVVzZXJQcmVmZXJlbmNlcyhwcmVmZXJlbmNlczogYW55KTogdm9pZCB7XG4gIGlmICghcHJlZmVyZW5jZXMgfHwgdHlwZW9mIHByZWZlcmVuY2VzICE9PSAnb2JqZWN0Jykge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ1VzZXIgcHJlZmVyZW5jZXMgbXVzdCBiZSBhIHZhbGlkIG9iamVjdCcpO1xuICB9XG5cbiAgaWYgKHByZWZlcmVuY2VzLnRoZW1lICYmICFbJ2xpZ2h0JywgJ2RhcmsnLCAnc3lzdGVtJ10uaW5jbHVkZXMocHJlZmVyZW5jZXMudGhlbWUpKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignVGhlbWUgbXVzdCBiZSBvbmUgb2Y6IGxpZ2h0LCBkYXJrLCBzeXN0ZW0nKTtcbiAgfVxuXG4gIGlmIChwcmVmZXJlbmNlcy5sYW5ndWFnZSAmJiAhWydlbicsICd6aCddLmluY2x1ZGVzKHByZWZlcmVuY2VzLmxhbmd1YWdlKSkge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ0xhbmd1YWdlIG11c3QgYmUgb25lIG9mOiBlbiwgemgnKTtcbiAgfVxuXG4gIGlmIChwcmVmZXJlbmNlcy5hdXRvU2Nyb2xsICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHByZWZlcmVuY2VzLmF1dG9TY3JvbGwgIT09ICdib29sZWFuJykge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ2F1dG9TY3JvbGwgbXVzdCBiZSBhIGJvb2xlYW4nKTtcbiAgfVxuXG4gIGlmIChwcmVmZXJlbmNlcy5zb3VuZEVuYWJsZWQgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2YgcHJlZmVyZW5jZXMuc291bmRFbmFibGVkICE9PSAnYm9vbGVhbicpIHtcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCdzb3VuZEVuYWJsZWQgbXVzdCBiZSBhIGJvb2xlYW4nKTtcbiAgfVxufSJdLCJuYW1lcyI6WyJWYWxpZGF0aW9uRXJyb3IiLCJ2YWxpZGF0ZUNoYXRSZXF1ZXN0IiwiZGF0YSIsIm1lc3NhZ2VzIiwic2Vzc2lvbklkIiwicHJvdmlkZXIiLCJtb2RlbCIsImFwaUtleSIsImJhc2VVcmwiLCJzeXN0ZW1Qcm9tcHQiLCJ0ZW1wZXJhdHVyZSIsIm1heFRva2VucyIsImF2YWlsYWJsZVRvb2xzIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiZm9yRWFjaCIsIm1lc3NhZ2UiLCJpbmRleCIsImlkIiwidHJpbSIsInRlc3QiLCJyb2xlIiwiaW5jbHVkZXMiLCJjb250ZW50IiwidmFsaWRhdGVTdHJpbmdMZW5ndGgiLCJzYW5pdGl6ZUlucHV0IiwidGltZXN0YW1wIiwiRGF0ZSIsImlzTmFOIiwicGFyc2UiLCJ0b29sQ2FsbHMiLCJ0b29sQ2FsbCIsInRvb2xJbmRleCIsInZhbGlkYXRlVG9vbENhbGwiLCJ1bmRlZmluZWQiLCJtYXAiLCJtc2ciLCJ2YWxpZGF0ZVJ1blRvb2xSZXF1ZXN0IiwidmFsaWRhdGVTZXR0aW5ncyIsImxsbVByb3ZpZGVycyIsIm5hbWUiLCJ2YWxpZGF0ZUFwaUtleSIsInZhbGlkYXRlVXJsIiwibWNwU2VydmVycyIsInNlcnZlciIsInZhbGlkYXRlTUNQU2VydmVyQ29uZmlnIiwiZXJyb3IiLCJwcmVmZXJlbmNlcyIsInZhbGlkYXRlVXNlclByZWZlcmVuY2VzIiwiaW5wdXQiLCJyZXBsYWNlIiwiZmllbGROYW1lIiwibWF4TGVuZ3RoIiwidmFsaWRhdGVFbWFpbCIsImVtYWlsIiwiZW1haWxSZWdleCIsInVybCIsInBhcnNlZCIsIlVSTCIsInByb3RvY29sIiwiY29udGV4dCIsInR5cGUiLCJmdW5jdGlvbiIsImFyZ3VtZW50cyIsIkpTT04iLCJzdGFydHNXaXRoIiwic3VzcGljaW91c1BhdHRlcm5zIiwicGF0dGVybiIsImNvbmZpZyIsImNvbW1hbmQiLCJhcmdzIiwiYXJnIiwiZW52IiwiT2JqZWN0IiwiZW50cmllcyIsImtleSIsInZhbHVlIiwidGhlbWUiLCJsYW5ndWFnZSIsImF1dG9TY3JvbGwiLCJzb3VuZEVuYWJsZWQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/validation.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/SecureSettingsManager.ts":
/*!***********************************************!*\
  !*** ./src/services/SecureSettingsManager.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SecureSettingsManager: () => (/* binding */ SecureSettingsManager),\n/* harmony export */   getSecureSettingsManager: () => (/* binding */ getSecureSettingsManager),\n/* harmony export */   initializeSecureSettingsManager: () => (/* binding */ initializeSecureSettingsManager)\n/* harmony export */ });\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_encryption__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/encryption */ \"(rsc)/./src/lib/encryption.ts\");\n/* harmony import */ var _lib_errors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/errors */ \"(rsc)/./src/lib/errors.ts\");\n\n\n\n\nclass SecureSettingsManager {\n    constructor(settingsDir = './data/settings'){\n        this.encryptionService = (0,_lib_encryption__WEBPACK_IMPORTED_MODULE_2__.getEncryptionService)();\n        this.settingsDir = settingsDir;\n        this.settingsFile = path__WEBPACK_IMPORTED_MODULE_1___default().join(settingsDir, 'settings.json');\n        this.settings = this.getDefaultSettings();\n    }\n    /**\n   * Initialize the settings manager and load existing settings\n   */ async initialize() {\n        try {\n            await this.ensureSettingsDirectory();\n            await this.loadSettings();\n        } catch (error) {\n            console.error('Failed to initialize SecureSettingsManager:', error);\n            throw new _lib_errors__WEBPACK_IMPORTED_MODULE_3__.InternalServerError('Failed to initialize settings storage');\n        }\n    }\n    /**\n   * Get current settings with masked API keys for frontend display\n   */ async getSettings() {\n        const settings = {\n            ...this.settings\n        };\n        // Mask API keys for frontend display\n        settings.llmProviders = settings.llmProviders.map((provider)=>({\n                ...provider,\n                apiKey: this.encryptionService.maskApiKey(provider.apiKey ? this.encryptionService.decrypt(provider.apiKey) : '')\n            }));\n        return settings;\n    }\n    /**\n   * Update settings with secure API key handling\n   */ async updateSettings(newSettings) {\n        try {\n            // Handle LLM provider updates with encryption\n            if (newSettings.llmProviders) {\n                const updatedProviders = [];\n                for (const provider of newSettings.llmProviders){\n                    const existingProvider = this.settings.llmProviders.find((p)=>p.id === provider.id);\n                    let encryptedApiKey = '';\n                    let apiKeyHash = '';\n                    if (provider.apiKey) {\n                        // Check if API key is already masked (unchanged from frontend)\n                        if (provider.apiKey.includes('*')) {\n                            // Keep existing encrypted key\n                            if (existingProvider) {\n                                encryptedApiKey = existingProvider.apiKey;\n                                apiKeyHash = existingProvider.apiKeyHash || '';\n                            }\n                        } else {\n                            // New or updated API key - encrypt it\n                            encryptedApiKey = this.encryptionService.encrypt(provider.apiKey);\n                            apiKeyHash = this.encryptionService.hash(provider.apiKey);\n                        }\n                    }\n                    updatedProviders.push({\n                        ...provider,\n                        apiKey: encryptedApiKey,\n                        apiKeyHash\n                    });\n                }\n                this.settings.llmProviders = updatedProviders;\n            }\n            // Update other settings\n            if (newSettings.mcpServers) {\n                this.settings.mcpServers = newSettings.mcpServers;\n            }\n            if (newSettings.preferences) {\n                this.settings.preferences = {\n                    ...this.settings.preferences,\n                    ...newSettings.preferences\n                };\n            }\n            await this.saveSettings();\n            return this.getSettings();\n        } catch (error) {\n            console.error('Failed to update settings:', error);\n            throw new _lib_errors__WEBPACK_IMPORTED_MODULE_3__.InternalServerError('Failed to update settings');\n        }\n    }\n    /**\n   * Get decrypted API key for a specific provider (for backend use only)\n   */ async getDecryptedApiKey(providerId) {\n        const provider = this.settings.llmProviders.find((p)=>p.id === providerId);\n        if (!provider || !provider.apiKey) {\n            throw new _lib_errors__WEBPACK_IMPORTED_MODULE_3__.ValidationError(`API key not found for provider: ${providerId}`);\n        }\n        try {\n            return this.encryptionService.decrypt(provider.apiKey);\n        } catch (error) {\n            console.error(`Failed to decrypt API key for provider ${providerId}:`, error);\n            throw new _lib_errors__WEBPACK_IMPORTED_MODULE_3__.InternalServerError('Failed to decrypt API key');\n        }\n    }\n    /**\n   * Validate API key without storing it\n   */ async validateApiKey(provider, apiKey, baseUrl) {\n        // This would integrate with LLMService to test the API key\n        // For now, just validate format\n        if (!apiKey || apiKey.length < 10) {\n            return false;\n        }\n        // Basic format validation based on provider\n        switch(provider){\n            case 'openai':\n                return apiKey.startsWith('sk-') && apiKey.length > 20;\n            case 'deepseek':\n                return apiKey.startsWith('sk-') && apiKey.length > 20;\n            case 'openrouter':\n                return apiKey.startsWith('sk-or-') && apiKey.length > 30;\n            default:\n                return apiKey.length > 10;\n        }\n    }\n    /**\n   * Export settings for backup (excludes sensitive data)\n   */ async exportSettings() {\n        return {\n            version: '1.0.0',\n            exportDate: new Date().toISOString(),\n            settings: {\n                preferences: this.settings.preferences,\n                mcpServers: this.settings.mcpServers.map((server)=>({\n                        ...server,\n                        // Remove any sensitive environment variables\n                        env: server.env ? this.sanitizeEnvironmentVariables(server.env) : undefined\n                    }))\n            }\n        };\n    }\n    /**\n   * Import settings from backup (user must re-enter API keys)\n   */ async importSettings(exportData) {\n        try {\n            if (exportData.version !== '1.0.0') {\n                throw new _lib_errors__WEBPACK_IMPORTED_MODULE_3__.ValidationError('Unsupported settings export version');\n            }\n            // Import non-sensitive settings\n            await this.updateSettings({\n                preferences: exportData.settings.preferences,\n                mcpServers: exportData.settings.mcpServers\n            });\n        } catch (error) {\n            console.error('Failed to import settings:', error);\n            throw new _lib_errors__WEBPACK_IMPORTED_MODULE_3__.InternalServerError('Failed to import settings');\n        }\n    }\n    /**\n   * Clear all sensitive data (API keys)\n   */ async clearSensitiveData() {\n        this.settings.llmProviders = this.settings.llmProviders.map((provider)=>({\n                ...provider,\n                apiKey: '',\n                apiKeyHash: ''\n            }));\n        await this.saveSettings();\n    }\n    /**\n   * Get settings statistics for monitoring\n   */ getStatistics() {\n        const providersWithKeys = this.settings.llmProviders.filter((p)=>p.apiKey).length;\n        const enabledMcpServers = this.settings.mcpServers.filter((s)=>s.enabled).length;\n        return {\n            totalProviders: this.settings.llmProviders.length,\n            providersWithKeys,\n            totalMcpServers: this.settings.mcpServers.length,\n            enabledMcpServers,\n            lastUpdated: new Date().toISOString()\n        };\n    }\n    // Private methods\n    getDefaultSettings() {\n        return {\n            llmProviders: [\n                {\n                    id: 'openai-1',\n                    name: 'openai',\n                    apiKey: '',\n                    baseUrl: 'https://api.openai.com/v1',\n                    models: [\n                        {\n                            id: 'gpt-4',\n                            name: 'GPT-4',\n                            supportsToolCalling: true,\n                            maxTokens: 8192\n                        },\n                        {\n                            id: 'gpt-3.5-turbo',\n                            name: 'GPT-3.5 Turbo',\n                            supportsToolCalling: true,\n                            maxTokens: 4096\n                        }\n                    ]\n                },\n                {\n                    id: 'deepseek-1',\n                    name: 'deepseek',\n                    apiKey: '',\n                    baseUrl: 'https://api.deepseek.com/v1',\n                    models: [\n                        {\n                            id: 'deepseek-chat',\n                            name: 'DeepSeek Chat',\n                            supportsToolCalling: true,\n                            maxTokens: 4096\n                        }\n                    ]\n                },\n                {\n                    id: 'openrouter-1',\n                    name: 'openrouter',\n                    apiKey: '',\n                    baseUrl: 'https://openrouter.ai/api/v1',\n                    models: [\n                        {\n                            id: 'openai/gpt-4',\n                            name: 'GPT-4 (OpenRouter)',\n                            supportsToolCalling: true,\n                            maxTokens: 8192\n                        }\n                    ]\n                }\n            ],\n            mcpServers: [\n                {\n                    id: 'filesystem-1',\n                    name: 'filesystem',\n                    command: 'npx',\n                    args: [\n                        '-y',\n                        '@modelcontextprotocol/server-filesystem',\n                        '/tmp'\n                    ],\n                    enabled: false,\n                    status: 'disconnected'\n                }\n            ],\n            preferences: {\n                theme: 'system',\n                language: 'en',\n                autoScroll: true,\n                soundEnabled: false\n            }\n        };\n    }\n    async ensureSettingsDirectory() {\n        try {\n            await fs__WEBPACK_IMPORTED_MODULE_0__.promises.mkdir(this.settingsDir, {\n                recursive: true\n            });\n        } catch (error) {\n            throw new _lib_errors__WEBPACK_IMPORTED_MODULE_3__.InternalServerError(`Failed to create settings directory: ${error}`);\n        }\n    }\n    async loadSettings() {\n        try {\n            const data = await fs__WEBPACK_IMPORTED_MODULE_0__.promises.readFile(this.settingsFile, 'utf-8');\n            const parsed = JSON.parse(data);\n            // Validate and merge with defaults\n            this.settings = {\n                ...this.getDefaultSettings(),\n                ...parsed\n            };\n        } catch (error) {\n            if (error.code === 'ENOENT') {\n                // File doesn't exist, use defaults and save\n                this.settings = this.getDefaultSettings();\n                await this.saveSettings();\n            } else {\n                console.error('Failed to load settings:', error);\n                throw new _lib_errors__WEBPACK_IMPORTED_MODULE_3__.InternalServerError('Failed to load settings data');\n            }\n        }\n    }\n    async saveSettings() {\n        try {\n            const data = JSON.stringify(this.settings, null, 2);\n            await fs__WEBPACK_IMPORTED_MODULE_0__.promises.writeFile(this.settingsFile, data, 'utf-8');\n        } catch (error) {\n            console.error('Failed to save settings:', error);\n            throw new _lib_errors__WEBPACK_IMPORTED_MODULE_3__.InternalServerError('Failed to save settings data');\n        }\n    }\n    sanitizeEnvironmentVariables(env) {\n        const sanitized = {};\n        const sensitiveKeys = [\n            'api_key',\n            'secret',\n            'token',\n            'password',\n            'key'\n        ];\n        for (const [key, value] of Object.entries(env)){\n            const lowerKey = key.toLowerCase();\n            const isSensitive = sensitiveKeys.some((sensitive)=>lowerKey.includes(sensitive));\n            if (isSensitive) {\n                sanitized[key] = '[REDACTED]';\n            } else {\n                sanitized[key] = value;\n            }\n        }\n        return sanitized;\n    }\n}\n// Singleton instance\nlet settingsManagerInstance = null;\nfunction getSecureSettingsManager() {\n    if (!settingsManagerInstance) {\n        settingsManagerInstance = new SecureSettingsManager();\n    }\n    return settingsManagerInstance;\n}\nasync function initializeSecureSettingsManager() {\n    const manager = getSecureSettingsManager();\n    await manager.initialize();\n    return manager;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMvU2VjdXJlU2V0dGluZ3NNYW5hZ2VyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFvQztBQUNaO0FBRWdDO0FBQ1k7QUFxQjdELE1BQU1NO0lBTVgsWUFBWUMsY0FBc0IsaUJBQWlCLENBQUU7YUFIcENDLG9CQUFvQkwscUVBQW9CQTtRQUl2RCxJQUFJLENBQUNJLFdBQVcsR0FBR0E7UUFDbkIsSUFBSSxDQUFDRSxZQUFZLEdBQUdQLGdEQUFTLENBQUNLLGFBQWE7UUFDM0MsSUFBSSxDQUFDSSxRQUFRLEdBQUcsSUFBSSxDQUFDQyxrQkFBa0I7SUFDekM7SUFFQTs7R0FFQyxHQUNELE1BQU1DLGFBQTRCO1FBQ2hDLElBQUk7WUFDRixNQUFNLElBQUksQ0FBQ0MsdUJBQXVCO1lBQ2xDLE1BQU0sSUFBSSxDQUFDQyxZQUFZO1FBQ3pCLEVBQUUsT0FBT0MsT0FBTztZQUNkQyxRQUFRRCxLQUFLLENBQUMsK0NBQStDQTtZQUM3RCxNQUFNLElBQUlaLDREQUFtQkEsQ0FBQztRQUNoQztJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFNYyxjQUFpQztRQUNyQyxNQUFNUCxXQUFXO1lBQUUsR0FBRyxJQUFJLENBQUNBLFFBQVE7UUFBQztRQUVwQyxxQ0FBcUM7UUFDckNBLFNBQVNRLFlBQVksR0FBR1IsU0FBU1EsWUFBWSxDQUFDQyxHQUFHLENBQUNDLENBQUFBLFdBQWE7Z0JBQzdELEdBQUdBLFFBQVE7Z0JBQ1hDLFFBQVEsSUFBSSxDQUFDZCxpQkFBaUIsQ0FBQ2UsVUFBVSxDQUN2Q0YsU0FBU0MsTUFBTSxHQUFHLElBQUksQ0FBQ2QsaUJBQWlCLENBQUNnQixPQUFPLENBQUNILFNBQVNDLE1BQU0sSUFBSTtZQUV4RTtRQUVBLE9BQU9YO0lBQ1Q7SUFFQTs7R0FFQyxHQUNELE1BQU1jLGVBQWVDLFdBQThCLEVBQXFCO1FBQ3RFLElBQUk7WUFDRiw4Q0FBOEM7WUFDOUMsSUFBSUEsWUFBWVAsWUFBWSxFQUFFO2dCQUM1QixNQUFN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QixPQUFPMEY7QUFDVCIsInNvdXJjZXMiOlsiL1VzZXJzL29uZWJpcmQvZ2l0aHViL2Vib29rLW1jcC9tY3AtY2hhdC11aS9iYWNrZW5kL3NyYy9zZXJ2aWNlcy9TZWN1cmVTZXR0aW5nc01hbmFnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcHJvbWlzZXMgYXMgZnMgfSBmcm9tICdmcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IFNldHRpbmdzLCBMTE1Qcm92aWRlckNvbmZpZywgTUNQU2VydmVyQ29uZmlnLCBVc2VyUHJlZmVyZW5jZXMgfSBmcm9tICdAL3R5cGVzJztcbmltcG9ydCB7IGdldEVuY3J5cHRpb25TZXJ2aWNlIH0gZnJvbSAnQC9saWIvZW5jcnlwdGlvbic7XG5pbXBvcnQgeyBJbnRlcm5hbFNlcnZlckVycm9yLCBWYWxpZGF0aW9uRXJyb3IgfSBmcm9tICdAL2xpYi9lcnJvcnMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFNlY3VyZVNldHRpbmdzIGV4dGVuZHMgT21pdDxTZXR0aW5ncywgJ2xsbVByb3ZpZGVycyc+IHtcbiAgbGxtUHJvdmlkZXJzOiBTZWN1cmVMTE1Qcm92aWRlckNvbmZpZ1tdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlY3VyZUxMTVByb3ZpZGVyQ29uZmlnIGV4dGVuZHMgT21pdDxMTE1Qcm92aWRlckNvbmZpZywgJ2FwaUtleSc+IHtcbiAgYXBpS2V5OiBzdHJpbmc7IC8vIFRoaXMgd2lsbCBiZSBlbmNyeXB0ZWRcbiAgYXBpS2V5SGFzaD86IHN0cmluZzsgLy8gRm9yIHZhbGlkYXRpb24gd2l0aG91dCBkZWNyeXB0aW9uXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2V0dGluZ3NFeHBvcnQge1xuICB2ZXJzaW9uOiBzdHJpbmc7XG4gIGV4cG9ydERhdGU6IHN0cmluZztcbiAgc2V0dGluZ3M6IHtcbiAgICBwcmVmZXJlbmNlczogVXNlclByZWZlcmVuY2VzO1xuICAgIG1jcFNlcnZlcnM6IE1DUFNlcnZlckNvbmZpZ1tdO1xuICAgIC8vIEFQSSBrZXlzIGFyZSBleGNsdWRlZCBmcm9tIGV4cG9ydHMgZm9yIHNlY3VyaXR5XG4gIH07XG59XG5cbmV4cG9ydCBjbGFzcyBTZWN1cmVTZXR0aW5nc01hbmFnZXIge1xuICBwcml2YXRlIHJlYWRvbmx5IHNldHRpbmdzRGlyOiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgc2V0dGluZ3NGaWxlOiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgZW5jcnlwdGlvblNlcnZpY2UgPSBnZXRFbmNyeXB0aW9uU2VydmljZSgpO1xuICBwcml2YXRlIHNldHRpbmdzOiBTZWN1cmVTZXR0aW5ncztcblxuICBjb25zdHJ1Y3RvcihzZXR0aW5nc0Rpcjogc3RyaW5nID0gJy4vZGF0YS9zZXR0aW5ncycpIHtcbiAgICB0aGlzLnNldHRpbmdzRGlyID0gc2V0dGluZ3NEaXI7XG4gICAgdGhpcy5zZXR0aW5nc0ZpbGUgPSBwYXRoLmpvaW4oc2V0dGluZ3NEaXIsICdzZXR0aW5ncy5qc29uJyk7XG4gICAgdGhpcy5zZXR0aW5ncyA9IHRoaXMuZ2V0RGVmYXVsdFNldHRpbmdzKCk7XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSB0aGUgc2V0dGluZ3MgbWFuYWdlciBhbmQgbG9hZCBleGlzdGluZyBzZXR0aW5nc1xuICAgKi9cbiAgYXN5bmMgaW5pdGlhbGl6ZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5lbnN1cmVTZXR0aW5nc0RpcmVjdG9yeSgpO1xuICAgICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgU2VjdXJlU2V0dGluZ3NNYW5hZ2VyOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yKCdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBzZXR0aW5ncyBzdG9yYWdlJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IHNldHRpbmdzIHdpdGggbWFza2VkIEFQSSBrZXlzIGZvciBmcm9udGVuZCBkaXNwbGF5XG4gICAqL1xuICBhc3luYyBnZXRTZXR0aW5ncygpOiBQcm9taXNlPFNldHRpbmdzPiB7XG4gICAgY29uc3Qgc2V0dGluZ3MgPSB7IC4uLnRoaXMuc2V0dGluZ3MgfTtcbiAgICBcbiAgICAvLyBNYXNrIEFQSSBrZXlzIGZvciBmcm9udGVuZCBkaXNwbGF5XG4gICAgc2V0dGluZ3MubGxtUHJvdmlkZXJzID0gc2V0dGluZ3MubGxtUHJvdmlkZXJzLm1hcChwcm92aWRlciA9PiAoe1xuICAgICAgLi4ucHJvdmlkZXIsXG4gICAgICBhcGlLZXk6IHRoaXMuZW5jcnlwdGlvblNlcnZpY2UubWFza0FwaUtleShcbiAgICAgICAgcHJvdmlkZXIuYXBpS2V5ID8gdGhpcy5lbmNyeXB0aW9uU2VydmljZS5kZWNyeXB0KHByb3ZpZGVyLmFwaUtleSkgOiAnJ1xuICAgICAgKSxcbiAgICB9KSk7XG5cbiAgICByZXR1cm4gc2V0dGluZ3M7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHNldHRpbmdzIHdpdGggc2VjdXJlIEFQSSBrZXkgaGFuZGxpbmdcbiAgICovXG4gIGFzeW5jIHVwZGF0ZVNldHRpbmdzKG5ld1NldHRpbmdzOiBQYXJ0aWFsPFNldHRpbmdzPik6IFByb21pc2U8U2V0dGluZ3M+IHtcbiAgICB0cnkge1xuICAgICAgLy8gSGFuZGxlIExMTSBwcm92aWRlciB1cGRhdGVzIHdpdGggZW5jcnlwdGlvblxuICAgICAgaWYgKG5ld1NldHRpbmdzLmxsbVByb3ZpZGVycykge1xuICAgICAgICBjb25zdCB1cGRhdGVkUHJvdmlkZXJzOiBTZWN1cmVMTE1Qcm92aWRlckNvbmZpZ1tdID0gW107XG4gICAgICAgIFxuICAgICAgICBmb3IgKGNvbnN0IHByb3ZpZGVyIG9mIG5ld1NldHRpbmdzLmxsbVByb3ZpZGVycykge1xuICAgICAgICAgIGNvbnN0IGV4aXN0aW5nUHJvdmlkZXIgPSB0aGlzLnNldHRpbmdzLmxsbVByb3ZpZGVycy5maW5kKHAgPT4gcC5pZCA9PT0gcHJvdmlkZXIuaWQpO1xuICAgICAgICAgIFxuICAgICAgICAgIGxldCBlbmNyeXB0ZWRBcGlLZXkgPSAnJztcbiAgICAgICAgICBsZXQgYXBpS2V5SGFzaCA9ICcnO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmIChwcm92aWRlci5hcGlLZXkpIHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIEFQSSBrZXkgaXMgYWxyZWFkeSBtYXNrZWQgKHVuY2hhbmdlZCBmcm9tIGZyb250ZW5kKVxuICAgICAgICAgICAgaWYgKHByb3ZpZGVyLmFwaUtleS5pbmNsdWRlcygnKicpKSB7XG4gICAgICAgICAgICAgIC8vIEtlZXAgZXhpc3RpbmcgZW5jcnlwdGVkIGtleVxuICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdQcm92aWRlcikge1xuICAgICAgICAgICAgICAgIGVuY3J5cHRlZEFwaUtleSA9IGV4aXN0aW5nUHJvdmlkZXIuYXBpS2V5O1xuICAgICAgICAgICAgICAgIGFwaUtleUhhc2ggPSBleGlzdGluZ1Byb3ZpZGVyLmFwaUtleUhhc2ggfHwgJyc7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIE5ldyBvciB1cGRhdGVkIEFQSSBrZXkgLSBlbmNyeXB0IGl0XG4gICAgICAgICAgICAgIGVuY3J5cHRlZEFwaUtleSA9IHRoaXMuZW5jcnlwdGlvblNlcnZpY2UuZW5jcnlwdChwcm92aWRlci5hcGlLZXkpO1xuICAgICAgICAgICAgICBhcGlLZXlIYXNoID0gdGhpcy5lbmNyeXB0aW9uU2VydmljZS5oYXNoKHByb3ZpZGVyLmFwaUtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdXBkYXRlZFByb3ZpZGVycy5wdXNoKHtcbiAgICAgICAgICAgIC4uLnByb3ZpZGVyLFxuICAgICAgICAgICAgYXBpS2V5OiBlbmNyeXB0ZWRBcGlLZXksXG4gICAgICAgICAgICBhcGlLZXlIYXNoLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICB0aGlzLnNldHRpbmdzLmxsbVByb3ZpZGVycyA9IHVwZGF0ZWRQcm92aWRlcnM7XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSBvdGhlciBzZXR0aW5nc1xuICAgICAgaWYgKG5ld1NldHRpbmdzLm1jcFNlcnZlcnMpIHtcbiAgICAgICAgdGhpcy5zZXR0aW5ncy5tY3BTZXJ2ZXJzID0gbmV3U2V0dGluZ3MubWNwU2VydmVycztcbiAgICAgIH1cblxuICAgICAgaWYgKG5ld1NldHRpbmdzLnByZWZlcmVuY2VzKSB7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MucHJlZmVyZW5jZXMgPSB7IC4uLnRoaXMuc2V0dGluZ3MucHJlZmVyZW5jZXMsIC4uLm5ld1NldHRpbmdzLnByZWZlcmVuY2VzIH07XG4gICAgICB9XG5cbiAgICAgIGF3YWl0IHRoaXMuc2F2ZVNldHRpbmdzKCk7XG4gICAgICByZXR1cm4gdGhpcy5nZXRTZXR0aW5ncygpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gdXBkYXRlIHNldHRpbmdzOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yKCdGYWlsZWQgdG8gdXBkYXRlIHNldHRpbmdzJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBkZWNyeXB0ZWQgQVBJIGtleSBmb3IgYSBzcGVjaWZpYyBwcm92aWRlciAoZm9yIGJhY2tlbmQgdXNlIG9ubHkpXG4gICAqL1xuICBhc3luYyBnZXREZWNyeXB0ZWRBcGlLZXkocHJvdmlkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBwcm92aWRlciA9IHRoaXMuc2V0dGluZ3MubGxtUHJvdmlkZXJzLmZpbmQocCA9PiBwLmlkID09PSBwcm92aWRlcklkKTtcbiAgICBpZiAoIXByb3ZpZGVyIHx8ICFwcm92aWRlci5hcGlLZXkpIHtcbiAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoYEFQSSBrZXkgbm90IGZvdW5kIGZvciBwcm92aWRlcjogJHtwcm92aWRlcklkfWApO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICByZXR1cm4gdGhpcy5lbmNyeXB0aW9uU2VydmljZS5kZWNyeXB0KHByb3ZpZGVyLmFwaUtleSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBkZWNyeXB0IEFQSSBrZXkgZm9yIHByb3ZpZGVyICR7cHJvdmlkZXJJZH06YCwgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3IoJ0ZhaWxlZCB0byBkZWNyeXB0IEFQSSBrZXknKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgQVBJIGtleSB3aXRob3V0IHN0b3JpbmcgaXRcbiAgICovXG4gIGFzeW5jIHZhbGlkYXRlQXBpS2V5KHByb3ZpZGVyOiBzdHJpbmcsIGFwaUtleTogc3RyaW5nLCBiYXNlVXJsPzogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgLy8gVGhpcyB3b3VsZCBpbnRlZ3JhdGUgd2l0aCBMTE1TZXJ2aWNlIHRvIHRlc3QgdGhlIEFQSSBrZXlcbiAgICAvLyBGb3Igbm93LCBqdXN0IHZhbGlkYXRlIGZvcm1hdFxuICAgIGlmICghYXBpS2V5IHx8IGFwaUtleS5sZW5ndGggPCAxMCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEJhc2ljIGZvcm1hdCB2YWxpZGF0aW9uIGJhc2VkIG9uIHByb3ZpZGVyXG4gICAgc3dpdGNoIChwcm92aWRlcikge1xuICAgICAgY2FzZSAnb3BlbmFpJzpcbiAgICAgICAgcmV0dXJuIGFwaUtleS5zdGFydHNXaXRoKCdzay0nKSAmJiBhcGlLZXkubGVuZ3RoID4gMjA7XG4gICAgICBjYXNlICdkZWVwc2Vlayc6XG4gICAgICAgIHJldHVybiBhcGlLZXkuc3RhcnRzV2l0aCgnc2stJykgJiYgYXBpS2V5Lmxlbmd0aCA+IDIwO1xuICAgICAgY2FzZSAnb3BlbnJvdXRlcic6XG4gICAgICAgIHJldHVybiBhcGlLZXkuc3RhcnRzV2l0aCgnc2stb3ItJykgJiYgYXBpS2V5Lmxlbmd0aCA+IDMwO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGFwaUtleS5sZW5ndGggPiAxMDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRXhwb3J0IHNldHRpbmdzIGZvciBiYWNrdXAgKGV4Y2x1ZGVzIHNlbnNpdGl2ZSBkYXRhKVxuICAgKi9cbiAgYXN5bmMgZXhwb3J0U2V0dGluZ3MoKTogUHJvbWlzZTxTZXR0aW5nc0V4cG9ydD4ge1xuICAgIHJldHVybiB7XG4gICAgICB2ZXJzaW9uOiAnMS4wLjAnLFxuICAgICAgZXhwb3J0RGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgcHJlZmVyZW5jZXM6IHRoaXMuc2V0dGluZ3MucHJlZmVyZW5jZXMsXG4gICAgICAgIG1jcFNlcnZlcnM6IHRoaXMuc2V0dGluZ3MubWNwU2VydmVycy5tYXAoc2VydmVyID0+ICh7XG4gICAgICAgICAgLi4uc2VydmVyLFxuICAgICAgICAgIC8vIFJlbW92ZSBhbnkgc2Vuc2l0aXZlIGVudmlyb25tZW50IHZhcmlhYmxlc1xuICAgICAgICAgIGVudjogc2VydmVyLmVudiA/IHRoaXMuc2FuaXRpemVFbnZpcm9ubWVudFZhcmlhYmxlcyhzZXJ2ZXIuZW52KSA6IHVuZGVmaW5lZCxcbiAgICAgICAgfSkpLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEltcG9ydCBzZXR0aW5ncyBmcm9tIGJhY2t1cCAodXNlciBtdXN0IHJlLWVudGVyIEFQSSBrZXlzKVxuICAgKi9cbiAgYXN5bmMgaW1wb3J0U2V0dGluZ3MoZXhwb3J0RGF0YTogU2V0dGluZ3NFeHBvcnQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKGV4cG9ydERhdGEudmVyc2lvbiAhPT0gJzEuMC4wJykge1xuICAgICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCdVbnN1cHBvcnRlZCBzZXR0aW5ncyBleHBvcnQgdmVyc2lvbicpO1xuICAgICAgfVxuXG4gICAgICAvLyBJbXBvcnQgbm9uLXNlbnNpdGl2ZSBzZXR0aW5nc1xuICAgICAgYXdhaXQgdGhpcy51cGRhdGVTZXR0aW5ncyh7XG4gICAgICAgIHByZWZlcmVuY2VzOiBleHBvcnREYXRhLnNldHRpbmdzLnByZWZlcmVuY2VzLFxuICAgICAgICBtY3BTZXJ2ZXJzOiBleHBvcnREYXRhLnNldHRpbmdzLm1jcFNlcnZlcnMsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGltcG9ydCBzZXR0aW5nczonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvcignRmFpbGVkIHRvIGltcG9ydCBzZXR0aW5ncycpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhciBhbGwgc2Vuc2l0aXZlIGRhdGEgKEFQSSBrZXlzKVxuICAgKi9cbiAgYXN5bmMgY2xlYXJTZW5zaXRpdmVEYXRhKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuc2V0dGluZ3MubGxtUHJvdmlkZXJzID0gdGhpcy5zZXR0aW5ncy5sbG1Qcm92aWRlcnMubWFwKHByb3ZpZGVyID0+ICh7XG4gICAgICAuLi5wcm92aWRlcixcbiAgICAgIGFwaUtleTogJycsXG4gICAgICBhcGlLZXlIYXNoOiAnJyxcbiAgICB9KSk7XG5cbiAgICBhd2FpdCB0aGlzLnNhdmVTZXR0aW5ncygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzZXR0aW5ncyBzdGF0aXN0aWNzIGZvciBtb25pdG9yaW5nXG4gICAqL1xuICBnZXRTdGF0aXN0aWNzKCk6IHtcbiAgICB0b3RhbFByb3ZpZGVyczogbnVtYmVyO1xuICAgIHByb3ZpZGVyc1dpdGhLZXlzOiBudW1iZXI7XG4gICAgdG90YWxNY3BTZXJ2ZXJzOiBudW1iZXI7XG4gICAgZW5hYmxlZE1jcFNlcnZlcnM6IG51bWJlcjtcbiAgICBsYXN0VXBkYXRlZDogc3RyaW5nO1xuICB9IHtcbiAgICBjb25zdCBwcm92aWRlcnNXaXRoS2V5cyA9IHRoaXMuc2V0dGluZ3MubGxtUHJvdmlkZXJzLmZpbHRlcihwID0+IHAuYXBpS2V5KS5sZW5ndGg7XG4gICAgY29uc3QgZW5hYmxlZE1jcFNlcnZlcnMgPSB0aGlzLnNldHRpbmdzLm1jcFNlcnZlcnMuZmlsdGVyKHMgPT4gcy5lbmFibGVkKS5sZW5ndGg7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxQcm92aWRlcnM6IHRoaXMuc2V0dGluZ3MubGxtUHJvdmlkZXJzLmxlbmd0aCxcbiAgICAgIHByb3ZpZGVyc1dpdGhLZXlzLFxuICAgICAgdG90YWxNY3BTZXJ2ZXJzOiB0aGlzLnNldHRpbmdzLm1jcFNlcnZlcnMubGVuZ3RoLFxuICAgICAgZW5hYmxlZE1jcFNlcnZlcnMsXG4gICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG4gIH1cblxuICAvLyBQcml2YXRlIG1ldGhvZHNcblxuICBwcml2YXRlIGdldERlZmF1bHRTZXR0aW5ncygpOiBTZWN1cmVTZXR0aW5ncyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxsbVByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdvcGVuYWktMScsXG4gICAgICAgICAgbmFtZTogJ29wZW5haScsXG4gICAgICAgICAgYXBpS2V5OiAnJyxcbiAgICAgICAgICBiYXNlVXJsOiAnaHR0cHM6Ly9hcGkub3BlbmFpLmNvbS92MScsXG4gICAgICAgICAgbW9kZWxzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGlkOiAnZ3B0LTQnLFxuICAgICAgICAgICAgICBuYW1lOiAnR1BULTQnLFxuICAgICAgICAgICAgICBzdXBwb3J0c1Rvb2xDYWxsaW5nOiB0cnVlLFxuICAgICAgICAgICAgICBtYXhUb2tlbnM6IDgxOTIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpZDogJ2dwdC0zLjUtdHVyYm8nLFxuICAgICAgICAgICAgICBuYW1lOiAnR1BULTMuNSBUdXJibycsXG4gICAgICAgICAgICAgIHN1cHBvcnRzVG9vbENhbGxpbmc6IHRydWUsXG4gICAgICAgICAgICAgIG1heFRva2VuczogNDA5NixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnZGVlcHNlZWstMScsXG4gICAgICAgICAgbmFtZTogJ2RlZXBzZWVrJyxcbiAgICAgICAgICBhcGlLZXk6ICcnLFxuICAgICAgICAgIGJhc2VVcmw6ICdodHRwczovL2FwaS5kZWVwc2Vlay5jb20vdjEnLFxuICAgICAgICAgIG1vZGVsczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpZDogJ2RlZXBzZWVrLWNoYXQnLFxuICAgICAgICAgICAgICBuYW1lOiAnRGVlcFNlZWsgQ2hhdCcsXG4gICAgICAgICAgICAgIHN1cHBvcnRzVG9vbENhbGxpbmc6IHRydWUsXG4gICAgICAgICAgICAgIG1heFRva2VuczogNDA5NixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnb3BlbnJvdXRlci0xJyxcbiAgICAgICAgICBuYW1lOiAnb3BlbnJvdXRlcicsXG4gICAgICAgICAgYXBpS2V5OiAnJyxcbiAgICAgICAgICBiYXNlVXJsOiAnaHR0cHM6Ly9vcGVucm91dGVyLmFpL2FwaS92MScsXG4gICAgICAgICAgbW9kZWxzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGlkOiAnb3BlbmFpL2dwdC00JyxcbiAgICAgICAgICAgICAgbmFtZTogJ0dQVC00IChPcGVuUm91dGVyKScsXG4gICAgICAgICAgICAgIHN1cHBvcnRzVG9vbENhbGxpbmc6IHRydWUsXG4gICAgICAgICAgICAgIG1heFRva2VuczogODE5MixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBtY3BTZXJ2ZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogJ2ZpbGVzeXN0ZW0tMScsXG4gICAgICAgICAgbmFtZTogJ2ZpbGVzeXN0ZW0nLFxuICAgICAgICAgIGNvbW1hbmQ6ICducHgnLFxuICAgICAgICAgIGFyZ3M6IFsnLXknLCAnQG1vZGVsY29udGV4dHByb3RvY29sL3NlcnZlci1maWxlc3lzdGVtJywgJy90bXAnXSxcbiAgICAgICAgICBlbmFibGVkOiBmYWxzZSxcbiAgICAgICAgICBzdGF0dXM6ICdkaXNjb25uZWN0ZWQnLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIHByZWZlcmVuY2VzOiB7XG4gICAgICAgIHRoZW1lOiAnc3lzdGVtJyxcbiAgICAgICAgbGFuZ3VhZ2U6ICdlbicsXG4gICAgICAgIGF1dG9TY3JvbGw6IHRydWUsXG4gICAgICAgIHNvdW5kRW5hYmxlZDogZmFsc2UsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGVuc3VyZVNldHRpbmdzRGlyZWN0b3J5KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBmcy5ta2Rpcih0aGlzLnNldHRpbmdzRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3IoYEZhaWxlZCB0byBjcmVhdGUgc2V0dGluZ3MgZGlyZWN0b3J5OiAke2Vycm9yfWApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbG9hZFNldHRpbmdzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgZnMucmVhZEZpbGUodGhpcy5zZXR0aW5nc0ZpbGUsICd1dGYtOCcpO1xuICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgIFxuICAgICAgLy8gVmFsaWRhdGUgYW5kIG1lcmdlIHdpdGggZGVmYXVsdHNcbiAgICAgIHRoaXMuc2V0dGluZ3MgPSB7XG4gICAgICAgIC4uLnRoaXMuZ2V0RGVmYXVsdFNldHRpbmdzKCksXG4gICAgICAgIC4uLnBhcnNlZCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmICgoZXJyb3IgYXMgYW55KS5jb2RlID09PSAnRU5PRU5UJykge1xuICAgICAgICAvLyBGaWxlIGRvZXNuJ3QgZXhpc3QsIHVzZSBkZWZhdWx0cyBhbmQgc2F2ZVxuICAgICAgICB0aGlzLnNldHRpbmdzID0gdGhpcy5nZXREZWZhdWx0U2V0dGluZ3MoKTtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlU2V0dGluZ3MoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBsb2FkIHNldHRpbmdzOicsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3IoJ0ZhaWxlZCB0byBsb2FkIHNldHRpbmdzIGRhdGEnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNhdmVTZXR0aW5ncygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGF0YSA9IEpTT04uc3RyaW5naWZ5KHRoaXMuc2V0dGluZ3MsIG51bGwsIDIpO1xuICAgICAgYXdhaXQgZnMud3JpdGVGaWxlKHRoaXMuc2V0dGluZ3NGaWxlLCBkYXRhLCAndXRmLTgnKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHNhdmUgc2V0dGluZ3M6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3IoJ0ZhaWxlZCB0byBzYXZlIHNldHRpbmdzIGRhdGEnKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNhbml0aXplRW52aXJvbm1lbnRWYXJpYWJsZXMoZW52OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KTogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB7XG4gICAgY29uc3Qgc2FuaXRpemVkOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307XG4gICAgY29uc3Qgc2Vuc2l0aXZlS2V5cyA9IFsnYXBpX2tleScsICdzZWNyZXQnLCAndG9rZW4nLCAncGFzc3dvcmQnLCAna2V5J107XG4gICAgXG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoZW52KSkge1xuICAgICAgY29uc3QgbG93ZXJLZXkgPSBrZXkudG9Mb3dlckNhc2UoKTtcbiAgICAgIGNvbnN0IGlzU2Vuc2l0aXZlID0gc2Vuc2l0aXZlS2V5cy5zb21lKHNlbnNpdGl2ZSA9PiBsb3dlcktleS5pbmNsdWRlcyhzZW5zaXRpdmUpKTtcbiAgICAgIFxuICAgICAgaWYgKGlzU2Vuc2l0aXZlKSB7XG4gICAgICAgIHNhbml0aXplZFtrZXldID0gJ1tSRURBQ1RFRF0nO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2FuaXRpemVkW2tleV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHNhbml0aXplZDtcbiAgfVxufVxuXG4vLyBTaW5nbGV0b24gaW5zdGFuY2VcbmxldCBzZXR0aW5nc01hbmFnZXJJbnN0YW5jZTogU2VjdXJlU2V0dGluZ3NNYW5hZ2VyIHwgbnVsbCA9IG51bGw7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRTZWN1cmVTZXR0aW5nc01hbmFnZXIoKTogU2VjdXJlU2V0dGluZ3NNYW5hZ2VyIHtcbiAgaWYgKCFzZXR0aW5nc01hbmFnZXJJbnN0YW5jZSkge1xuICAgIHNldHRpbmdzTWFuYWdlckluc3RhbmNlID0gbmV3IFNlY3VyZVNldHRpbmdzTWFuYWdlcigpO1xuICB9XG4gIHJldHVybiBzZXR0aW5nc01hbmFnZXJJbnN0YW5jZTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemVTZWN1cmVTZXR0aW5nc01hbmFnZXIoKTogUHJvbWlzZTxTZWN1cmVTZXR0aW5nc01hbmFnZXI+IHtcbiAgY29uc3QgbWFuYWdlciA9IGdldFNlY3VyZVNldHRpbmdzTWFuYWdlcigpO1xuICBhd2FpdCBtYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgcmV0dXJuIG1hbmFnZXI7XG59Il0sIm5hbWVzIjpbInByb21pc2VzIiwiZnMiLCJwYXRoIiwiZ2V0RW5jcnlwdGlvblNlcnZpY2UiLCJJbnRlcm5hbFNlcnZlckVycm9yIiwiVmFsaWRhdGlvbkVycm9yIiwiU2VjdXJlU2V0dGluZ3NNYW5hZ2VyIiwic2V0dGluZ3NEaXIiLCJlbmNyeXB0aW9uU2VydmljZSIsInNldHRpbmdzRmlsZSIsImpvaW4iLCJzZXR0aW5ncyIsImdldERlZmF1bHRTZXR0aW5ncyIsImluaXRpYWxpemUiLCJlbnN1cmVTZXR0aW5nc0RpcmVjdG9yeSIsImxvYWRTZXR0aW5ncyIsImVycm9yIiwiY29uc29sZSIsImdldFNldHRpbmdzIiwibGxtUHJvdmlkZXJzIiwibWFwIiwicHJvdmlkZXIiLCJhcGlLZXkiLCJtYXNrQXBpS2V5IiwiZGVjcnlwdCIsInVwZGF0ZVNldHRpbmdzIiwibmV3U2V0dGluZ3MiLCJ1cGRhdGVkUHJvdmlkZXJzIiwiZXhpc3RpbmdQcm92aWRlciIsImZpbmQiLCJwIiwiaWQiLCJlbmNyeXB0ZWRBcGlLZXkiLCJhcGlLZXlIYXNoIiwiaW5jbHVkZXMiLCJlbmNyeXB0IiwiaGFzaCIsInB1c2giLCJtY3BTZXJ2ZXJzIiwicHJlZmVyZW5jZXMiLCJzYXZlU2V0dGluZ3MiLCJnZXREZWNyeXB0ZWRBcGlLZXkiLCJwcm92aWRlcklkIiwidmFsaWRhdGVBcGlLZXkiLCJiYXNlVXJsIiwibGVuZ3RoIiwic3RhcnRzV2l0aCIsImV4cG9ydFNldHRpbmdzIiwidmVyc2lvbiIsImV4cG9ydERhdGUiLCJEYXRlIiwidG9JU09TdHJpbmciLCJzZXJ2ZXIiLCJlbnYiLCJzYW5pdGl6ZUVudmlyb25tZW50VmFyaWFibGVzIiwidW5kZWZpbmVkIiwiaW1wb3J0U2V0dGluZ3MiLCJleHBvcnREYXRhIiwiY2xlYXJTZW5zaXRpdmVEYXRhIiwiZ2V0U3RhdGlzdGljcyIsInByb3ZpZGVyc1dpdGhLZXlzIiwiZmlsdGVyIiwiZW5hYmxlZE1jcFNlcnZlcnMiLCJzIiwiZW5hYmxlZCIsInRvdGFsUHJvdmlkZXJzIiwidG90YWxNY3BTZXJ2ZXJzIiwibGFzdFVwZGF0ZWQiLCJuYW1lIiwibW9kZWxzIiwic3VwcG9ydHNUb29sQ2FsbGluZyIsIm1heFRva2VucyIsImNvbW1hbmQiLCJhcmdzIiwic3RhdHVzIiwidGhlbWUiLCJsYW5ndWFnZSIsImF1dG9TY3JvbGwiLCJzb3VuZEVuYWJsZWQiLCJta2RpciIsInJlY3Vyc2l2ZSIsImRhdGEiLCJyZWFkRmlsZSIsInBhcnNlZCIsIkpTT04iLCJwYXJzZSIsImNvZGUiLCJzdHJpbmdpZnkiLCJ3cml0ZUZpbGUiLCJzYW5pdGl6ZWQiLCJzZW5zaXRpdmVLZXlzIiwia2V5IiwidmFsdWUiLCJPYmplY3QiLCJlbnRyaWVzIiwibG93ZXJLZXkiLCJ0b0xvd2VyQ2FzZSIsImlzU2Vuc2l0aXZlIiwic29tZSIsInNlbnNpdGl2ZSIsInNldHRpbmdzTWFuYWdlckluc3RhbmNlIiwiZ2V0U2VjdXJlU2V0dGluZ3NNYW5hZ2VyIiwiaW5pdGlhbGl6ZVNlY3VyZVNldHRpbmdzTWFuYWdlciIsIm1hbmFnZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/services/SecureSettingsManager.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "next/dist/shared/lib/no-fallback-error.external":
/*!******************************************************************!*\
  !*** external "next/dist/shared/lib/no-fallback-error.external" ***!
  \******************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/no-fallback-error.external");

/***/ }),

/***/ "next/dist/shared/lib/router/utils/app-paths":
/*!**************************************************************!*\
  !*** external "next/dist/shared/lib/router/utils/app-paths" ***!
  \**************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/app-paths");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/crypto-js"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fsettings%2Froute&page=%2Fapi%2Fsettings%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsettings%2Froute.ts&appDir=%2FUsers%2Fonebird%2Fgithub%2Febook-mcp%2Fmcp-chat-ui%2Fbackend%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fonebird%2Fgithub%2Febook-mcp%2Fmcp-chat-ui%2Fbackend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!")));
module.exports = __webpack_exports__;

})();